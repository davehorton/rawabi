<?xml version="1.0"?>
<xtml version="1.0"><global-handlers><handler event="Standard.OnServiceLoad.1" function="OnServiceLoad" public="0" always-on="0"/><handler event="Standard.OnSessionStart.1" function="OnSessionStart" public="0" always-on="0"/><handler event="Standard.OnSessionEnd.1" function="OnSessionEnd" public="0" always-on="0"/><handler event="Standard.OnTimer.1" function="OnTimer" public="0" always-on="0"/></global-handlers><global-vars><var name="g_strTransactionId" type="string"></var><var name="g_strDBName" type="string">pactolusdb</var><var name="g_intNumberOfCC" type="i4">0</var><var name="g_oConfController" type="object"></var><var name="g_lDBCheckTimerId" type="i8">0</var><var name="g_lDBCheckStartTime" type="i8">0</var><var name="g_lDBCheckEndTime" type="i8">0</var></global-vars><shared-vars><var name="s_strEND_ALL_CONF" type="string">EndAllConferences</var><var name="s_intTIMEOUT" type="i4">30</var><var name="s_intMaxCC" type="i4">3</var><var name="s_intSUCCESS" type="i4">0</var><var name="s_intFAILURE" type="i4">-1</var><var name="s_strSendDBCleanupMsg" type="string"></var></shared-vars><functions><function name="OnSessionStart" start="25" returns="void"><parameters><parameter name="strSessionId" type="string" pass="byref"/><parameter name="nIteration" type="i4" pass="byref"/></parameters><local-vars><var name="f_intReturnCode" type="i4">-1</var><var name="f_bCheckDBAgain" type="boolean">0</var></local-vars><actions><action id="25" plug-in="Pactolus.Branch.1"><?xtml-editor x=78 y=140 ?><results><result name="Default" link="18" stubbed="0"/></results><scripts><script language="javascript" timing="first"><![CDATA[Session.g_lDBCheckStartTime = Server.getUTCTime();]]></script></scripts></action><action id="1" plug-in="Pactolus.SOAPMessage.1"><?xtml-editor x=1104 y=559 ?><!--EndAllConferences--><SOAP destination-ip="g_oConfController[g_intNumberOfCC].strIP" transaction="g_strTransactionId" message-name="s_strEND_ALL_CONF" destination-port="g_oConfController[g_intNumberOfCC].intPort" destination-type="4" destination-session="" waiting-session-selected=""/><results><result name="Default" link="6" stubbed="0"/><result name="Success"/><result name="Error"/></results><scripts><script language="javascript" timing="first"><![CDATA[var curDate = new Date();
Session.g_strTransactionId = curDate.getTime();]]></script></scripts></action><action id="3" plug-in="Standard.FunctionCall.1"><?xtml-editor x=622 y=511 ?><!--"psAPISceGetAllConfControllers"--><function name="&quot;psAPISceGetAllConfControllers&quot;" return="f_intReturnCode" external-function="0" library=""/><results><result name="Default" link="5" stubbed="0"/></results></action><action id="5" plug-in="Pactolus.Branch.1"><?xtml-editor x=851 y=520 ?><results><result name="Default" link="8" stubbed="0"/><result name="g_intNumberOfCC &gt; 0" link="1" stubbed="0">g_intNumberOfCC &gt; 0</result></results><scripts><script language="javascript" timing="last"><![CDATA[if (2 == Result.id)
{
	Session.g_intNumberOfCC--;
}]]></script></scripts></action><action id="6" plug-in="Pactolus.Branch.1"><?xtml-editor x=90 y=741 ?><results><result name="Default" link="1" stubbed="0"/><result name="g_intNumberOfCC &lt; 0" link="8" stubbed="0">g_intNumberOfCC &lt; 0</result></results><scripts><script language="javascript" timing="first"><![CDATA[Server.logInfo("g_intNumberOfCC <" + Session.g_intNumberOfCC +">");

Session.g_intNumberOfCC--;

]]></script></scripts></action><action id="8" plug-in="Standard.FunctionCall.1"><?xtml-editor x=437 y=827 ?><!--"psAPISceConfDBRestart"--><function name="&quot;psAPISceConfDBRestart&quot;" return="" external-function="0" library=""/><results><result name="Default" link="28" stubbed="0"/></results></action><action id="9" plug-in="Pactolus.Branch.1"><?xtml-editor x=330 y=556 ?><!--"send-db-cleanup-message" == "T"--><results><result name="Default" link="8" stubbed="0"/><result name="s_strSendCleanupDB" link="3" stubbed="0">s_strSendDBCleanupMsg match "T"</result></results></action><action id="18" plug-in="Standard.FunctionCall.1"><?xtml-editor x=358 y=164 ?><!--"psAPISceDBCheck"--><function name="&quot;psAPISceDBCheck&quot;" return="f_intReturnCode" external-function="0" library=""/><results><result name="Default" link="19" stubbed="0"/></results></action><action id="19" plug-in="Pactolus.Branch.1"><?xtml-editor x=89 y=347 ?><!--DB is up--><results><result name="Default" link="22" stubbed="0"/><result name="returncode == success" link="9" stubbed="0">f_intReturnCode == s_intSUCCESS</result></results></action><action id="22" plug-in="Pactolus.Sleep.1"><?xtml-editor x=345 y=342 ?><!--20 secs--><sleep duration="20"/><results><result name="Default" link="23" stubbed="0"/></results></action><action id="23" plug-in="Pactolus.Branch.1"><?xtml-editor x=582 y=344 ?><!--enough checking?--><results><result name="Default" link="24" stubbed="0"/><result name="check db again == true" link="18" stubbed="1">f_bCheckDBAgain == true</result></results><scripts><script language="javascript" timing="first"><![CDATA[Session.g_lDBCheckEndTime = Server.getUTCTime();

if ( (Session.g_lDBCheckEndTime - Session.g_lDBCheckStartTime) < 300 )
{
	Session.f_bCheckDBAgain = true;
}
else
{
	Session.f_bCheckDBAgain = false;
}]]></script></scripts></action><action id="24" plug-in="Pactolus.Branch.1"><?xtml-editor x=831 y=344 ?><results><result name="Default" link="26" stubbed="1"/></results><scripts><script language="javascript" timing="first"><![CDATA[Server.logError("ERROR: UNABLE TO CONNECT TO DB AFTER 5 MINS");]]></script></scripts></action><action id="26" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=1087 y=900 ?><return value=""/></action><action id="28" plug-in="Standard.Timer.1"><?xtml-editor x=904 y=889 ?><timer start="1" id="1" duration="1"/><results><result name="Default" link="26" stubbed="0"/></results></action></actions></function><function name="psAPISceGetAllConfControllers" start="1" returns="i4"><local-vars><var name="f_intReturnCode" type="i4">-1</var></local-vars><actions><action id="1" plug-in="Pactolus.JavaStaticMethod.1"><?xtml-editor x=154 y=210 ?><!--"getAllConfControllers"--><java class="&quot;com.pactolus.conferencing.psAPISceConfCleanup&quot;" method="&quot;getAllConfControllers&quot;" timeout="s_intTIMEOUT" return="" method-return-var="f_intReturnCode" method-return-type="0"><parameter type="in" var-type="string">g_strDBName</parameter><parameter type="inout" var-type="i4">g_intNumberOfCC</parameter><parameter type="inout" var-type="string">g_oConfController[0].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[0].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[1].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[1].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[2].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[2].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[3].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[3].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[4].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[4].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[5].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[5].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[6].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[6].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[7].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[7].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[8].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[8].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[9].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[9].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[10].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[10].intPort</parameter><parameter type="inout" var-type="string">g_oConfController[11].strIP</parameter><parameter type="inout" var-type="i4">g_oConfController[11].intPort</parameter></java><results><result name="Default" link="2" stubbed="0"/><result name="Success" link="3" stubbed="0"/><result name="Error"/><result name="Timeout"/></results><scripts><script language="javascript" timing="first"><![CDATA[for (var i = 0; i < Session.s_intMaxCC; i++)
{
	Session.g_oConfController[i].strIP = "";
	Session.g_oConfController[i].intPort = 0;
}]]></script></scripts></action><action id="2" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=369 y=209 ?><!--s_intFAILURE--><return value="s_intFAILURE"/></action><action id="3" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=376 y=295 ?><!--f_intReturnCode--><return value="f_intReturnCode"/></action></actions></function><function name="psAPISceConfDBRestart" start="1" returns="i4"><local-vars><var name="f_intReturnCode" type="i4">-1</var></local-vars><actions><action id="1" plug-in="Pactolus.JavaStaticMethod.1"><?xtml-editor x=85 y=224 ?><!--"confDBRestart"--><java class="&quot;com.pactolus.conferencing.psAPISceConfCleanup&quot;" method="&quot;confDBRestart&quot;" timeout="s_intTIMEOUT" return="" method-return-var="f_intReturnCode" method-return-type="0"><parameter type="in" var-type="string">g_strDBName</parameter></java><results><result name="Default" link="2" stubbed="0"/><result name="Success" link="3" stubbed="0"/><result name="Error"/><result name="Timeout"/></results><scripts><script language="javascript" timing="first"><![CDATA[Server.logInfo("CALLING psAPISceConfDBRestart");]]></script></scripts></action><action id="2" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=322 y=219 ?><!--s_intFAILURE--><return value="s_intFAILURE"/></action><action id="3" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=329 y=305 ?><!--f_intReturnCode--><return value="f_intReturnCode"/></action></actions></function><function name="OnServiceLoad" start="1" returns="void"><parameters><parameter name="strAppName" type="string" pass="byref"/><parameter name="nSessionCount" type="i2" pass="byref"/><parameter name="nMaxIterations" type="i2" pass="byref"/><parameter name="nServerId" type="i2" pass="byref"/></parameters><actions><action id="1" plug-in="Pactolus.UserFunction.1"><?xtml-editor x=224 y=167 ?><!--get "send-db-cleanup-message"--><user-function process="&quot;PACTOLUS_ps_c_adaptor&quot;" function="&quot;get_property&quot;" timeout="30" return="" async="0"><parameter>"send-db-cleanup-message"</parameter><parameter>s_strSendDBCleanupMsg</parameter></user-function><results><result name="Default" link="2" stubbed="0"/><result name="Success"/><result name="Error"/><result name="Timeout"/></results></action><action id="2" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=480 y=162 ?><return value=""/></action></actions></function><function name="psAPISceDBCheck" start="1" returns="i4"><local-vars><var name="f_intReturnCode" type="i4">-1</var></local-vars><actions><action id="1" plug-in="Pactolus.JavaStaticMethod.1"><?xtml-editor x=249 y=230 ?><!--"psAPISceDBCheck"--><java class="&quot;com.pactolus.psAPISceDBCheck&quot;" method="&quot;dbCheck&quot;" timeout="s_intTIMEOUT" return="" method-return-var="f_intReturnCode" method-return-type="0"/><results><result name="Default" link="2" stubbed="0"/><result name="Success" link="3" stubbed="0"/><result name="Error"/><result name="Timeout"/></results><scripts><script language="javascript" timing="first"><![CDATA[Server.logInfo("CALLING psAPISceDBCheck");]]></script></scripts></action><action id="2" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=507 y=220 ?><!--s_intFAILURE--><return value="s_intFAILURE"/></action><action id="3" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=514 y=306 ?><!--f_intReturnCode--><return value="f_intReturnCode"/></action></actions></function><function name="OnTimer" start="1" returns="void"><parameters><parameter name="nTimerId" type="i4" pass="byref"/></parameters><actions><action id="1" plug-in="Standard.EndSession.1"><?xtml-editor x=138 y=110 ?></action></actions></function><function name="OnSessionEnd" start="1" returns="void"><parameters><parameter name="nSessionEndReason" type="i2" pass="byref"/></parameters><actions><action id="1" plug-in="Pactolus.Branch.1"><?xtml-editor x=100 y=88 ?><results><result name="Default"/></results><scripts><script language="javascript" timing="first"><![CDATA[Server.logInfo("db_conf_cleanup exiting");]]></script></scripts></action></actions></function></functions><properties><property key="disable-logging" value=""/><property key="js-include-path" value=""/><property key="library-modules" value=""/><property key="library-path" value=""/></properties><application-version>
		<revision>$Id: db_conf_cleanup.xml,v 1.8 2004/08/17 23:57:55 jcraig Exp $</revision>
		<label>$Name: PCS-A-4-1-1-1-4-c6 $</label>
	</application-version>
</xtml>

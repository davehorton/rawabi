<?xml version="1.0"?>
<xtml version="1.0"><global-handlers><handler event="Standard.OnServiceLoad.1" function="OnServiceLoad" public="0" always-on="0"/><handler event="Pactolus.EveSipSubscribe.1" function="OnSubscribe" public="1" always-on="1"/></global-handlers><shared-vars><var name="s_strLocalUri" type="string"></var></shared-vars><functions><function name="OnSubscribe" start="1" returns="void"><parameters><parameter name="strAccept" type="string" pass="byref"/><parameter name="strAcceptEncoding" type="string" pass="byref"/><parameter name="strAcceptLanguage" type="string" pass="byref"/><parameter name="strAuthorization" type="string" pass="byref"/><parameter name="strCallId" type="string" pass="byref"/><parameter name="strContact" type="string" pass="byref"/><parameter name="strContent" type="string" pass="byref"/><parameter name="strContentDisposition" type="string" pass="byref"/><parameter name="strContentType" type="string" pass="byref"/><parameter name="strCSeq" type="string" pass="byref"/><parameter name="strDate" type="string" pass="byref"/><parameter name="strEncryption" type="string" pass="byref"/><parameter name="strEvent" type="string" pass="byref"/><parameter name="strExpires" type="string" pass="byref"/><parameter name="strFrom" type="string" pass="byref"/><parameter name="nMaxForwards" type="i2" pass="byref"/><parameter name="strProxyAuthorization" type="string" pass="byref"/><parameter name="strProxyRequire" type="string" pass="byref"/><parameter name="strRecordRoute" type="string" pass="byref"/><parameter name="strRequestURI" type="string" pass="byref"/><parameter name="strRequire" type="string" pass="byref"/><parameter name="strResponseKey" type="string" pass="byref"/><parameter name="strRoute" type="string" pass="byref"/><parameter name="strSupported" type="string" pass="byref"/><parameter name="strTimestamp" type="string" pass="byref"/><parameter name="strTo" type="string" pass="byref"/><parameter name="strVia" type="string" pass="byref"/></parameters><local-vars><var name="strRemoteUri" type="string"></var></local-vars><actions><action id="1" plug-in="Pactolus.SipResponse.1"><?xtml-editor x=58 y=71 ?><!--Send 200 OK--><sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0"><call-id>strCallId</call-id><cseq>strCSeq</cseq><from>strFrom</from><status>"SIP/2.0 200 OK"</status><to>strTo</to><via>strVia</via></sip-response><results><result name="Default" link="2" stubbed="0"/><result name="Success"/><result name="Error"/><result name="Timeout"/></results><scripts><script language="javascript" timing="first"><![CDATA[Server.enableEvents(false) ;

js_calculate_uri_and_route(true, "SIP/2.0", 
	Session.strFrom.toString(), Session.strContact.toString(), 
	Session.strRecordRoute.toString(), Session.strRemoteUri, Session.strRoute);
Server.logInfo("Calculated request uri as: " + Session.strRemoteUri ) ;
Server.logInfo("Calculated route as:       " + Session.strRoute ) ;
]]></script></scripts></action><action id="2" plug-in="Pactolus.SipNotify.1"><?xtml-editor x=330 y=79 ?><!--Send a test NOTIFY message indicating a message is waiting--><sip-notify add-record-route="0" add-via="1" increment-cseq-first="1" increment-cseq-last="0"><call-id>strCallId</call-id><contact>s_strLocalUri</contact><content>strContent</content><content-type>"application/simple-message-summary"</content-type><cseq>strCSeq</cseq><event>"message-summary"</event><from>s_strLocalUri</from><request-uri>strRemoteUri</request-uri><route>strRoute</route><to>strContact</to></sip-notify><results><result name="Default" link="4" stubbed="0"/><result name="Success"/><result name="Error"/><result name="Timeout"/></results><scripts><script language="javascript" timing="first"><![CDATA[
//dummy something up
Session.strContent = "Messages-Waiting: yes\n" ;


/* could add this for more specifics
					"Message-Account: " + Session.strTo + "\n" + 
					"Voice-Message: 2/8 (0/2)\n" ;
*/]]></script></scripts></action><action id="3" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=770 y=137 ?><return value=""/><scripts><script language="javascript" timing="first"><![CDATA[Server.enableEvents(true) ;]]></script></scripts></action><action id="4" plug-in="Pactolus.Sleep.1"><?xtml-editor x=46 y=410 ?><!--sleep 20 secs--><sleep duration="20"/><results><result name="Default" link="5" stubbed="0"/></results></action><action id="5" plug-in="Pactolus.SipNotify.1"><?xtml-editor x=391 y=414 ?><!--now turn off message waiting indicator--><sip-notify add-record-route="0" add-via="1" increment-cseq-first="1" increment-cseq-last="0"><call-id>strCallId</call-id><contact>s_strLocalUri</contact><content>strContent</content><content-type>"application/simple-message-summary"</content-type><cseq>strCSeq</cseq><event>"message-summary"</event><from>s_strLocalUri</from><request-uri>strRemoteUri</request-uri><route>strRoute</route><to>strContact</to></sip-notify><results><result name="Default" link="3" stubbed="0"/><result name="Success"/><result name="Error"/><result name="Timeout"/></results><scripts><script language="javascript" timing="first"><![CDATA[
//dummy something up
Session.strContent = "Messages-Waiting: no\n" ;
]]></script></scripts></action></actions></function><function name="OnServiceLoad" start="1" returns="void"><parameters><parameter name="strAppName" type="string" pass="byref"/><parameter name="nSessionCount" type="i2" pass="byref"/><parameter name="nMaxIterations" type="i2" pass="byref"/><parameter name="nServerId" type="i2" pass="byref"/></parameters><actions><action id="1" plug-in="Standard.FunctionReturn.1"><?xtml-editor x=109 y=94 ?><return value=""/><scripts><script language="javascript" timing="first"><![CDATA[Session.s_strLocalUri = "sip:" + Server.sipAddress ;
if( 5060 != Server.sipPort ) {
	Session.s_strLocalUri += "@" ;
	Session.s_strLocalUri += Server.sipPort ;
}]]></script></scripts></action></actions></function></functions><script language="javascript"><![CDATA[#include <javascript_utils.jsh>]]></script><properties><property key="disable-logging" value=""/><property key="js-include-path" value="C:\pactolus_app_server\apps\voip\libs\"/><property key="library-modules" value=""/><property key="library-path" value=""/></properties></xtml>

<?xml version="1.0"?>
<xtml version="1.0" >
  <version sce-version="422a4" prev-sce-version="422a4" last-mod-time="Wednesday, June 22, 2005 10:52:46"/>
  <events >
    <event name="CSRBeginAssignment" display="CSRBeginAssignment" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
      <parameter name="lCSRAssignmentId" type="i8"/>
      <parameter name="lCSRRequestId" type="i8"/>
      <parameter name="lCSRUserId" type="i8"/>
      <parameter name="lCSRRequestSkillId" type="i8"/>
      <parameter name="strCSRRequestSkillName" type="string"/>
      <parameter name="lCSRRequestLanguageId" type="i8"/>
      <parameter name="strCSRRequestLanguageName" type="string"/>
      <parameter name="lCSRRequestGroupId" type="i8"/>
      <parameter name="strCSRRequestGroupName" type="string"/>
      <parameter name="nCSRRequestType" type="i4"/>
      <parameter name="strRequestTypeName" type="string"/>
      <parameter name="lServiceProviderId" type="i8"/>
      <parameter name="strServiceProviderName" type="string"/>
      <parameter name="lOfferingId" type="i8"/>
      <parameter name="strOfferingName" type="string"/>
      <parameter name="strConfEventId" type="string"/>
      <parameter name="strModPasscode" type="string"/>
      <parameter name="strSubscriberAccount" type="string"/>
      <parameter name="strSubscriberFirstName" type="string"/>
      <parameter name="strSubscriberLastName" type="string"/>
      <parameter name="strCSRAppServerIP" type="string"/>
      <parameter name="strCSRRequestTypeName" type="string"/>
      <parameter name="lCSRAssignmentDuration" type="i8"/>
      <parameter name="strSubscriberPin" type="string"/>
      <parameter name="strCSRAssignmentAction" type="string"/>
    </event>
    <event name="CSREndAssignment" display="CSREndAssignment" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
      <parameter name="lCSRAssignmentId" type="i8"/>
      <parameter name="lCSRRequestId" type="i8"/>
      <parameter name="lCSRUserId" type="i8"/>
      <parameter name="strCSRAssignmentAction" type="string"/>
      <parameter name="strPasscode" type="string"/>
      <parameter name="strPrepaidPin" type="string"/>
      <parameter name="strPostpaidPin" type="string"/>
      <parameter name="strPostpaidAccountNumber" type="string"/>
      <parameter name="strOutdialPhoneNumber" type="string"/>
      <parameter name="nCSRAvailabilityState" type="i4"/>
      <parameter name="strBillableFlag" type="string"/>
    </event>
    <event name="CallerOffHold" display="CallerOffHold" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
    </event>
    <event name="CallerOnHold" display="CallerOnHold" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
    </event>
    <event name="CSROutdialBLeg" display="CSROutdialBLeg" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
      <parameter name="strPhoneNumber" type="string"/>
      <parameter name="strPrepaidPin" type="string"/>
      <parameter name="strPostpaidPin" type="string"/>
      <parameter name="strPostpaidAccountNumber" type="string"/>
      <parameter name="strBillableFlag" type="string"/>
    </event>
    <event name="CSRCancelOutdialToBLeg" display="CSRCancelOutdialToBLeg" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
    </event>
    <event name="CSRHangupBLeg" display="CSRHangupBLeg" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
    </event>
    <event name="Ping" display="Ping" >
      <parameter name="strACDControllerIP" type="string"/>
      <parameter name="nACDControllerPort" type="i4"/>
      <parameter name="strTransactionId" type="string"/>
      <parameter name="strHostIP" type="string"/>
      <parameter name="nHostPort" type="i4"/>
    </event>
  </events>
  <global-handlers >
    <handler event="Pactolus.EveSipRefer.1" function="OnRefer" public="0" always-on="0"/>
    <handler event="Pactolus.EveSipInvite.1" function="OnInvite" public="1" always-on="0"/>
    <handler event="Pactolus.EveSipBye.1" function="OnBye" public="0" always-on="0"/>
    <handler event="Pactolus.EveSipCancel.1" function="OnCancel" public="0" always-on="0"/>
    <handler event="Standard.OnServiceLoad.1" function="OnServiceLoad" public="0" always-on="0"/>
    <handler event="Standard.OnSessionEnd.1" function="OnSessionEnd" public="0" always-on="0"/>
    <handler event="Standard.OnTimer.1" function="OnTimer" public="0" always-on="0"/>
    <handler event="Pactolus.EveSipInfo.1" function="OnInfo" public="0" always-on="0"/>
    <handler event="Pactolus.EveSipOptions.1" function="OnOptions" public="0" always-on="0"/>
    <handler event="Pactolus.MGCPDtmf.1" function="OnDTMF" public="0" always-on="0"/>
    <handler event="CSRBeginAssignment" function="OnCSRBeginAssignment" public="0" always-on="0"/>
    <handler event="CSREndAssignment" function="OnCSREndAssignment" public="0" always-on="0"/>
    <handler event="CallerOffHold" function="OnCSRPutCallerOffHold" public="0" always-on="0"/>
    <handler event="CallerOnHold" function="OnCSRPutCallerOnHold" public="0" always-on="0"/>
    <handler event="CSROutdialBLeg" function="OnCSROutdialBLeg" public="0" always-on="0"/>
    <handler event="CSRCancelOutdialToBLeg" function="OnCSRCancelOutdialToBLeg" public="0" always-on="0"/>
    <handler event="CSRHangupBLeg" function="OnCSRHangupBLeg" public="0" always-on="0"/>
    <handler event="Ping" function="OnPing" public="0" always-on="0"/>
  </global-handlers>
  <global-vars >
    <var name="g_nThresholdTime1" type="i4" >120</var>
    <var name="g_strPin" type="string" ></var>
    <var name="g_lPlatformSessionEndTime" type="i8" >0</var>
    <var name="g_strEventReceived" type="string" ></var>
    <var name="g_nCurrentState" type="i4" >-1</var>
    <var name="g_strTempString" type="string" ></var>
    <var name="g_nTempInt" type="i4" >0</var>
    <var name="g_fTempFloat" type="float" >0</var>
    <var name="g_lTempLong" type="i8" >0</var>
    <var name="g_lTimerId1" type="i8" >0</var>
    <var name="g_strDigitCollected" type="string" ></var>
    <var name="g_nReInviteFlag" type="i4" >0</var>
    <var name="g_nPromptToPlay" type="i4" >0</var>
    <var name="g_lTimerIdThreshold" type="i8" >0</var>
    <var name="g_nSessionExpires" type="i4" >0</var>
    <var name="g_nNumRetry" type="i4" >0</var>
    <var name="g_bNullFlag" type="boolean" >0</var>
    <var name="g_nSessionExpiresA" type="i4" >0</var>
    <var name="g_nSessionExpiresB" type="i4" >0</var>
    <var name="g_lTimerIdA" type="i8" >0</var>
    <var name="g_lTimerIdB" type="i8" >0</var>
    <var name="g_bTimerSecAvailFlag" type="boolean" >0</var>
    <var name="g_bTimerAFlag" type="boolean" >0</var>
    <var name="g_bTimerBFlag" type="boolean" >0</var>
    <var name="g_bTimerThresholdFlag" type="boolean" >0</var>
    <var name="g_strNewSPPhone" type="string" ></var>
    <var name="g_strNewSPDigits" type="string" ></var>
    <var name="g_nNumberOfSpeedDial" type="i4" >0</var>
    <var name="g_strTerminationDigit" type="string" ></var>
    <var name="g_strAlarmType" type="string" ></var>
    <var name="g_strAlarmPriority" type="string" ></var>
    <var name="g_strOrigASDP" type="string" ></var>
    <var name="g_oCallLegA" type="object" ></var>
    <var name="g_oMS" type="object" ></var>
    <var name="g_oSpeedDial" type="object" ></var>
    <var name="g_bSentFinalResponse" type="boolean" >0</var>
    <var name="g_bNewCall" type="boolean" >1</var>
    <var name="g_nErrorMsgNumber" type="i4" >0</var>
    <var name="g_bFirstTry" type="boolean" >1</var>
    <var name="g_lCkReInviteTimerIdB" type="i8" >0</var>
    <var name="g_lCkReInviteTimerIdA" type="i8" >0</var>
    <var name="g_lLastReInviteTimeA" type="i8" >0</var>
    <var name="g_lLastReInviteTimeB" type="i8" >0</var>
    <var name="g_nServiceElementId" type="i4" >3</var>
    <var name="g_bANIValidated" type="boolean" >0</var>
    <var name="g_bGetPinOnly" type="boolean" >0</var>
    <var name="g_strAuthenticationNbr" type="string" ></var>
    <var name="g_nFiller" type="i4" >0</var>
    <var name="g_strFiller" type="string" ></var>
    <var name="g_fFiller" type="float" >0</var>
    <var name="g_fMinsUsedThisPeriod" type="float" >0</var>
    <var name="g_nMaxMinAllowedThisPeriod" type="i4" >0</var>
    <var name="g_fAmountUsedThisPeriod" type="float" >0</var>
    <var name="g_nMaxPartiesAllowed" type="i4" >8</var>
    <var name="g_oArrayCallLegs" type="object" ></var>
    <var name="g_oConferenceMS" type="object" ></var>
    <var name="g_nCurrentArrayIndex" type="i4" >0</var>
    <var name="g_oACD" type="object" ></var>
    <var name="g_oAPI" type="object" ></var>
    <var name="g_oTestData" type="object" ></var>
    <var name="g_oTimerThreshold1" type="object" ></var>
    <var name="g_oTimerThreshold2" type="object" ></var>
    <var name="g_oTimerThreshold3" type="object" ></var>
    <var name="g_oTimerPhoneA" type="object" ></var>
    <var name="g_oTimerGSXA" type="object" ></var>
    <var name="g_oTimerGSXB" type="object" ></var>
    <var name="g_oTimerMaxTime" type="object" ></var>
    <var name="g_oMOHTimer" type="object" ></var>
    <var name="g_oMaxWaitCSRTimer" type="object" ></var>
    <var name="g_oPleaseHoldTimer" type="object" ></var>
    <var name="g_oSUB" type="object" ></var>
    <var name="g_oTimerHeartBeat" type="object" ></var>
    <var name="g_oMOH_MS" type="object" ></var>
    <var name="g_strMOH_SessionId" type="string" ></var>
    <var name="g_bZeroOutToCSR" type="boolean" >0</var>
    <var name="g_nMOH_ConfIndex" type="i4" >0</var>
    <var name="g_oRATE" type="object" ></var>
    <var name="g_oCreditCard" type="object" ></var>
    <var name="g_bGotCSRCancelOutdial" type="boolean" >0</var>
    <var name="g_bGotCSRHangupOutdial" type="boolean" >0</var>
    <var name="g_oTimerPrompts" type="object" ></var>
    <var name="g_nPromptHoldForCSR" type="i4" >1501</var>
    <var name="g_nPromptNotAllowed" type="i4" >524</var>
    <var name="g_nReturnCode" type="i4" >0</var>
    <var name="g_oCallLegB" type="object" ></var>
    <var name="g_oTimerMaxTimeALeg" type="object" ></var>
  </global-vars>
  <shared-vars >
    <var name="s_strPrimaryPSX" type="string" >10.6.9.64</var>
    <var name="s_nSLEEPTIME" type="i4" >7</var>
    <var name="s_nTIMEOUT" type="i4" >20</var>
    <var name="s_strPROTOCOL" type="string" >UDP</var>
    <var name="s_strSIPVERSION" type="string" >SIP/2.0</var>
    <var name="s_strApplicationName" type="string" ></var>
    <var name="s_nINITIALIZE_SESSION" type="i4" >0</var>
    <var name="s_nGET_PIN" type="i4" >1</var>
    <var name="s_nAUTHENTICATE_PIN" type="i4" >2</var>
    <var name="s_nGET_DESTINATION" type="i4" >3</var>
    <var name="s_nAUTHORIZE_DESTINATION" type="i4" >4</var>
    <var name="s_nMAKE_CONNECTION" type="i4" >5</var>
    <var name="s_nCONNECTED" type="i4" >6</var>
    <var name="s_nEND_CALL" type="i4" >9</var>
    <var name="s_nMAKE_CALL" type="i4" >14</var>
    <var name="s_nMAIN_MENU" type="i4" >15</var>
    <var name="s_nRING_NO_ANSWER_TIME" type="i4" >60</var>
    <var name="s_strLocalHost" type="string" ></var>
    <var name="s_sSUCCESS" type="i2" >0</var>
    <var name="s_sFAILURE" type="i2" >-1</var>
    <var name="s_strDEFAULT_ANI" type="string" ></var>
    <var name="s_strBackupPSX" type="string" ></var>
    <var name="s_strTestModeFlag" type="string" ></var>
    <var name="s_strUseSoftswitchFlag" type="string" ></var>
    <var name="s_nPROMPTLENGTH" type="i4" >42</var>
    <var name="s_strContentType" type="string" >application/sdp</var>
    <var name="s_strSEND_ALARM_REQUEST" type="string" >OnAlarm</var>
    <var name="s_strSendAlarmFlag" type="string" ></var>
    <var name="s_strVia" type="string" ></var>
    <var name="s_strContact" type="string" ></var>
    <var name="s_sCALLERHUNGUP" type="i2" >-2</var>
    <var name="s_strMSType" type="string" ></var>
    <var name="s_strMSRetryFlag" type="string" ></var>
    <var name="s_strDigitPrependToOutdial" type="string" ></var>
    <var name="s_nPROMPT_GOOD_BYE" type="i4" >322</var>
    <var name="s_nPacketizationPeriod" type="i4" >0</var>
    <var name="s_strOutdialDigitMap" type="string" ></var>
    <var name="s_strSessionTimerFlag" type="string" ></var>
    <var name="s_nSessionTimerInterval" type="i4" >0</var>
    <var name="s_strOutdialDialingPlan" type="string" ></var>
    <var name="s_nVALIDATE_ANI" type="i4" >10</var>
    <var name="s_nDIRECT_TO_MS" type="i4" >11</var>
    <var name="s_strIgnorePinLanguage" type="string" >F</var>
    <var name="s_nHalfSecSilence" type="i4" >220</var>
    <var name="s_fPostStartCallDelay" type="float" >0</var>
    <var name="s_nBEGIN_3_WAY_CONF" type="i4" >18</var>
    <var name="s_nGET_VAL_CONF_DEST" type="i4" >17</var>
    <var name="s_strPoundReoriginate" type="string" >#</var>
    <var name="s_strConferenceMSType" type="string" >CONV</var>
    <var name="s_nConferenceMaxParties" type="i4" >0</var>
    <var name="s_nConferenceMaxTalkers" type="i4" >0</var>
    <var name="s_strCodec" type="string" >PCMU</var>
    <var name="s_nROUTE_TO_CSR" type="i4" >19</var>
    <var name="s_nBEGINASSIGNMENT" type="i4" >20</var>
    <var name="s_nENDASSIGNMENT" type="i4" >21</var>
    <var name="s_nPROMPT_JOIN_TONE" type="i4" >231</var>
    <var name="s_nBEGINREQUEST" type="i4" >22</var>
    <var name="s_nENDREQUEST" type="i4" >23</var>
    <var name="s_nREQUEUE" type="i4" >24</var>
    <var name="s_nIntlMinConnectTime" type="i4" >0</var>
    <var name="s_nDomMinConnectTime" type="i4" >0</var>
    <var name="s_strCustomerCode" type="string" ></var>
    <var name="s_nSoapPort" type="i4" >0</var>
    <var name="s_nEXCEEDINVALID" type="i4" >2</var>
    <var name="s_nZEROTOCSR" type="i4" >4</var>
    <var name="s_nSPEEDDIAL" type="i4" >25</var>
    <var name="s_strSendInfoMsg" type="string" ></var>
    <var name="s_nSTATE_PROC_CSR_ATTEMPT" type="i4" >26</var>
    <var name="s_nCSR_ROUTE_REASON_INVALID" type="i4" >6</var>
    <var name="s_nCSR_ROUTE_REASON_TIMEOUT" type="i4" >5</var>
    <var name="s_nCSR_ROUTE_REASON_ZERO_OUT" type="i4" >4</var>
    <var name="s_oCSR_REASONS" type="object" ></var>
  </shared-vars>
  <functions >
    <function name="Main" start="1" event="Main" returns="void" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_strAcctNumber" type="string" ></var>
        <var name="f_strPinNumber" type="string" ></var>
        <var name="f_bNullFlag" type="boolean" >0</var>
        <var name="f_bValidateAniFails" type="boolean" >0</var>
        <var name="f_bValidateAcctAndPin" type="boolean" >0</var>
        <var name="f_bInitializeSessionFails" type="boolean" >0</var>
        <var name="f_nCounter" type="i4" >0</var>
        <var name="f_bCallCSR" type="boolean" >0</var>
        <var name="f_bIsValid" type="boolean" >0</var>
        <var name="f_bMissDial" type="boolean" >0</var>
        <var name="f_strContentON" type="string" >ON</var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Pactolus.Branch.1" ><?xtml-editor x=120 y=379 ?>
          <!--what is the g_nCurrentState-->
          <results >
            <result name="Default" link="2" stubbed="0"/>
            <result name="getPinNumber()" link="48" stubbed="0" >g_nCurrentState == s_nGET_PIN</result>
            <result name="authenticatePin()" link="5" stubbed="0" >g_nCurrentState == s_nAUTHENTICATE_PIN</result>
            <result name="getDestNumber()" link="17" stubbed="0" >g_nCurrentState == s_nGET_DESTINATION</result>
            <result name="authorizationDestination()" link="7" stubbed="0" >g_nCurrentState == s_nAUTHORIZE_DESTINATION</result>
            <result name="make connection" link="12" stubbed="0" >g_nCurrentState == s_nMAKE_CONNECTION</result>
            <result name="connected" link="58" stubbed="0" >g_nCurrentState == s_nCONNECTED</result>
            <result name="end call" link="15" stubbed="0" >g_nCurrentState == s_nEND_CALL</result>
            <result name="main menu" link="18" stubbed="0" >g_nCurrentState == s_nMAIN_MENU</result>
            <result name="validate ANI" link="24" stubbed="0" >g_nCurrentState == s_nVALIDATE_ANI</result>
            <result name="direct to ms" link="20" stubbed="0" >g_nCurrentState == s_nDIRECT_TO_MS</result>
            <result name="get and validate conf dest" link="50" stubbed="0" >g_nCurrentState == s_nGET_VAL_CONF_DEST</result>
            <result name="begin 3 way conf" link="49" stubbed="0" >g_nCurrentState == s_nBEGIN_3_WAY_CONF</result>
            <result name="route to CSR" link="54" stubbed="0" >g_nCurrentState == s_nROUTE_TO_CSR</result>
            <result name="proc CSR Attempt" link="61" stubbed="0" >s_nSTATE_PROC_CSR_ATTEMPT == g_nCurrentState</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("*** THE CURRENT STATE IS: *** " + Session.g_nCurrentState);]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=501 y=111 ?>
          <return value=""/>
        </action>
        <action id="5" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=612 y=338 ?>
          <!--call authenticatePin()-->
          <function name="&quot;AuthenticatePin&quot;" return="g_nCurrentState" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
        <action id="7" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=695 y=542 ?>
          <!--call authorizeDest()-->
          <function name="&quot;AuthorizeDestination&quot;" return="g_nCurrentState" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
        <action id="12" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=670 y=637 ?>
          <!--make the connection-->
          <function name="&quot;Connect&quot;" return="g_nCurrentState" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
        <action id="14" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1137 y=734 ?>
          <return value=""/>
        </action>
        <action id="15" plug-in="Standard.EndSession.1" ><?xtml-editor x=658 y=889 ?></action>
        <action id="16" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=764 y=225 ?>
          <!--getPinNumber()-->
          <function name="&quot;GetPinNumber&quot;" return="g_nCurrentState" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
        <action id="17" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=678 y=437 ?>
          <!--getDestNumber()-->
          <function name="&quot;GetDestNumber&quot;" return="g_nCurrentState" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
        <action id="18" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=654 y=966 ?>
          <!--Main Menu-->
          <function name="&quot;MainMenu&quot;" return="g_nCurrentState" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
        <action id="20" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=637 y=1641 ?>
          <!--direct caller to MS-->
          <function name="&quot;DirectCallerToMS&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oMS</parameter>
          </function>
          <results >
            <result name="Default" link="21" stubbed="0"/>
            <result name="0 - Success, bValidateANIFails" link="27" stubbed="0" >f_nReturnCode == s_sSUCCESS
AND f_bValidateAniFails == true</result>
            <result name="-2 - CALLER HUNG UP" link="15" stubbed="1" >f_nReturnCode == s_sCALLERHUNGUP</result>
            <result name="0 - Success" link="32" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (1 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 12;
}
else if (3 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 7;
}
else
{
	Session.g_bSentFinalResponse = true;
}]]></script>
          </scripts>
        </action>
        <action id="21" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=893 y=1550 ?>
          <!--503 service unavailable-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >g_oCallLegA.strCallId</call-id>
            <contact >s_strContact</contact>
            <cseq >g_oCallLegA.strCSeq</cseq>
            <from >g_oCallLegA.strFrom</from>
            <status >"SIP/2.0 503 Service Unavailable"</status>
            <to >g_oCallLegA.strTo</to>
            <via >g_oCallLegA.strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="23" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logError("ERROR: MAIN FAIL TO CONNECT TO MS, RESPONSE 503 SERVICE UNAVAILABLE");
var myTo = new SipTo(Session.g_oCallLegA.strTo);
if (undefined == myTo.tag)
{
	Session.g_oCallLegA.strTo = Session.g_oCallLegA.strTo + ";tag=" + Server.getUTCTime();
}]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (Result.id != 2)
{
	Server.logError("ERROR: FAIL TO RESPONSE 503 SERVICE UNAVAILABLE");
}]]></script>
          </scripts>
        </action>
        <action id="22" plug-in="Pactolus.SOAPMessage.1" ><?xtml-editor x=1384 y=1546 ?>
          <!--send ALARM-->
          <SOAP destination-ip="" transaction="" message-name="s_strSEND_ALARM_REQUEST" destination-port="" destination-type="1" destination-session="" waiting-session-selected="" >
            <parameter tag="&quot;calling_number&quot;" value="g_strAlarmType"/>
            <parameter tag="&quot;called_number&quot;" value="g_strAlarmPriority"/>
          </SOAP>
          <results >
            <result name="Default" link="15" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_strAlarmType = "MEDIASERVER: connect party to ms";
Session.g_strAlarmPriority = "MAJOR";]]></script>
          </scripts>
        </action>
        <action id="23" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1124 y=1550 ?>
          <!--send alarm?-->
          <results >
            <result name="Default" link="15" stubbed="1"/>
            <result name="s_strSendAlarmFlag==T" link="22" stubbed="0" >s_strSendAlarmFlag match "T"</result>
          </results>
        </action>
        <action id="24" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=640 y=1056 ?>
          <!--"psAPIScePopdValidateANI"-->
          <function name="&quot;PostpaidAPIValidateANI&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >f_strAcctNumber</parameter>
            <parameter >f_strPinNumber</parameter>
          </function>
          <results >
            <result name="Default" link="26" stubbed="0"/>
            <result name="0 - SUCCESS and has pin" link="36" stubbed="0" >f_nReturnCode == s_sSUCCESS
AND f_bNullFlag == false</result>
            <result name="0 - SUCCESS and no pin" link="37" stubbed="0" >f_nReturnCode == s_sSUCCESS
AND f_bNullFlag == true</result>
            <result name="1 or 2 - Normal Case" link="38" stubbed="0" >f_nReturnCode == 1
OR f_nReturnCode == 2</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
            <script language="javascript" timing="middle" ><![CDATA[if (Session.f_strPinNumber.length == 0)
{
	Session.f_bNullFlag = true;
}
else
{
	Session.f_bNullFlag = false;
}]]></script>
            <script language="javascript" timing="last" ><![CDATA[Session.g_strAuthenticationNbr = Session.f_strAcctNumber;
if (Session.f_nReturnCode < 0)
{
	Server.logError("ERROR: FAIL TO CALL JAVA VALIDATE ANI SESSION, EXIT ON: " + Result.name);
	switch (Session.f_nReturnCode)
	{
		case -1:
			Session.g_nErrorMsgNumber = 1001; //db error
			Session.g_oAPI.nSessionTerminationReason = 5;
			break;
		case -50:
			Session.g_nErrorMsgNumber = 1000; //jvm server error
			Session.g_oAPI.nSessionTerminationReason = 5;
			break;
		default:
			Session.g_nErrorMsgNumber = 0;
			break;
	}
}]]></script>
          </scripts>
        </action>
        <action id="25" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1150 y=1032 ?>
          <!--send alarm?-->
          <results >
            <result name="Default" link="27" stubbed="1"/>
            <result name="s_strSendAlarmFlag==T" link="30" stubbed="0" >s_strSendAlarmFlag match "T"</result>
          </results>
        </action>
        <action id="26" plug-in="Pactolus.UserFunction.1" ><?xtml-editor x=906 y=1036 ?>
          <!--send alert db error-->
          <user-function process="&quot;PACTOLUS_ps_snmp_event&quot;" function="&quot;increment_event_counter&quot;" timeout="s_nTIMEOUT" return="" async="1" >
            <parameter >"dbase-error"</parameter>
          </user-function>
          <results >
            <result name="Default" link="25" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_bValidateAniFails = true;]]></script>
          </scripts>
        </action>
        <action id="27" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1034 y=1707 ?>
          <!--play Error, call CSR-->
          <function name="&quot;PlayCallCSR&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >g_oAPI.strCustomerServicePhone</parameter>
          </function>
          <results >
            <result name="Default" link="28" stubbed="0"/>
          </results>
        </action>
        <action id="28" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1430 y=1710 ?>
          <!--"PlayPromptAndHangup"-->
          <function name="&quot;PlayPromptAndHangup&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="15" stubbed="1"/>
          </results>
        </action>
        <action id="30" plug-in="Pactolus.SOAPMessage.1" ><?xtml-editor x=1429 y=1025 ?>
          <!--send JAVA ALARM-->
          <SOAP destination-ip="" transaction="" message-name="s_strSEND_ALARM_REQUEST" destination-port="" destination-type="1" destination-session="" waiting-session-selected="" >
            <parameter tag="&quot;calling_number&quot;" value="g_strAlarmType"/>
            <parameter tag="&quot;called_number&quot;" value="g_strAlarmPriority"/>
          </SOAP>
          <results >
            <result name="Default" link="31" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_strAlarmType = "JAVA: initialize session";
Session.g_strAlarmPriority = "MAJOR";]]></script>
          </scripts>
        </action>
        <action id="31" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1703 y=1057 ?>
          <!--"PostpaidAPIInitializeSession"-->
          <function name="&quot;PostpaidAPIInitializeSession&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_nErrorMsgNumber</parameter>
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nDIRECT_TO_MS;]]></script>
          </scripts>
        </action>
        <action id="32" plug-in="Pactolus.Branch.1" ><?xtml-editor x=907 y=1825 ?>
          <!--fail to validate ani-->
          <results >
            <result name="Default" link="39" stubbed="0"/>
            <result name="f_bValidateAcctAndPin" link="40" stubbed="0" >f_bValidateAcctAndPin == true</result>
            <result name="f_bCallCSR" link="60" stubbed="0" >f_bCallCSR == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (Session.g_oACD.strGreetEnabled == "T") 	{
		Session.f_bCallCSR = true;
		Session.g_oACD.nCSRRouteReasonCode = 1;  //greeting
		Session.f_bValidateAcctAndPin = false;
} else {
		Session.f_bCallCSR = false;
}



if(Session.g_oACD.strEnableFlag == "T" || Session.g_oAPI.strCustomerServicePhone != "") {
	
	Session.g_oACD.strPinZeroOut = "T";
	Session.g_oACD.strLanguageMenuZeroOut = "T";
	Session.g_oACD.strMainMenuZeroOut = "T";					
	
	if(Session.g_oACD.strCSROnMaxLoginsEnabled == "T" || Session.g_oAPI.strCustomerServicePhone != "") {
		Session.g_oACD.strPinMaxTimeouts = "T";		
		Session.g_oACD.strPinMaxInvalids = "T";
		Session.g_oACD.strMainMenuMaxInvalids = "T";
		Session.g_oACD.strLanguageMenuMaxInvalids = "T";	
	} // end if 

	// Settings Based on Customer
	Session.g_oACD.strDestMaxInvalids = "F";
	Session.g_oACD.strDestMaxTimeouts = "F";
	Session.g_oACD.strDestZeroOut = "F";		
			
	Session.g_oACD.strMainMenuMaxTimeouts = "F";
	Session.g_oACD.strLanguageMenuMaxTimeouts = "F";				

		
} // end strEnableFlag		



Server.logInfo("g_oACD.strPinZeroOut " + Session.g_oACD.strPinZeroOut);
Server.logInfo("g_oACD.strLanguageMenuZeroOut " + Session.g_oACD.strLanguageMenuZeroOut);
Server.logInfo("g_oACD.strMainMenuZeroOut " + Session.g_oACD.strMainMenuZeroOut);
Server.logInfo("g_oACD.strPinMaxTimeouts " + Session.g_oACD.strPinMaxTimeouts);
Server.logInfo("g_oACD.strPinMaxInvalids " + Session.g_oACD.strPinMaxInvalids);
Server.logInfo("g_oACD.strMainMenuMaxInvalids " + Session.g_oACD.strMainMenuMaxInvalids);
Server.logInfo("g_oACD.strLanguageMenuMaxInvalids " + Session.g_oACD.strLanguageMenuMaxInvalids);
Server.logInfo("g_oACD.strDestMaxInvalids " + Session.g_oACD.strDestMaxInvalids);
Server.logInfo("g_oACD.strDestMaxTimeouts " + Session.g_oACD.strDestMaxTimeouts);
Server.logInfo("g_oACD.strDestZeroOut " + Session.g_oACD.strDestZeroOut);
Server.logInfo("g_oACD.strMainMenuMaxTimeouts " + Session.g_oACD.strMainMenuMaxTimeouts);
Server.logInfo("g_oACD.strLanguageMenuMaxTimeouts " + Session.g_oACD.strLanguageMenuMaxTimeouts);]]></script>
          </scripts>
        </action>
        <action id="36" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=923 y=1182 ?>
          <!--"PostpaidAPIInitializeSession"-->
          <function name="&quot;psAPIInitializeSession&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
Session.g_oAPI.strValidateByANI = "1";
Session.f_bValidateAcctAndPin = true;
Session.g_nCurrentState = Session.s_nDIRECT_TO_MS;]]></script>
          </scripts>
        </action>
        <action id="37" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=917 y=1290 ?>
          <!--"PostpaidAPIInitializeSession"-->
          <function name="&quot;psAPIInitializeSession&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
Session.g_oAPI.strValidateByANI = "2";
Session.g_nCurrentState = Session.s_nDIRECT_TO_MS;
Session.g_bGetPinOnly = true;]]></script>
          </scripts>
        </action>
        <action id="38" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=917 y=1410 ?>
          <!--"PostpaidAPIInitializeSession"-->
          <function name="&quot;psAPIInitializeSession&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
Session.g_nCurrentState = Session.s_nDIRECT_TO_MS;]]></script>
          </scripts>
        </action>
        <action id="39" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1209 y=1841 ?>
          <!--get account and/or pin-->
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nGET_PIN;]]></script>
          </scripts>
        </action>
        <action id="40" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1197 y=1968 ?>
          <!--validate account and pin-->
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[//don't want to hear welcome prompt again
Session.g_bFirstTry = false;
Session.g_oSUB.strUserPin = Session.f_strAcctNumber + Session.f_strPinNumber;
Session.g_nCurrentState = Session.s_nAUTHENTICATE_PIN;]]></script>
          </scripts>
        </action>
        <action id="48" plug-in="Pactolus.Sleep.1" ><?xtml-editor x=525 y=226 ?>
          <!--s_fPostStartCallDelay secs-->
          <sleep duration="s_fPostStartCallDelay"/>
          <results >
            <result name="Default" link="16" stubbed="0"/>
          </results>
        </action>
        <action id="49" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=603 y=1916 ?>
          <!--"Begin3WayConference"-->
          <function name="&quot;Begin3WayConference&quot;" return="g_nCurrentState" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
          </scripts>
        </action>
        <action id="50" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=614 y=1800 ?>
          <!--"GetAndValidateConfDest"-->
          <function name="&quot;GetAndValidateConfDest&quot;" return="f_nReturnCode" external-function="0" library="" >
            <parameter >g_oMS</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (Session.s_sSUCCESS == Session.f_nReturnCode)
{
	Session.g_nCurrentState = Session.s_nBEGIN_3_WAY_CONF;
}
else
{
	Session.g_nCurrentState = Session.s_nEND_CALL;
}]]></script>
          </scripts>
        </action>
        <action id="54" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=592 y=2063 ?>
          <!--"RouteToCSR"-->
          <function name="&quot;RouteToCSR&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oMS</parameter>
            <parameter >g_oConferenceMS</parameter>
            <parameter >g_oMOHTimer</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
            <parameter >g_oMaxWaitCSRTimer</parameter>
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oTimerHeartBeat</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="27" stubbed="1"/>
            <result name="SUCCESS" link="14" stubbed="1" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
js_disable_event();]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (2 == Result.id)
{
	Session.g_nCurrentState = Session.s_nBEGINREQUEST;
}
js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="58" plug-in="Pactolus.Branch.1" ><?xtml-editor x=662 y=744 ?>
          <!--send info msg?-->
          <results >
            <result name="Default" link="14" stubbed="1"/>
            <result name="s_strSendInfoMsg==&quot;T&quot;" link="59" stubbed="0" >s_strSendInfoMsg match "T"</result>
          </results>
        </action>
        <action id="59" plug-in="Pactolus.SipInfo.1" ><?xtml-editor x=907 y=740 ?>
          <!--ON-->
          <element-tag increment-cseq-first="0" increment-cseq-last="1" >
            <call-id >g_oCallLegA.strCallId</call-id>
            <content >f_strContentON</content>
            <content-type >"application/dtmf"</content-type>
            <cseq >g_oCallLegA.strCSeq</cseq>
            <from >g_oCallLegA.strTo</from>
            <request-uri >g_oCallLegA.strRequestUri</request-uri>
            <to >g_oCallLegA.strFrom</to>
            <via >s_strVia</via>
          </element-tag>
          <results >
            <result name="Default" link="14" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
          </results>
        </action>
        <action id="60" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=1032 y=2084 ?>
          <!--please hold for csr-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="0" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >1501</audio>
          </play>
          <results >
            <result name="Default" link="1" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nROUTE_TO_CSR;
Session.g_oAPI.nStatePriorToCSR  = Session.s_nGET_PIN;]]></script>
          </scripts>
        </action>
        <action id="61" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=488 y=2300 ?>
          <!--ProcessCSRAttempt-->
          <function name="&quot;ProcessCSRAttempt&quot;" return="g_nReturnCode" external-function="1" library="lib_utils.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_nPromptHoldForCSR</parameter>
            <parameter >g_nPromptNotAllowed</parameter>
            <parameter >g_oMS</parameter>
            <parameter >s_oCSR_REASONS</parameter>
            <parameter >s_nTIMEOUT</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="1"/>
            <result name="make connection" link="62" stubbed="0" >g_nCurrentState == s_nMAKE_CONNECTION</result>
            <result name="g_nRC = 0, End Call" link="63" stubbed="0" >g_nReturnCode == 0
AND g_nCurrentState == s_nEND_CALL</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("g_oAPI.nStatePriorToCSR: " + Session.g_oAPI.nStatePriorToCSR);]]></script>
            <script language="javascript" timing="middle" ><![CDATA[Session.g_oACD.nCSRRouteReasonCode = Session.g_oACD.nCSRRouteReasonCodeTemp;

if(Session.g_nReturnCode == 1) {
	Session.g_nCurrentState = Session.s_nMAKE_CONNECTION;
} else if(Session.g_nReturnCode == 2) {
	Session.g_nCurrentState = Session.s_nROUTE_TO_CSR;	
} else if(Session.g_nReturnCode == 3) {
	Session.g_nCurrentState = Session.s_nEND_CALL;
} else if(Session.g_nReturnCode == 0) {
	if(Session.g_nNumRetry >= Session.g_oAPI.intMaxLoginAttempts) { 
		Session.g_nCurrentState = Session.s_nEND_CALL;
	} else {
		Session.g_nCurrentState = Session.g_oAPI.nStatePriorToCSR;
	}		
}

]]></script>
          </scripts>
        </action>
        <action id="62" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=709 y=2372 ?>
          <!--InitializeCallLeg for outdial-->
          <function name="&quot;InitializeCallLeg&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
        <action id="63" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=662 y=2540 ?>
          <!--"PlayPromptAndHangup"-->
          <function name="&quot;PlayPromptAndHangup&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="1" stubbed="1"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="OnInvite" start="115" event="OnInvite" returns="void" >
      <parameters >
        <parameter name="strAccept" type="string"/>
        <parameter name="strAcceptEncoding" type="string"/>
        <parameter name="strAcceptLanguage" type="string"/>
        <parameter name="strAlertInfo" type="string" pass="byref"/>
        <parameter name="strAllow" type="string" pass="byref"/>
        <parameter name="strAllowEvents" type="string" pass="byref"/>
        <parameter name="strAnonymity" type="string" pass="byref"/>
        <parameter name="strAuthorization" type="string"/>
        <parameter name="strCallId" type="string"/>
        <parameter name="strCallInfo" type="string" pass="byref"/>
        <parameter name="strContact" type="string"/>
        <parameter name="strContent" type="string"/>
        <parameter name="strContentDisposition" type="string"/>
        <parameter name="strContentEncoding" type="string" pass="byref"/>
        <parameter name="strContentLanguage" type="string" pass="byref"/>
        <parameter name="strContentType" type="string"/>
        <parameter name="strCSeq" type="string"/>
        <parameter name="strDate" type="string"/>
        <parameter name="strEncryption" type="string"/>
        <parameter name="strErrorInfo" type="string" pass="byref"/>
        <parameter name="strExpires" type="string"/>
        <parameter name="strFrom" type="string"/>
        <parameter name="strInReplyTo" type="string" pass="byref"/>
        <parameter name="strMaxForwards" type="string"/>
        <parameter name="strMIMEVersion" type="string" pass="byref"/>
        <parameter name="strMinSE" type="string" pass="byref"/>
        <parameter name="strOrganization" type="string" pass="byref"/>
        <parameter name="strPriority" type="string" pass="byref"/>
        <parameter name="strProxyAuthorization" type="string"/>
        <parameter name="strProxyRequire" type="string"/>
        <parameter name="strRecordRoute" type="string"/>
        <parameter name="strReferredBy" type="string" pass="byref"/>
        <parameter name="strRemotePartyId" type="string" pass="byref"/>
        <parameter name="strReplaces" type="string" pass="byref"/>
        <parameter name="strRequestUri" type="string"/>
        <parameter name="strRequire" type="string"/>
        <parameter name="strResponseKey" type="string"/>
        <parameter name="strRoute" type="string"/>
        <parameter name="strSessionExpires" type="string"/>
        <parameter name="strSubject" type="string"/>
        <parameter name="strSupported" type="string"/>
        <parameter name="strTimestamp" type="string"/>
        <parameter name="strTo" type="string"/>
        <parameter name="strUserAgent" type="string" pass="byref"/>
        <parameter name="strVia" type="string"/>
      </parameters>
      <local-vars >
        <var name="f_b_A_re_INVITE" type="boolean" >0</var>
        <var name="f_b_B_re_INVITE" type="boolean" >0</var>
        <var name="f_b_New_A_SDP" type="boolean" >0</var>
        <var name="f_b_New_B_SDP" type="boolean" >0</var>
        <var name="f_nReturnCode" type="i4" >-99</var>
        <var name="oTimer" type="object" ></var>
      </local-vars>
      <actions >
        <action id="115" plug-in="Pactolus.Branch.1" ><?xtml-editor x=66 y=541 ?>
          <!--New Call?-->
          <results >
            <result name="Default" link="116" stubbed="0"/>
            <result name="new call == true?" link="81" stubbed="0" >g_bNewCall == true</result>
          </results>
        </action>
        <action id="5" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=585 y=1313 ?>
          <!--send to Main function-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="118" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nVALIDATE_ANI;]]></script>
          </scripts>
        </action>
        <action id="28" plug-in="Pactolus.Branch.1" ><?xtml-editor x=536 y=1126 ?>
          <!--s_strTestModeFlag==T-->
          <results >
            <result name="Default" link="114" stubbed="1"/>
            <result name="s_strTestModeFlag==T" link="124" stubbed="0" >s_strTestModeFlag match "T"</result>
          </results>
        </action>
        <action id="32" plug-in="Pactolus.Branch.1" ><?xtml-editor x=822 y=525 ?>
          <!--re-INVTE from phone A or B?-->
          <results >
            <result name="Default" link="117" stubbed="1"/>
            <result name="From Phone A with new SDP" link="77" stubbed="0" >f_b_A_re_INVITE == true
AND f_b_New_A_SDP == true
AND g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true</result>
            <result name="From Phone B with new SDP" link="76" stubbed="0" >f_b_B_re_INVITE == true
AND f_b_New_B_SDP == true
AND g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true</result>
            <result name="From Phone A" link="88" stubbed="0" >f_b_A_re_INVITE == true
AND f_b_New_A_SDP == false
AND g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true</result>
            <result name="From Phone B" link="90" stubbed="0" >f_b_B_re_INVITE == true
AND f_b_New_B_SDP == false
AND g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true</result>
          </results>
        </action>
        <action id="62" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=994 y=1122 ?>
          <!--500 server error-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 500 Server Internal Error"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="119" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logError("TEST MODE, BUT FAIL TO GET TEST DATA");
Server.logError("RESPONSE WITH 500 Server Error");
Session.g_oAPI.nSessionTerminationReason = 5;]]></script>
          </scripts>
        </action>
        <action id="65" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1623 y=307 ?>
          <!--ReInviteB @ A SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oCallLegA.strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="94" stubbed="0"/>
          </results>
        </action>
        <action id="66" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1617 y=699 ?>
          <!--ReInviteA @ B SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="100" stubbed="0"/>
          </results>
        </action>
        <action id="69" plug-in="Standard.Timer.1" ><?xtml-editor x=1398 y=698 ?>
          <!--stop phoneA session timer-->
          <timer start="0" id="g_lTimerIdA" duration=""/>
          <results >
            <result name="Default" link="66" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerAFlag = false;]]></script>
          </scripts>
        </action>
        <action id="70" plug-in="Standard.Timer.1" ><?xtml-editor x=1388 y=309 ?>
          <!--stop PhoneB session timer-->
          <timer start="0" id="g_lTimerIdB" duration=""/>
          <results >
            <result name="Default" link="65" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerBFlag = false;]]></script>
          </scripts>
        </action>
        <action id="71" plug-in="Standard.Timer.1" ><?xtml-editor x=2092 y=684 ?>
          <!--reset PhoneA session timer-->
          <timer start="1" id="g_lTimerIdA" duration="g_nSessionExpiresA"/>
          <results >
            <result name="Default" link="86" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_lTimerIdA = 0;]]></script>
          </scripts>
        </action>
        <action id="72" plug-in="Standard.Timer.1" ><?xtml-editor x=2114 y=305 ?>
          <!--reset PhoneB session timer-->
          <timer start="1" id="g_lTimerIdB" duration="g_nSessionExpiresB"/>
          <results >
            <result name="Default" link="75" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_lTimerIdB = 0;]]></script>
          </scripts>
        </action>
        <action id="75" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=2366 y=299 ?>
          <!--200 OK SDP of B-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="118" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="76" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1189 y=613 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="80" stubbed="0"/>
            <result name="TimerAFlag==true" link="69" stubbed="0" >g_bTimerAFlag == true</result>
          </results>
        </action>
        <action id="77" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1141 y=233 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="79" stubbed="0"/>
            <result name="TimerBFlag==true" link="70" stubbed="0" >g_bTimerBFlag == true</result>
          </results>
        </action>
        <action id="79" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1381 y=172 ?>
          <!--ReInviteB @ A SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oCallLegA.strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="93" stubbed="0"/>
          </results>
        </action>
        <action id="80" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1403 y=585 ?>
          <!--ReInviteA @ B SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="99" stubbed="0"/>
          </results>
        </action>
        <action id="81" plug-in="Pactolus.Branch.1" ><?xtml-editor x=311 y=1131 ?>
          <!--use object-->
          <results >
            <result name="Default" link="28" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("CALLER CALL ID: " + Session.strCallId);
Session.g_bNewCall = false;
Session.g_oTestData.strConferenceTestFlag = "";
Session.g_oTestData.strPostpaidTestFlag = "";
Session.g_oTestData.strPrepaidTestFlag = "";
Session.g_oTestData.strTestDestinationNumber = "";
Session.g_oTestData.strTestInfoDigits = "";
Session.g_oTestData.strTestOriginationNumber = "";

//initialize object variables
js_initAPI(Session.g_oAPI);
Session.g_oAPI.strPostPaidFlag = "T";
js_initACD(Session.g_oACD);
Session.g_oACD.lCSRRequestSkillId = 3;
js_initRATE(Session.g_oRATE);
js_initSUB(Session.g_oSUB);
js_initCC(Session.g_oCreditCard);
js_initTimer(Session.g_oTimerGSXA);
js_initTimer(Session.g_oTimerGSXB);
js_initTimer(Session.g_oTimerHeartBeat);
js_initTimer(Session.g_oTimerMaxTime);
js_initTimer(Session.g_oTimerPhoneA);
js_initTimer(Session.g_oTimerThreshold1);
js_initTimer(Session.g_oTimerThreshold2);
js_initTimer(Session.g_oTimerThreshold3);
js_initTimer(Session.g_oMaxWaitCSRTimer);
js_initTimer(Session.g_oMOHTimer);
js_initTimer(Session.g_oPleaseHoldTimer);

js_initCallLeg(Session.g_oCallLegA);

//Ingress
var from_uri = new SipUrl(Session.strFrom)
if (from_uri.host == undefined)
{
	Session.g_oAPI.strGWIPIngress = Session.s_strPrimaryPSX;
}
else
{
	Session.g_oAPI.strGWIPIngress = from_uri.host;
}
if (from_uri.port == undefined)
{
	Session.g_oAPI.nGWPortIngress = 5060;
}
else
{
	Session.g_oAPI.nGWPortIngress = from_uri.port;
}
//Egress
var contact = new SipNameAddr(Session.strContact);
if (contact.url.host == undefined)
{
	Session.g_oAPI.strGWIPEgress = Session.s_strPrimaryPSX;
}
else
{
	Session.g_oAPI.strGWIPEgress = contact.url.host;
}
if (contact.url.port == undefined)
{
	Session.g_oAPI.nGWPortEgress = 5060;
}
else
{
	Session.g_oAPI.nGWPortEgress = contact.url.port;
}
// Phone A object
Session.g_oCallLegA.bReverseFromTo = true;
Session.g_oCallLegA.strFrom = Session.strFrom;
Session.g_oCallLegA.strTo = Session.strTo;
Session.g_oCallLegA.strCallId = Session.strCallId;
Session.g_oCallLegA.strContact = Session.strContact;
Session.g_oCallLegA.strContent = Session.strContent;
Session.g_oCallLegA.strOriginalContent = Session.strContent;
Session.g_oCallLegA.strContentType = Session.strContentType;
Session.g_oCallLegA.strCSeq = Session.strCSeq;
Session.g_oCallLegA.strRecordRoute = Session.strRecordRoute;
Session.g_oCallLegA.strRoute = Session.strRoute;
Session.g_oCallLegA.strVia = Session.strVia;
Session.g_oCallLegA.nSessionTimer = Number(Session.strSessionExpires);
Session.g_strOrigASDP = Session.strContent;
if (from_uri.otg == undefined)
{
	Session.g_oCallLegA.strOrigTrunkGroup = "";
}
else
{
	Session.g_oCallLegA.strOrigTrunkGroup = from_uri.otg;
}
Server.logInfo("CALLING js_calculate_uri_and_route");
Server.logInfo("BEFORE contact: " + Session.g_oCallLegA.strContact);
Server.logInfo("BEFORE record route: " + Session.g_oCallLegA.strRecordRoute);
Server.logInfo("BEFORE request Uri: " + Session.g_oCallLegA.strRequestUri);
Server.logInfo("BEFORE route: " + Session.g_oCallLegA.strRoute);
var bDialIn = true;
js_calculate_uri_and_route(bDialIn, Session.s_strSIPVERSION, Session.g_oCallLegA.strFrom, Session.g_oCallLegA.strContact, Session.g_oCallLegA.strRecordRoute, Session.g_oCallLegA.strRequestUri, Session.g_oCallLegA.strRoute);
Server.logInfo("AFTER contact: " + Session.g_oCallLegA.strContact);
Server.logInfo("AFTER record route: " + Session.g_oCallLegA.strRecordRoute);
Server.logInfo("AFTER request Uri: " + Session.g_oCallLegA.strRequestUri);
Server.logInfo("AFTER route: " + Session.g_oCallLegA.strRoute);
Server.logInfo("Call leg A request Uri is: " + Session.g_oCallLegA.strRequestUri);

Session.g_oCallLegA.nTearDownTime = 0;
if (Session.s_strSessionTimerFlag == "T")
{
	Session.g_oCallLegA.strSessionTimerFlag = Session.s_strSessionTimerFlag;
	Session.g_oCallLegA.nSessionTimer = Session.s_nSessionTimerInterval;
}
// if no ANI, use this default
var strANI = new String(from_uri.user);

if (from_uri.user == undefined ||
	strANI.length <= 0 ||
	strANI.indexOf("restricted") != -1 ||
	strANI.indexOf("Restricted") != -1	||
	strANI.indexOf("RESTRICTED")  != -1)
{
	Session.g_oAPI.strOriginationNumber = Session.s_strDEFAULT_ANI;
	Session.g_oCallLegA.strCallingNumber = Session.s_strDEFAULT_ANI;
	Session.g_oAPI.strUsedDefaultANIFlag = "T";
}
else
{
	Session.g_oCallLegA.strCallingNumber = from_uri.user;
	Session.g_oAPI.strOriginationNumber = from_uri.user;
}
// get dnis
var myUri = new SipRequestUri(Session.strRequestUri);
Session.g_oAPI.strAccessNumber = myUri.url.phoneNumber;
Server.logInfo("ACCESS NUMBER IS: " + Session.g_oAPI.strAccessNumber);

// set server contact
Session.s_strContact = "sip:" + Session.s_strLocalHost;
if( Server.sipPort != 5060 )
{
 Session.s_strContact += ":" + Server.sipPort;
}

Session.g_oAPI.strPlatformSessionId = Session._sessionId;
Session.g_oAPI.lPlatformSessionStartTime = Server.getUTCTime();

Server.logInfo("PLATFORM SESSION ID:  " + Session._sessionId);

//mediaserver object
js_initMS(Session.g_oMS, Session.s_strMSType);
//conference mediaserver object
js_initMS(Session.g_oConferenceMS, Session.s_strMSType);
Session.g_oConferenceMS.bDTMFClampFlag = false;
//MOH mediaserver object
js_initMS(Session.g_oMOH_MS, Session.s_strMSType);

if (Session.s_strMSRetryFlag == "T")
{
	Session.g_oMS.bRetry = true;
	Session.g_oConferenceMS.bRetry = true;
	Session.g_oMOH_MS.bRetry = true;
}
else
{
	Session.g_oMS.bRetry = false;
	Session.g_oConferenceMS.bRetry = false;
	Session.g_oMOH_MS.bRetry = false;
}]]></script>
          </scripts>
        </action>
        <action id="82" plug-in="Pactolus.Branch.1" ><?xtml-editor x=578 y=466 ?>
          <!--connected to ms?-->
          <results >
            <result name="Default" link="83" stubbed="0"/>
            <result name="parties are talking" link="32" stubbed="0" >g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true
AND g_oMS.bCurrentlyConnected == false</result>
            <result name="during outdial" link="92" stubbed="0" >g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == false
AND g_oMS.bCurrentlyConnected == false</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (0 == Clib.strcmpi(Session.strCallId, Session.g_oCallLegA.strCallId))
{
	Session.f_b_A_re_INVITE = true;
	var newCSeq = new SipCSeq(Session.strCSeq);
	var oldCSeq = new SipCSeq(Session.g_oCallLegA.strCSeq);

	if(newCSeq.value >= oldCSeq.value) 
	{
		newCSeq.increment() ;
		Session.g_oCallLegA.strCSeq = newCSeq.encode() ;
	}
	if (Clib.strcmpi(Session.strContent, Session.g_oCallLegA.strContent) != 0)
	{
		Session.f_b_New_A_SDP = true;
		Session.g_oCallLegA.strContent = Session.strContent;
		Session.g_oCallLegA.strOriginalContent = Session.strContent;
	}
}
else
{
	Session.f_b_B_re_INVITE = true;
	var newCSeq = new SipCSeq(Session.strCSeq);
	var oldCSeq = new SipCSeq(Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCSeq);

	if(newCSeq.value >= oldCSeq.value) 
	{
		newCSeq.increment() ;
		Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCSeq = newCSeq.encode() ;
	}
	if (Clib.strcmpi(Session.strContent, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContent) != 0)
	{
		Session.f_b_New_B_SDP = true;
		Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContent = Session.strContent;
	}
}]]></script>
          </scripts>
        </action>
        <action id="83" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=812 y=354 ?>
          <!--200 OK with ms SDP-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oMS.strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="118" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="86" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=2350 y=679 ?>
          <!--200 OK SDP of A-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="118" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="88" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=1200 y=807 ?>
          <!--200 OK SDP of B-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="118" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="90" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=1152 y=944 ?>
          <!--200 OK SDP of A-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oCallLegA.strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="118" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="92" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=846 y=721 ?>
          <!--200 OK SDP of hold A-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oCallLegA.strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="118" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="93" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1611 y=170 ?>
          <!--success?-->
          <results >
            <result name="Default" link="120" stubbed="0"/>
            <result name="success" link="75" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="94" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1854 y=302 ?>
          <!--success?-->
          <results >
            <result name="Default" link="120" stubbed="1"/>
            <result name="success" link="72" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="95" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=2773 y=225 ?>
          <!--Re-originate-->
          <function name="&quot;ReOriginate&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="118" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();
Session.f_b_A_re_INVITE = false;
Session.f_b_B_re_INVITE = false;
Session.f_b_New_A_SDP = false;
Session.f_b_New_B_SDP = false;]]></script>
          </scripts>
        </action>
        <action id="96" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=2271 y=141 ?>
          <!--"HangUpOutdialLegsWriteCDR"-->
          <function name="&quot;HangUpOutdialLegsWriteCDR&quot;" return="f_nReturnCode" external-function="0" library=""/>
          <results >
            <result name="Default" link="121" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 9;]]></script>
          </scripts>
        </action>
        <action id="98" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=2069 y=97 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="96" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();]]></script>
          </scripts>
        </action>
        <action id="99" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1638 y=569 ?>
          <!--success?-->
          <results >
            <result name="Default" link="123" stubbed="0"/>
            <result name="success" link="86" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="100" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1836 y=687 ?>
          <!--success?-->
          <results >
            <result name="Default" link="123" stubbed="1"/>
            <result name="success" link="71" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="102" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=2128 y=554 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="105" stubbed="0"/>
          </results>
        </action>
        <action id="105" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=2373 y=549 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="119" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 9;
Session.g_oAPI.nSessionTerminationReason = 11;]]></script>
          </scripts>
        </action>
        <action id="114" plug-in="Pactolus.Branch.1" ><?xtml-editor x=320 y=1321 ?>
          <!--js_utils 
strip non digit off phoneA, ANI, Dnis
strip leading 1 off Dnis-->
          <results >
            <result name="Default" link="5" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (Session.s_strTestModeFlag == "T")
{
	Session.g_oAPI.strInfoDigits = Session.g_oTestData.strTestInfoDigits;
}
else
{
	Session.g_oAPI.strInfoDigits = js_get_info_digits(Session.g_oCallLegA.strFrom);
	Server.logInfo("AFTER get info digits: <" + Session.g_oAPI.strInfoDigits + ">");
}]]></script>
          </scripts>
        </action>
        <action id="116" plug-in="Pactolus.Branch.1" ><?xtml-editor x=301 y=363 ?>
          <!--re-invite from A or B?-->
          <results >
            <result name="Default" link="117" stubbed="0"/>
            <result name="re-invite from A or B" link="82" stubbed="0" >strCallId match g_oCallLegA.strCallId
OR strCallId match g_oArrayCallLegs[g_nCurrentArrayIndex].strCallId</result>
          </results>
        </action>
        <action id="117" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=562 y=235 ?>
          <!--481 transaction does not exist-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 481 Call Leg/Transaction Does Not Exist"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="118" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logError("ERROR: GET REINVITE BUT TRANSACTION DOES NOT EXIST.");
Server.logError("ERROR: FROM : " + Session.strFrom);
Server.logError("ERROR: TO: " + Session.strTo);
Server.logError("ERROR: CALL ID : " + Session.strCallId);
Server.logError("ERROR: CSEQ: " + Session.strCSeq);
Server.logError("ERROR: CONTENT: " + Session.strContent);]]></script>
          </scripts>
        </action>
        <action id="118" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=775 y=237 ?>
          <return value=""/>
        </action>
        <action id="119" plug-in="Standard.EndSession.1" ><?xtml-editor x=2599 y=550 ?></action>
        <action id="120" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=1847 y=99 ?>
          <!--200 OK SDP of B-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="98" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logError("ERROR: FAIL TO REINVITE B.");]]></script>
          </scripts>
        </action>
        <action id="121" plug-in="Pactolus.Branch.1" ><?xtml-editor x=2516 y=139 ?>
          <!--success?-->
          <results >
            <result name="Default" link="122" stubbed="0"/>
            <result name="success" link="95" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="122" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=2764 y=117 ?>
          <!--Hang Up Phone  A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="119" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 5;]]></script>
          </scripts>
        </action>
        <action id="123" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=1892 y=510 ?>
          <!--200 OK SDP of A-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <content >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</content>
            <content-type >s_strContentType</content-type>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="102" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logError("ERROR: FAIL TO REINVITE A.");]]></script>
          </scripts>
        </action>
        <action id="124" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=767 y=1126 ?>
          <!--"APIGetTestData"-->
          <function name="&quot;APIGetTestData&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oTestData</parameter>
          </function>
          <results >
            <result name="Default" link="62" stubbed="0"/>
            <result name="success" link="114" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (0 == Session.f_nReturnCode)
{
	Session.g_oAPI.strOriginationNumber = Session.g_oTestData.strTestOriginationNumber;

	if (Session.g_oAPI.strOriginationNumber.charAt(0) == "+")
	{
		Session.g_oAPI.strIntlPrependFlag = "T";
	}
	
	if (Session.g_oAPI.strOriginationNumber == "undefined" ||
		Session.g_oAPI.strOriginationNumber == undefined ||
		Session.g_oAPI.strOriginationNumber.length <= 0 ||
		Session.g_oAPI.strOriginationNumber.indexOf("restricted") != -1 ||
		Session.g_oAPI.strOriginationNumber.indexOf("Restricted") != -1	||
		Session.g_oAPI.strOriginationNumber.indexOf("RESTRICTED")!= -1)
	{
		Session.g_oAPI.strOriginationNumber = Session.s_strDEFAULT_ANI;
		Session.g_oCallLegA.strCallingNumber = Session.s_strDEFAULT_ANI;
		Session.g_oAPI.strUsedDefaultANIFlag = "T";
	}	

	
}
else
{
	Server.logError("ERROR: FAIL TO GET TEST DATA");
}]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="AuthenticatePin" start="82" event="AuthenticatePin" returns="i4" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_fAmountLeft" type="float" >0</var>
      </local-vars>
      <actions >
        <action id="82" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=112 y=312 ?>
          <!--"PostpaidAPIAuthenticatePin"-->
          <function name="&quot;PostpaidAPIAuthenticatePin&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
          </function>
          <results >
            <result name="Default" link="72" stubbed="1"/>
            <result name="Success or First Use" link="80" stubbed="0" >f_nReturnCode == 0
OR f_nReturnCode == 2</result>
            <result name="Hangup" link="75" stubbed="0" >f_nReturnCode == -4
OR f_nReturnCode == -7
OR f_nReturnCode == -10</result>
            <result name="Get pin again" link="76" stubbed="0" >f_nReturnCode == -3
OR f_nReturnCode == -6
OR f_nReturnCode == -7</result>
            <result name="Pin locked" link="79" stubbed="0" >f_nReturnCode == -5
OR f_nReturnCode == -11</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("*********JAVA START AuthenticateSub *********");
Server.logInfo("DB Name : " + Session.g_oAPI.strProcDBName);
Server.logInfo("Platform Session ID : " + Session.g_oAPI.strPlatformSessionId);
Server.logInfo("Service Provider : " + Session.g_oAPI.lServiceProviderId);
Server.logInfo("Origination Number : " + Session.g_oAPI.strOriginationNumber);
Server.logInfo("Stripped Origination Number : " + Session.g_oAPI.strStrippedOrigNumber);
Server.logInfo("Pin number : " + Session.g_oSUB.strUserPin);
Server.logInfo("Max login attemps : " + Session.g_oAPI.nMaxLoginAttempts);
Server.logInfo("Number login attemps : " + Session.g_oAPI.nNumberLoginAttempts);
Server.logInfo("Origination Country : " + Session.g_oAPI.nOrigCountryId);
Server.logInfo("BEFORE: g_oAPI.fCreditLimit: " + Session.g_oAPI.fCreditLimit);
Server.logInfo("BEFORE: g_oAPI.fCreditUsed: " + Session.g_oAPI.fCreditUsed);
js_disable_event();]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("*********JAVA RETURN*********");
Server.logInfo("AuthenticateSub returned " + Session.f_nReturnCode);
Server.logInfo("Pin level language " + Session.g_oSUB.strPinLanguage);
Server.logInfo("BEFORE: g_oAPI.fCreditLimit: " + Session.g_oAPI.fCreditLimit);
Server.logInfo("BEFORE: g_oAPI.fCreditUsed: " + Session.g_oAPI.fCreditUsed);

if (Session.s_strIgnorePinLanguage == "F" && Session.g_oSUB.strPinLanguage.length > 0){
	Session.g_oAPI.strLanguage = Session.g_oSUB.strPinLanguage;
}else{
    Server.logInfo("ignoring pin level language, continue with access number language");
}
Session.g_nPromptToPlay = 0;
if (Session.f_nReturnCode != 0 && Session.f_nReturnCode != 2)
{
	switch (Session.f_nReturnCode)
	{
		case -99:
			Session.g_nErrorMsgNumber = 1001; //db error
			Session.g_oAPI.nSessionTerminationReason = 5;
			Server.logError("ERROR: FAIL TO AUTHENTICATE PIN, EXIT ON: " + Result.name);
			Server.logError("ERROR: AuthenticateSub returned " + Session.f_nReturnCode);
			break;
		case -2:
			Session.g_nErrorMsgNumber = 1003; //no service provider
			Session.g_oAPI.nSessionTerminationReason = 4;
			break;
		case -3:
			Session.g_nErrorMsgNumber = 1008; //insufficient digits
			Session.g_nPromptToPlay = 1253;
			break;
		case -4:
			Session.g_nErrorMsgNumber = 1005; //subscriber disable
			Session.g_nPromptToPlay = 506;
			Session.g_oAPI.nSessionTerminationReason = 3;
			break;
		case -5:
			Session.g_nErrorMsgNumber = 1011; //pin locked
			Session.g_nPromptToPlay = 338;			
			Session.g_oAPI.nSessionTerminationReason = 14;
			break;
		case -6:
			Session.g_nErrorMsgNumber = 1010; //pin does not exist
			Session.g_nPromptToPlay = 1253;
			break;
		case -7:
			Session.g_nErrorMsgNumber = 1012; //exceed max retry
			Session.g_nPromptToPlay = 1253;
			Session.g_oAPI.nSessionTerminationReason = 13;
			break;
		case -8:
			Session.g_nErrorMsgNumber = 1013; //no primary offering
			Session.g_oAPI.nSessionTerminationReason = 4;
			break;
		case -10:
			Session.g_nErrorMsgNumber = 1019; //ani authentication require
			Session.g_oAPI.nSessionTerminationReason = 1;
			Session.g_nPromptToPlay = 1253;
			break;
		case -11:
			Session.g_oAPI.nSessionTerminationReason = 16; // no more minutes
			Session.g_nPromptToPlay = 1296;
			Session.g_nErrorMsgNumber = 0;
			break;			
		case -12:
			Session.g_nErrorMsgNumber = 1021; //invalid access number
			Session.g_oAPI.nSessionTerminationReason = 17;
			break;
		case -13:
			Session.g_nErrorMsgNumber = 1022;
			Session.g_oAPI.nSessionTerminationReason = 18; // orig restricted
			break;				
		case -50:
			Session.g_nErrorMsgNumber = 1000; //jvm server error
			Session.g_oAPI.nSessionTerminationReason = 5;
			Server.logError("ERROR: FAIL TO AUTHENTICATE PIN, EXIT ON: " + Result.name);
			Server.logError("ERROR: AuthenticateSub returned " + Session.f_nReturnCode);
			break;
		default:
			Session.g_nErrorMsgNumber = 0;
			break;
	}
}
js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="15" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1127 y=341 ?>
          <!--return s_nGET_DESTINATION-->
          <return value="s_nGET_DESTINATION"/>
        </action>
        <action id="29" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=942 y=821 ?>
          <!--get pin-->
          <return value="s_nGET_PIN"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nTempInt = 0;
Session.g_nNumRetry++;]]></script>
          </scripts>
        </action>
        <action id="46" plug-in="Pactolus.Branch.1" ><?xtml-editor x=619 y=139 ?>
          <!--post prompt type?-->
          <results >
            <result name="Default" link="15" stubbed="1"/>
            <result name="g_oAPI.strPostPinPromptType==U" link="47" stubbed="0" >g_oAPI.strPostPinPromptType match "U"</result>
            <result name="PromptType = I &amp;&amp; index &gt; 0" link="71" stubbed="0" >g_oAPI.strPostPinPromptType match "I"
AND g_oAPI.nPostPinPromptIndex &gt; 0</result>
          </results>
        </action>
        <action id="47" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=876 y=114 ?>
          <!--Post Pin Prompt URL-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="url" >g_oAPI.strPostPinPromptUrl</audio>
          </play>
          <results >
            <result name="Default" link="15" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="71" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=894 y=338 ?>
          <!--Post Pin Prompt index-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_oAPI.nPostPinPromptIndex</audio>
          </play>
          <results >
            <result name="Default" link="15" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="72" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=653 y=924 ?>
          <!--play Error, call CSR-->
          <function name="&quot;PlayCallCSR&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >g_oAPI.strCustomerServicePhone</parameter>
          </function>
          <results >
            <result name="Default" link="73" stubbed="0"/>
          </results>
        </action>
        <action id="73" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=880 y=920 ?>
          <!--"PlayPromptAndHangup"-->
          <function name="&quot;PlayPromptAndHangup&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="74" stubbed="0"/>
          </results>
        </action>
        <action id="74" plug-in="Standard.EndSession.1" ><?xtml-editor x=1100 y=918 ?></action>
        <action id="75" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=400 y=386 ?>
          <!--play reason prompt-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="73" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="76" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=426 y=686 ?>
          <!--invalid pin-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="78" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="78" plug-in="Pactolus.Branch.1" ><?xtml-editor x=681 y=687 ?>
          <!--max retry-->
          <results >
            <result name="Default" link="94" stubbed="0"/>
            <result name="g_nMaxRetry &lt; g_oAPI.nMaxLoginAttempts" link="29" stubbed="0" >g_nNumRetry &lt; g_oAPI.nMaxLoginAttempts</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (2 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 13;
	Session.g_oAPI.nCallTerminationReason = 2;
}]]></script>
          </scripts>
        </action>
        <action id="79" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=410 y=927 ?>
          <!--pin in used or no more mintute-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="72" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="80" plug-in="Pactolus.Branch.1" ><?xtml-editor x=396 y=261 ?>
          <results >
            <result name="Default" link="46" stubbed="0"/>
            <result name="creditLimitFlag = T" link="81" stubbed="0" >g_oAPI.strCreditLimitFlag match "T"</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nNumRetry = 0;]]></script>
          </scripts>
        </action>
        <action id="81" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=620 y=307 ?>
          <!--You have used... ..minutes this month.-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >515</audio>
            <audio type="currency" >f_fAmountLeft</audio>
            <audio type="index" >1297</audio>
          </play>
          <results >
            <result name="Default" link="46" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if(Session.g_oAPI.strCreditLimitFlag == "T") {
	Session.g_oAPI.nMaxAllowedSeconds = Session.g_oSUB.nSecsRemaining;
}


Session.f_fAmountLeft = Session.g_oAPI.fCreditLimit - Session.g_oAPI.fCreditUsed;]]></script>
          </scripts>
        </action>
        <action id="94" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=939 y=592 ?>
          <!--g_nCurrentState-->
          <return value="g_nCurrentState"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[

Session.g_oAPI.nStatePriorToCSR = Session.s_nGET_PIN;
if(Session.g_bGetPinOnly) {
	Session.g_oSUB.strUserPin = "";	
	Session.g_oSUB.strAccountNumber = Session.g_strAuthenticationNbr;
} else {
	Session.g_oSUB.strUserPin = "";
	Session.g_oSUB.strAccountNumber = "";
}	


Session.g_nCurrentState = Session.s_nSTATE_PROC_CSR_ATTEMPT;
Session.g_oACD.nCSRRouteReasonCodeTemp = Session.s_nCSR_ROUTE_REASON_INVALID;	
Session.g_oACD.nCSRRouteReasonCode = Session.s_oCSR_REASONS.nPinInvalids;
Session.g_oAPI.nStatePriorToCSR  = Session.s_nGET_PIN;	]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="AuthorizeDestination" start="75" event="AuthorizeDestination" returns="i4" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_bCallCSR" type="boolean" >0</var>
        <var name="f_bIsDestValid" type="boolean" >0</var>
        <var name="f_bMainMenu" type="boolean" >0</var>
        <var name="f_bMissDial" type="boolean" >0</var>
      </local-vars>
      <actions >
        <action id="75" plug-in="Pactolus.Branch.1" ><?xtml-editor x=13 y=20 ?>
          <!--null string?-->
          <results >
            <result name="Default" link="63" stubbed="0"/>
            <result name="main menu" link="76" stubbed="0" >f_bMainMenu == true</result>
            <result name="missdial" link="28" stubbed="1" >f_bMissDial == true</result>
            <result name="invalid" link="62" stubbed="1" >f_bIsDestValid == false</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nNumRetry++;
Session.g_nErrorMsgNumber = 0;

if(Session.g_oAPI.strDestinationNumber.length <= 0) {

	Session.g_nPromptToPlay = 552; // I did not hear a response.
	Session.f_bIsDestValid = false;
	Session.g_oAPI.nSessionTerminationReason = 6;
	
} else if("*" == Session.g_strTerminationDigit && "*" == Session.g_oAPI.strDestinationNumber && "T" == Session.g_oAPI.strMainMenuFlag) {

	Session.f_bMainMenu = true; 	
	
} else if("*" == Session.g_strTerminationDigit) {

	Session.f_bMissDial = true;

} else if('0' == Session.g_oAPI.strDestinationNumber.charAt(0) && 1 == Session.g_oAPI.nDialingPlanId) {

		if ( '1' == Session.g_oAPI.strDestinationNumber.charAt(1) && '1' == Session.g_oAPI.strDestinationNumber.charAt(2)) {
			Session.f_bIsDestValid = true;
		} else {
			Session.f_bIsDestValid = false;
			Session.g_nPromptToPlay = 514;
		} // end if charAt(1) == 1, charAt(2) == 2;
		
} else {

	Session.f_bIsDestValid = true;
	
}]]></script>
          </scripts>
        </action>
        <action id="10" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1552 y=234 ?>
          <!--return s_nMAKE_CONNECTION-->
          <return value="s_nMAKE_CONNECTION"/>
        </action>
        <action id="25" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=753 y=536 ?>
          <!--s_nGET_DESTINATION;-->
          <return value="s_nGET_DESTINATION"/>
        </action>
        <action id="28" plug-in="Pactolus.Branch.1" ><?xtml-editor x=467 y=488 ?>
          <!--max retry-->
          <results >
            <result name="Default" link="59" stubbed="1"/>
            <result name="g_nMaxRetry &lt; g_oAPI.nMaxLoginAttempts" link="25" stubbed="0" >g_nNumRetry &lt; g_oAPI.nMaxLoginAttempts</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 13;]]></script>
          </scripts>
        </action>
        <action id="33" plug-in="Pactolus.Branch.1" ><?xtml-editor x=300 y=305 ?>
          <!--g_oAPI.strPostDestPromptType= U or I-->
          <results >
            <result name="Default" link="70" stubbed="1"/>
            <result name="DestPrompt==U" link="34" stubbed="0" >g_oAPI.strPostDestPromptType match "U"</result>
            <result name="DestPrompt==I, index&gt;0" link="61" stubbed="0" >g_oAPI.strPostDestPromptType match "I"
AND g_oAPI.nPostDestPromptIndex &gt; 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nNumRetry = 0;
Session.g_oAPI.strDestinationNumber = Session.g_oAPI.strOutdialDestNumber;]]></script>
          </scripts>
        </action>
        <action id="34" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=719 y=235 ?>
          <!--g_oAPI.strPostDestPromptUrl-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="url" >g_oAPI.strPostDestPromptUrl</audio>
          </play>
          <results >
            <result name="Default" link="70" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="58" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=280 y=128 ?>
          <!--play Error, call CSR-->
          <function name="&quot;PlayCallCSR&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >g_oAPI.strCustomerServicePhone</parameter>
          </function>
          <results >
            <result name="Default" link="59" stubbed="0"/>
          </results>
        </action>
        <action id="59" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=527 y=54 ?>
          <!--"PlayPromptAndHangup"-->
          <function name="&quot;PlayPromptAndHangup&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="60" stubbed="0"/>
          </results>
        </action>
        <action id="60" plug-in="Standard.EndSession.1" ><?xtml-editor x=733 y=59 ?></action>
        <action id="61" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=768 y=384 ?>
          <!--g_oAPI.nPostDestPromptIndex-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_oAPI.nPostDestPromptIndex</audio>
          </play>
          <results >
            <result name="Default" link="70" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="62" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=250 y=446 ?>
          <!--g_nPromptToPlay-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="28" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="63" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=12 y=201 ?>
          <!--"psAPIAuthorizeDestination"-->
          <function name="&quot;psAPIAuthorizeDestination&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegB</parameter>
            <parameter >g_oCallLegA</parameter>
          </function>
          <results >
            <result name="Default" link="58" stubbed="0"/>
            <result name="VALID DEST" link="33" stubbed="0" >f_nReturnCode == 0
OR f_nReturnCode == 1</result>
            <result name="INVALID DEST" link="62" stubbed="0" >f_nReturnCode == -3
OR f_nReturnCode == -4
OR f_nReturnCode == -8</result>
            <result name="LIMIT REACH" link="64" stubbed="0" >f_nReturnCode == -6</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("*********JAVA START AuthorizeDestination *********");
Server.logInfo("Platform Session Id : " + Session.g_oAPI.strPlatformSessionId);
Server.logInfo("DB Name : " + Session.g_oAPI.strProcDBName);
Server.logInfo("Calling Card Service Id : " + Session.g_oSUB.nServiceId);
Server.logInfo("Service Provider : " + Session.g_oAPI.lServiceProviderId);
Server.logInfo("Subscriber Id : " + Session.g_oSUB.lSubscriberId);
Server.logInfo("Origination Number : " + Session.g_oAPI.strOriginationNumber);
Server.logInfo("Stripped Origination Number : " + Session.g_oAPI.strStrippedOrigNumber);
Server.logInfo("Destination Number : " + Session.g_oAPI.strDestinationNumber);
Server.logInfo("Call Sequence : " + Session.g_oAPI.nCallSequence);
Server.logInfo("Info Digits : " + Session.g_oAPI.strInfoDigits);
Server.logInfo("Dialing Plan Id : " + Session.g_oAPI.nDialingPlanId);
Server.logInfo("Domestic Intl Flag : " + Session.g_oAPI.strOrigDomIntFlag);
Server.logInfo("Origin Country Id : " + Session.g_oAPI.nOrigCountryId);]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("*********JAVA RETURN*********");
Server.logInfo("AuthorizeDest returned " + Session.f_nReturnCode);
Session.g_nPromptToPlay = 0;
if (Session.f_nReturnCode != 0)
{
	switch (Session.f_nReturnCode)
	{
		case -99:
			Session.g_nErrorMsgNumber = 1001; //db error
			Session.g_oAPI.nSessionTerminationReason = 5;
			Server.logError("ERROR: FAIL TO AUTHORIZE DESTINATION, EXIT ON: " + Result.name);
			Server.logError("ERROR: AuthorizeDest returned " + Session.f_nReturnCode);
			break;
		case -3:
			Session.g_nErrorMsgNumber = 1007; //restricted dest
			Session.g_nPromptToPlay = 513;
			Server.logInfo("INFO: RESTRICTED DESTINATION");
			Server.logInfo("INFO: AuthorizeDest returned " + Session.f_nReturnCode);
			break;
		case -4:
			Session.g_nErrorMsgNumber = 1008; //insufficient digit
			Session.g_nPromptToPlay = 514;
			Server.logInfo("INFO: INSUFFICIENT DIGIT DESTINATION");
			Server.logInfo("INFO: AuthorizeDest returned " + Session.f_nReturnCode);
			break;
		case -5:
			Session.g_nErrorMsgNumber = 1014; //java exception error
			Session.g_oAPI.nSessionTerminationReason = 5;
			Server.logError("ERROR: FAIL TO AUTHORIZE DESTINATION, EXIT ON: " + Result.name);
			Server.logError("ERROR: AuthorizeDest returned " + Session.f_nReturnCode);
			break;
		case -8: // Not in Phone Me List
			Session.g_nErrorMsgNumber = 1007; //restricted dest
			Session.g_oAPI.nSessionTerminationReason = 5;
			Session.g_nPromptToPlay = 513;
			break;
		case -9:
			Session.g_nErrorMsgNumber = 2003; //no rate dest
			//Session.g_oAPI.nSessionTerminationReason = 5;
			Session.g_nPromptToPlay = 514;
			break;					
		case -50:
			Session.g_nErrorMsgNumber = 1000; //jvm server error
			Session.g_oAPI.nSessionTerminationReason = 5;
			Server.logError("ERROR: FAIL TO AUTHORIZE DESTINATION, EXIT ON: " + Result.name);
			Server.logError("ERROR: AuthorizeDest returned " + Session.f_nReturnCode);
			break;
		default:
			Session.g_nErrorMsgNumber = 0;
			break;
	}
}]]></script>
          </scripts>
        </action>
        <action id="64" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=251 y=597 ?>
          <!--LIMIT REACH-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >1296</audio>
          </play>
          <results >
            <result name="Default" link="59" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="70" plug-in="Pactolus.Branch.1" ><?xtml-editor x=990 y=223 ?>
          <results >
            <result name="Default" link="73" stubbed="0"/>
            <result name="creditLimitFlag = T" link="72" stubbed="0" >g_oAPI.strCreditLimitFlag match "T"</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nNumRetry = 0;]]></script>
          </scripts>
        </action>
        <action id="72" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1172 y=383 ?>
          <!--"PlayTimeAvailable"-->
          <function name="&quot;PlayTimeAvailable&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oSUB.nSecondsAnnounce</parameter>
            <parameter >g_oMS</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
          </function>
          <results >
            <result name="Default" link="73" stubbed="0"/>
          </results>
        </action>
        <action id="73" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1336 y=255 ?>
          <!--InitializeCallLeg for outdial-->
          <function name="&quot;InitializeCallLeg&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="10" stubbed="0"/>
          </results>
        </action>
        <action id="76" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=244 y=37 ?>
          <!--return s_nMAIN_MENU-->
          <return value="s_nMAIN_MENU"/>
        </action>
      </actions>
    </function>
    <function name="Connect" start="93" event="Connect" returns="i4" >
      <local-vars >
        <var name="f_sStatus" type="i2" >0</var>
        <var name="f_lStartTime" type="i8" >0</var>
        <var name="f_lEndTime" type="i8" >0</var>
        <var name="f_nDuration" type="i4" >0</var>
        <var name="f_nTimerAFirstTimer" type="i4" >60</var>
        <var name="f_nTimerBFirstTimer" type="i4" >60</var>
        <var name="f_nSUCCESS" type="i4" >0</var>
        <var name="f_nBUSY" type="i4" >2</var>
        <var name="f_nRINGNOANSWER" type="i4" >1</var>
        <var name="f_nDTMFINTERRUPTED" type="i4" >3</var>
        <var name="f_nCALLEDPARTYERROR" type="i4" >-2</var>
        <var name="f_nCALLINGPARTYERROR" type="i4" >-3</var>
        <var name="f_nOTHERERROR" type="i4" >-4</var>
        <var name="f_nRESOURCEUNAVAIL" type="i4" >-5</var>
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="93" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=14 y=20 ?>
          <!--Delete MS Connection-->
          <function name="&quot;DeleteMSConnection&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
          </function>
          <results >
            <result name="Default" link="115" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (Session.s_strTestModeFlag == "T")
{
	Session.g_oAPI.strDestinationNumber = Session.g_oTestData.strTestDestinationNumber;
}
Server.logInfo("BEFORE g_oAPI.strDestinationNumber prepend : <" + Session.g_oAPI.strDestinationNumber + " >");
Session.g_oAPI.strDestinationNumber = js_prepend_digits(Session.g_oAPI.strDestinationNumber, Session.s_strDigitPrependToOutdial);
Server.logInfo("AFTER g_oAPI.strDestinationNumber prepend : <" + Session.g_oAPI.strDestinationNumber + " >");]]></script>
          </scripts>
        </action>
        <action id="15" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=684 y=56 ?>
          <!--return s_nCONNECTED-->
          <return value="s_nCONNECTED"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (1 == Session.g_oAPI.nCurrentNumberCallLegs)
{
	Session.g_oAPI.nCurrentNumberCallLegs++;
}]]></script>
          </scripts>
        </action>
        <action id="30" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=729 y=441 ?>
          <!--s_nGET_DESTINATION-->
          <return value="s_nGET_DESTINATION"/>
        </action>
        <action id="54" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=20 y=736 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="120" stubbed="0"/>
          </results>
        </action>
        <action id="78" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=20 y=295 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="54" stubbed="1"/>
            <result name="SUCCESS" link="133" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (2 == Result.id)
{
	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

}]]></script>
          </scripts>
        </action>
        <action id="106" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=452 y=289 ?>
          <!--outdial from MS-->
          <function name="&quot;MSOutdialParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oMS</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="107" stubbed="0"/>
          </results>
        </action>
        <action id="107" plug-in="Pactolus.Branch.1" ><?xtml-editor x=669 y=284 ?>
          <!--SUCCESS?-->
          <results >
            <result name="Default" link="54" stubbed="1"/>
            <result name="SUCCESS?" link="125" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
            <result name="Caller hung up" link="120" stubbed="1" >f_nReturnCode == s_sCALLERHUNGUP</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (1 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 12;
}
else if (3 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 7;
}]]></script>
          </scripts>
        </action>
        <action id="113" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=475 y=162 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="120" stubbed="1"/>
          </results>
        </action>
        <action id="115" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=208 y=86 ?>
          <!--outdial-->
          <function name="&quot;OutdialParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oAPI.lTimeStart</parameter>
            <parameter >g_oAPI.lTimeAnswered</parameter>
            <parameter >g_oAPI.strSIPStatus</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="78" stubbed="0"/>
            <result name="SUCCESS" link="132" stubbed="0" >f_nReturnCode == f_nSUCCESS</result>
            <result name="CallingPartyError, other error, resource unavailable" link="113" stubbed="0" >f_nReturnCode == f_nCALLINGPARTYERROR
OR f_nReturnCode == f_nOTHERERROR
OR f_nReturnCode == f_nRESOURCEUNAVAIL</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCalledNumber = Session.g_oAPI.strDestinationNumber;
Session.g_oCallLegA.strContent = Session.g_oCallLegA.strOriginalContent;
Session.f_lStartTime = Server.getUTCTime();]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("********* OUTDIAL RETURN *********");
Server.logInfo("f_nReturnCode " + Session.f_nReturnCode);
Session.g_nPromptToPlay = 0;
switch (Session.f_nReturnCode)
{
	case 0:  //success
		Session.f_lEndTime = Server.getUTCTime();
		Session.f_nDuration = Session.f_lEndTime - Session.f_lStartTime;
		break;
	case 1:  //ring no answer
		Session.g_nPromptToPlay = 551;
		Session.g_oAPI.nCallTerminationReason = 8;
		break;
	case 2:  //busy
		Session.g_nPromptToPlay = 550;
		Session.g_oAPI.nCallTerminationReason = 7;
		break;
	case 3:  //DTMF interrupted
		Session.g_nPromptToPlay = 0;
		Session.g_oAPI.nCallTerminationReason = 5;
		break;
	case -3:  //calling party error
		Session.g_oAPI.nCallTerminationReason = 6;
		Session.g_oAPI.nSessionTerminationReason = 5;
		break;
	default:
		Session.g_nPromptToPlay = 549;
		Session.g_oAPI.nCallTerminationReason = 4;
		break;
}

var myUri = new SipRequestUri(Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);
if (myUri.url.dtg == undefined)
{
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestTrunkGroup = "";
}
else
{
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestTrunkGroup = myUri.url.dtg;
}
Server.logInfo("CALLING js_calculate_uri_and_route");
Server.logInfo("BEFORE contact: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContact);
Server.logInfo("BEFORE record route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRecordRoute);
Server.logInfo("BEFORE request Uri: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);
Server.logInfo("BEFORE route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRoute);
var bDialIn = false;
js_calculate_uri_and_route(bDialIn, Session.s_strSIPVERSION, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strFrom, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContact, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRecordRoute, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRoute);
Server.logInfo("AFTER contact: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContact);
Server.logInfo("AFTER record route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRecordRoute);
Server.logInfo("AFTER request Uri: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);
Server.logInfo("AFTER route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRoute);
Server.logInfo("Call leg B request Uri is: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);
var myUri = new SipRequestUri(Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);
Session.g_oAPI.strGWIPEgress = myUri.url.host;
Session.g_oAPI.nGWPortEgress = myUri.url.port;
]]></script>
          </scripts>
        </action>
        <action id="120" plug-in="Standard.EndSession.1" ><?xtml-editor x=255 y=778 ?></action>
        <action id="123" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=190 y=570 ?>
          <!--g_nPromptToPlay-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="129" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="125" plug-in="Pactolus.Branch.1" ><?xtml-editor x=7 y=451 ?>
          <!--play prompt?-->
          <results >
            <result name="Default" link="129" stubbed="0"/>
            <result name="g_nPromptToPlay &gt; 0" link="123" stubbed="0" >g_nPromptToPlay &gt; 0</result>
          </results>
        </action>
        <action id="129" plug-in="Pactolus.Branch.1" ><?xtml-editor x=404 y=452 ?>
          <!--outdial csr?-->
          <results >
            <result name="Default" link="30" stubbed="0"/>
            <result name="g_oAPI.strOutdialOperatorFlag==T" link="130" stubbed="0" >g_oAPI.strOutdialOperatorFlag match "T"</result>
          </results>
        </action>
        <action id="130" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=643 y=554 ?>
          <!--could not reach csr-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >1503</audio>
          </play>
          <results >
            <result name="Default" link="54" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="132" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=468 y=29 ?>
          <!--SetTimers-->
          <function name="&quot;SetTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oTimer</parameter>
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerGSXB</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >s_strSessionTimerFlag</parameter>
            <parameter >g_oAPI.strOutdialOperatorFlag</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >f_nDuration</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="15" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[// init. timers

js_initTimer(Session.g_oTimerThreshold1);
js_initTimer(Session.g_oTimerThreshold2);
js_initTimer(Session.g_oTimerThreshold3);
js_initTimer(Session.g_oTimerPhoneA);
js_initTimer(Session.g_oTimerMaxTime);

Session.g_oTimerThreshold1.nThresholdTime = Session.g_oAPI.nWarningThreshold1;
Session.g_oTimerThreshold2.nThresholdTime = Session.g_oAPI.nWarningThreshold2;
Session.g_oTimerThreshold3.nThresholdTime = Session.g_oAPI.nWarningThreshold3;
Server.logInfo("THRESHOLD TIMER 1: " + Session.g_oTimerThreshold1.nThresholdTime);
Server.logInfo("THRESHOLD TIMER 2: " + Session.g_oTimerThreshold2.nThresholdTime);
Server.logInfo("THRESHOLD TIMER 3: " + Session.g_oTimerThreshold3.nThresholdTime);

Session.g_oTimerPhoneA.lSleepTime = Session.g_oCallLegA.initSessionTimer;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oTimer.lSleepTime = Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].nSessionTimer;


if (Session.g_oSUB.nSecondsAvailable > 0)
{
	Session.g_oTimerMaxTime.lSleepTime = Session.g_oSUB.nSecondsAvailable;
}
else if (Session.g_oAPI.nMaxAllowedSeconds > 0)
{
	Session.g_oTimerMaxTime.lSleepTime =  Session.g_oAPI.nMaxAllowedSeconds;
}
else
{
	Session.g_oTimerMaxTime.lSleepTime = 4294967;
	Server.logInfo("INFO: BOTH SECOND AVAILABLE AND MAX ALLOW SECONDS EQUAL ZERO");
}]]></script>
          </scripts>
        </action>
        <action id="133" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=238 y=293 ?>
          <!--put A on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="106" stubbed="0"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="OnBye" start="1" event="OnBye" returns="void" >
      <parameters >
        <parameter name="strAccept" type="string"/>
        <parameter name="strAcceptEncoding" type="string"/>
        <parameter name="strAcceptLanguage" type="string"/>
        <parameter name="strAllow" type="string" pass="byref"/>
        <parameter name="strAllowEvents" type="string" pass="byref"/>
        <parameter name="strAuthorization" type="string"/>
        <parameter name="strCallId" type="string"/>
        <parameter name="strCSeq" type="string"/>
        <parameter name="strDate" type="string"/>
        <parameter name="strEncryption" type="string"/>
        <parameter name="strErrorInfo" type="string" pass="byref"/>
        <parameter name="strFrom" type="string"/>
        <parameter name="strMaxForwards" type="string"/>
        <parameter name="strMIMEVersion" type="string" pass="byref"/>
        <parameter name="strProxyAuthorization" type="string"/>
        <parameter name="strProxyRequire" type="string"/>
        <parameter name="strRecordRoute" type="string"/>
        <parameter name="strReferredBy" type="string" pass="byref"/>
        <parameter name="strRequestUri" type="string"/>
        <parameter name="strRequire" type="string"/>
        <parameter name="strResponseKey" type="string"/>
        <parameter name="strRoute" type="string"/>
        <parameter name="strSupported" type="string"/>
        <parameter name="strTimestamp" type="string"/>
        <parameter name="strTo" type="string"/>
        <parameter name="strUserAgent" type="string" pass="byref"/>
        <parameter name="strVia" type="string"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=9 y=32 ?>
          <!--reponse 200 OK-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="40" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.enableEvents( false );]]></script>
          </scripts>
        </action>
        <action id="6" plug-in="Pactolus.Branch.1" ><?xtml-editor x=423 y=44 ?>
          <!--BYE from 
phone A or Phone B-->
          <results >
            <result name="Default" link="60" stubbed="1"/>
            <result name="from phoneA" link="33" stubbed="1" >strCallId match g_oCallLegA.strCallId</result>
          </results>
        </action>
        <action id="28" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1372 y=634 ?>
          <!--Re-originate-->
          <function name="&quot;ReOriginate&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="29" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="29" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1579 y=675 ?>
          <return value=""/>
        </action>
        <action id="30" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=765 y=248 ?>
          <!--"HangUpOutdialLegsWriteCDR"-->
          <function name="&quot;HangUpOutdialLegsWriteCDR&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="53" stubbed="1"/>
          </results>
        </action>
        <action id="33" plug-in="Pactolus.Branch.1" ><?xtml-editor x=20 y=217 ?>
          <!--connected?-->
          <results >
            <result name="Default" link="53" stubbed="0"/>
            <result name="g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true?" link="71" stubbed="0" >g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true</result>
            <result name="g_oArrayCallLegs[g_nCurrentArrayIndex].bCurrentlyDialing == true?" link="52" stubbed="0" >g_oArrayCallLegs[g_nCurrentArrayIndex].bCurrentlyDialing == true</result>
            <result name="ACD.bCSRWithAB" link="75" stubbed="0" >g_oACD.bCSRWithAB == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 7;
Session.g_oAPI.nCallTerminationReason = 2;]]></script>
          </scripts>
        </action>
        <action id="34" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=165 y=730 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="40" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=210 y=51 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="6" stubbed="0"/>
          </results>
        </action>
        <action id="45" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=673 y=543 ?>
          <!--call callCompletion()-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="55" stubbed="0"/>
            <result name="SUCCESS" link="57" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
Session.g_oAPI.nCallTerminationReason = 1;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (2 == Result.id)
{
	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

}

Server.logInfo("Reset lCSRAssignmentId and lCSRUserId.");
Session.g_oACD.lCSRAssignmentId = 0;
Session.g_oACD.lCSRUserId = 0;	

]]></script>
          </scripts>
        </action>
        <action id="52" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=496 y=358 ?>
          <!--Cancel PartyB-->
          <function name="&quot;CancelParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="59" stubbed="0"/>
          </results>
        </action>
        <action id="53" plug-in="Standard.EndSession.1" ><?xtml-editor x=418 y=161 ?></action>
        <action id="55" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=940 y=508 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="56" stubbed="0"/>
          </results>
        </action>
        <action id="56" plug-in="Standard.EndSession.1" ><?xtml-editor x=1163 y=520 ?>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 5;]]></script>
          </scripts>
        </action>
        <action id="57" plug-in="Pactolus.Branch.1" ><?xtml-editor x=917 y=622 ?>
          <!--outdial csr?-->
          <results >
            <result name="Default" link="62" stubbed="0"/>
            <result name="g_oAPI.strOutdialOperatorFlag==T" link="58" stubbed="0" >g_oAPI.strOutdialOperatorFlag match "T"</result>
          </results>
        </action>
        <action id="58" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1075 y=758 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="56" stubbed="1"/>
          </results>
        </action>
        <action id="59" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=741 y=408 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="30" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}
	

	Server.logInfo("Reset lCSRAssignmentId and lCSRUserId.");
	Session.g_oACD.lCSRAssignmentId = 0;
	Session.g_oACD.lCSRUserId = 0;	

	
	]]></script>
          </scripts>
        </action>
        <action id="60" plug-in="Pactolus.Branch.1" ><?xtml-editor x=19 y=531 ?>
          <!--find which call leg hangup in array-->
          <results >
            <result name="Default" link="70" stubbed="0"/>
            <result name="g_nArrayIndex == -1?" link="34" stubbed="0" >g_nCurrentArrayIndex == -1</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentArrayIndex = -1;
Server.logInfo("CALL LEG ARRAY LENGTH IS : " + Session.g_oArrayCallLegs.length);
Server.logInfo("search call leg id from array");
Server.logInfo("Before search, array index is: " + Session.g_nCurrentArrayIndex);
Session.g_nCurrentArrayIndex = js_search_callid(Session.g_oArrayCallLegs, Session.strCallId);
Server.logInfo("After search, array index is: " + Session.g_nCurrentArrayIndex);
if (-1 == Session.g_nCurrentArrayIndex)
{
	Server.logInfo("WARNING: CAN'T FIND CALL ID IN CALL LEG ARRAY.");
}
else
{
	Server.logInfo("FOUND THE CALL ID IN CALL LEG ARRAY, AT INDEX: " + Session.g_nCurrentArrayIndex);
}]]></script>
          </scripts>
        </action>
        <action id="62" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1139 y=606 ?>
          <!--more call legs?-->
          <results >
            <result name="Default" link="28" stubbed="0"/>
            <result name="g_oArrayCallLegs.length  == 1?" link="64" stubbed="1" >g_oArrayCallLegs.length == 1</result>
            <result name="g_oArrayCallLegs.length &gt; 1?" link="29" stubbed="1" >g_oArrayCallLegs.length &gt; 1</result>
          </results>
        </action>
        <action id="63" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=279 y=867 ?>
          <!--put B on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="55" stubbed="1"/>
            <result name="SUCCESS" link="65" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
Session.g_nCurrentArrayIndex = Session.g_oArrayCallLegs.length - 1;]]></script>
          </scripts>
        </action>
        <action id="64" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=21 y=857 ?>
          <!--put A on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="29" stubbed="1"/>
            <result name="SUCCESS" link="63" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
          </scripts>
        </action>
        <action id="65" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=521 y=867 ?>
          <!--ReInviteA @ B SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="55" stubbed="1"/>
            <result name="SUCCESS" link="66" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
//back up
Session.f_strFrom = Session.g_oCallLegA.strFrom;
Session.f_strTo = Session.g_oCallLegA.strTo;
//reverse
Session.g_oCallLegA.strFrom = Session.f_strTo;
Session.g_oCallLegA.strTo = Session.f_strFrom;]]></script>
            <script language="javascript" timing="last" ><![CDATA[//restored
Session.g_oCallLegA.strFrom = Session.f_strFrom;
Session.g_oCallLegA.strTo = Session.f_strTo;]]></script>
          </scripts>
        </action>
        <action id="66" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=25 y=991 ?>
          <!--ReInviteB @ A SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oCallLegA.strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="55" stubbed="1"/>
            <result name="SUCCESS" link="67" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
          </scripts>
        </action>
        <action id="67" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=262 y=1006 ?>
          <!--Remove A from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="68" stubbed="0"/>
          </results>
        </action>
        <action id="68" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=485 y=1006 ?>
          <!--Remove B from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
          </function>
          <results >
            <result name="Default" link="72" stubbed="0"/>
          </results>
        </action>
        <action id="70" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=231 y=545 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
          </function>
          <results >
            <result name="Default" link="73" stubbed="0"/>
          </results>
        </action>
        <action id="71" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=498 y=240 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="30" stubbed="0"/>
          </results>
        </action>
        <action id="72" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=706 y=1002 ?>
          <!--"DeleteConference"-->
          <function name="&quot;DeleteConference&quot;" return="" external-function="1" library="lib_mediaserver.xml" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="29" stubbed="1"/>
          </results>
        </action>
        <action id="73" plug-in="Pactolus.Branch.1" ><?xtml-editor x=441 y=568 ?>
          <results >
            <result name="Default" link="45" stubbed="0"/>
            <result name="true == g_oACD.bCSRWithAB" link="76" stubbed="0" >g_oACD.bCSRWithAB == true</result>
          </results>
        </action>
        <action id="74" plug-in="Pactolus.SOAPMessage.1" ><?xtml-editor x=616 y=710 ?>
          <!--"CSROutdialBLegHangup"-->
          <SOAP destination-ip="g_oACD.strACDControllerIP" transaction="g_oACD.strTransactionId" message-name="&quot;CSROutdialBLegHangup&quot;" destination-port="g_oACD.nACDControllerPort" destination-type="4" destination-session="" waiting-session-selected="" >
            <parameter tag="&quot;AssignmentId&quot;" value="g_oACD.lCSRAssignmentId"/>
          </SOAP>
          <results >
            <result name="Default" link="34" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if(Session.g_oACD.bCSRWithAB == true) {
	Session.g_oACD.bCSRWithAB = false;
}
if (2 == Result.id)
{
	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}
}]]></script>
          </scripts>
        </action>
        <action id="75" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=340 y=443 ?>
          <!--Hang Up Phone B-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="59" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.lTimeAnswered = 0;
]]></script>
          </scripts>
        </action>
        <action id="76" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=419 y=707 ?>
          <!--call callCompletion()-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="74" stubbed="0"/>
            <result name="Success" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 1;
Session.g_oAPI.lTimeAnswered = 0;]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnTimer" start="87" event="OnTimer" returns="void" >
      <parameters >
        <parameter name="nTimerId" type="i4"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-99</var>
        <var name="f_lCurrentTime" type="i8" >0</var>
        <var name="f_bGetReInviteOnTime" type="boolean" >0</var>
        <var name="f_strEndPoint" type="string" ></var>
        <var name="f_strConnectionId" type="string" ></var>
        <var name="f_strCallId" type="string" ></var>
        <var name="f_strMSType" type="string" ></var>
        <var name="f_oTimer" type="object" ></var>
        <var name="f_oMS" type="object" ></var>
        <var name="f_oTempObject" type="object" ></var>
      </local-vars>
      <actions >
        <action id="87" plug-in="Pactolus.Branch.1" ><?xtml-editor x=135 y=172 ?>
          <results >
            <result name="Default" link="86" stubbed="0"/>
            <result name="arrayCallLegs.length == 0" link="88" stubbed="0" >g_oArrayCallLegs.length == 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("THIS TIMER ID OCCURES : " + Session.nTimerId);
js_disable_event();
js_initMS(Session.f_oMS, Session.s_strMSType);
if (true == Session.g_oConferenceMS.bCurrentlyInConf)
{
	Session.f_oMS = Session.g_oConferenceMS;
}
else if (true == Session.g_oMOH_MS.bCurrentlyInConf || true == Session.g_oMOH_MS.bCurrentlyConnected)
{
	Session.f_oMS = Session.g_oMOH_MS;
}
else
{
	Session.f_oMS = Session.g_oMS;
}

if(Session.g_oTimerThreshold1.lTimerId == Session.nTimerId) {
	Session.f_oTimer = Session.g_oTimerThreshold1;
} else if(Session.g_oTimerThreshold2.lTimerId == Session.nTimerId) {
	Session.f_oTimer = Session.g_oTimerThreshold2;
} else if(Session.g_oTimerThreshold3.lTimerId == Session.nTimerId) {
	Session.f_oTimer = Session.g_oTimerThreshold3;
}
js_initTimerPrompts(Session.g_oTimerPrompts);]]></script>
          </scripts>
        </action>
        <action id="11" plug-in="Pactolus.Branch.1" ><?xtml-editor x=295 y=494 ?>
          <!--which timer?-->
          <results >
            <result name="Default" link="40" stubbed="0"/>
            <result name="g_lTimerA" link="48" stubbed="0" >nTimerId == g_lTimerIdA</result>
            <result name="g_lTimerB" link="49" stubbed="0" >nTimerId == g_lTimerIdB</result>
            <result name="g_lTimerId1" link="52" stubbed="0" >nTimerId == g_lTimerId1</result>
            <result name="g_lTimerIdThresholds" link="46" stubbed="0" >nTimerId == g_lTimerIdThreshold</result>
            <result name="g_lCkReInviteTimerIdA" link="71" stubbed="0" >nTimerId == g_lCkReInviteTimerIdA</result>
            <result name="Connect to MOH" link="74" stubbed="0" >nTimerId == g_oMOHTimer.lTimerId</result>
            <result name="Please Hold" link="77" stubbed="0" >nTimerId == g_oPleaseHoldTimer.lTimerId</result>
            <result name="MaxWaitCSR" link="78" stubbed="0" >nTimerId == g_oMaxWaitCSRTimer.lTimerId</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("THIS TIMER ID OCCURES : " + Session.nTimerId);
js_disable_event();]]></script>
          </scripts>
        </action>
        <action id="22" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=967 y=892 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="67" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 3;
Session.g_oAPI.nSessionTerminationReason = 8;]]></script>
          </scripts>
        </action>
        <action id="40" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=683 y=390 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("INFO: NOT A TIMER THE APP IS EXPECTING.");
js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="46" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=722 y=1017 ?>
          <!--Play Threshold promp-->
          <function name="&quot;PlayThresholdPrompt&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_nTempInt</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oAPI</parameter>
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerGSXB</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oTimer</parameter>
            <parameter >g_oTimerPrompts</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="40" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nTempInt = 2;]]></script>
          </scripts>
        </action>
        <action id="48" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=745 y=466 ?>
          <!--re-inviteA @ B SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="56" stubbed="0"/>
          </results>
        </action>
        <action id="49" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=746 y=705 ?>
          <!--re-inviteB @ A SDP-->
          <function name="&quot;ReInviteParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oCallLegA.strContent</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="60" stubbed="0"/>
          </results>
        </action>
        <action id="52" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=732 y=851 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="22" stubbed="0"/>
          </results>
        </action>
        <action id="54" plug-in="Standard.Timer.1" ><?xtml-editor x=1213 y=562 ?>
          <!--reset PhoneA session timer-->
          <timer start="1" id="g_lTimerIdA" duration="g_nSessionExpiresA"/>
          <results >
            <result name="Default" link="40" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_lTimerIdA = 0;]]></script>
          </scripts>
        </action>
        <action id="55" plug-in="Standard.Timer.1" ><?xtml-editor x=1209 y=789 ?>
          <!--reset PhoneB session timer-->
          <timer start="1" id="g_lTimerIdB" duration="g_nSessionExpiresB"/>
          <results >
            <result name="Default" link="40" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_lTimerIdB = 0;]]></script>
          </scripts>
        </action>
        <action id="56" plug-in="Pactolus.Branch.1" ><?xtml-editor x=969 y=464 ?>
          <!--success?-->
          <results >
            <result name="Default" link="57" stubbed="0"/>
            <result name="success" link="54" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="57" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1196 y=463 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="65" stubbed="0"/>
          </results>
        </action>
        <action id="60" plug-in="Pactolus.Branch.1" ><?xtml-editor x=968 y=706 ?>
          <!--success?-->
          <results >
            <result name="Default" link="64" stubbed="0"/>
            <result name="success" link="55" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="61" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1868 y=789 ?>
          <!--Re-originate-->
          <function name="&quot;ReOriginate&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="40" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="62" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1413 y=674 ?>
          <!--"HangUpOutdialLegsWriteCDR"-->
          <function name="&quot;HangUpOutdialLegsWriteCDR&quot;" return="f_nReturnCode" external-function="0" library=""/>
          <results >
            <result name="Default" link="70" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 9;]]></script>
          </scripts>
        </action>
        <action id="64" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1201 y=679 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="62" stubbed="0"/>
          </results>
        </action>
        <action id="65" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1409 y=459 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="67" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 9;
Session.g_oAPI.nSessionTerminationReason = 11;]]></script>
          </scripts>
        </action>
        <action id="67" plug-in="Standard.EndSession.1" ><?xtml-editor x=1620 y=458 ?></action>
        <action id="69" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1846 y=666 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="67" stubbed="1"/>
          </results>
        </action>
        <action id="70" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1617 y=669 ?>
          <!--success?-->
          <results >
            <result name="Default" link="69" stubbed="0"/>
            <result name="success" link="61" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="71" plug-in="Pactolus.Branch.1" ><?xtml-editor x=709 y=1137 ?>
          <!--Get ReInvite On Time?-->
          <results >
            <result name="Default" link="57" stubbed="1"/>
            <result name="f_bGetReInviteOnTime==true" link="40" stubbed="1" >f_bGetReInviteOnTime == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_lCurrentTime = Server.getUTCTime();
if ( (Session.f_lCurrentTime - Session.g_lLastReInviteTimeA) > (Session.g_oCallLegA.nSessionTimer + 60) )
{
	Session.f_bGetReInviteOnTime = false;
}
else
{
	Session.f_bGetReInviteOnTime = true;
	Session.g_lLastReInviteTimeA = Server.getUTCTime();
}]]></script>
          </scripts>
        </action>
        <action id="74" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=694 y=1249 ?>
          <!--"ConnectToMOH"-->
          <function name="&quot;ConnectToMOH&quot;" return="" external-function="1" library="lib_moh.xml" >
            <parameter >g_oMOH_MS</parameter>
            <parameter >g_oAPI</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_strMOH_SessionId</parameter>
            <parameter >g_nMOH_ConfIndex</parameter>
            <parameter >g_oMOH_MS.strConferenceId</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
          </function>
          <results >
            <result name="Default" link="40" stubbed="1"/>
          </results>
        </action>
        <action id="77" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=685 y=1366 ?>
          <!--continue to hold-->
          <play connection-id="f_strConnectionId" endpoint="f_strEndPoint" callid="f_strCallId" repeat="1" timeout="10" ms-type="f_strMSType" returns="" start-play="1" interrupt="0" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >904</audio>
          </play>
          <results >
            <result name="Default" link="85" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (true == Session.g_oMOH_MS.bCurrentlyConnected || true == Session.g_oMOH_MS.bCurrentlyInConf)
{
	Session.f_strCallId = Session.g_oMOH_MS.strCallId;
	Session.f_strConnectionId = Session.g_oMOH_MS.strConnectionId;
	Session.f_strEndPoint = Session.g_oMOH_MS.strEndPoint;
	Session.f_strMSType = Session.g_oMOH_MS.strType;
}
else if (true == Session.g_oMS.bCurrentlyConnected || true == Session.g_oMS.bCurrentlyInConf)
{
	Session.f_strCallId = Session.g_oMS.strCallId;
	Session.f_strConnectionId = Session.g_oMS.strConnectionId;
	Session.f_strEndPoint = Session.g_oMS.strEndPoint;
	Session.f_strMSType = Session.g_oMS.strType;
}
else
{
	Session.f_strCallId = Session.g_oConferenceMS.strCallId;
	Session.f_strConnectionId = Session.g_oConferenceMS.strConnectionId;
	Session.f_strEndPoint = Session.g_oConferenceMS.strEndPoint;
	Session.f_strMSType = Session.g_oConferenceMS.strType;
}
]]></script>
          </scripts>
        </action>
        <action id="78" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=631 y=1538 ?>
          <!--Soap EndRequest-->
          <function name="&quot;MsgEndRequestCSR&quot;" return="" external-function="1" library="lib_soap.xml" >
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="79" stubbed="0"/>
          </results>
        </action>
        <action id="79" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=861 y=1534 ?>
          <!--API EndRequest-->
          <function name="&quot;ACDAPIEndRequest&quot;" return="" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oSUB</parameter>
          </function>
          <results >
            <result name="Default" link="83" stubbed="0"/>
          </results>
        </action>
        <action id="83" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=1105 y=1530 ?>
          <!--can't reach CSR-->
          <play connection-id="f_strConnectionId" endpoint="f_strEndPoint" callid="f_strCallId" repeat="1" timeout="10" ms-type="f_strMSType" returns="" start-play="1" interrupt="0" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >1503</audio>
          </play>
          <results >
            <result name="Default" link="57" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (true == Session.g_oMOH_MS.bCurrentlyConnected || true == Session.g_oMOH_MS.bCurrentlyInConf)
{
	Session.f_strCallId = Session.g_oMOH_MS.strCallId;
	Session.f_strConnectionId = Session.g_oMOH_MS.strConnectionId;
	Session.f_strEndPoint = Session.g_oMOH_MS.strEndPoint;
	Session.f_strMSType = Session.g_oMOH_MS.strMSType;
}
else if (true == Session.g_oConferenceMS.bCurrentlyConnected || true == Session.g_oConferenceMS.bCurrentlyInConf)
{
	Session.f_strCallId = Session.g_oConferenceMS.strCallId;
	Session.f_strConnectionId = Session.g_oConferenceMS.strConnectionId;
	Session.f_strEndPoint = Session.g_oConferenceMS.strEndPoint;
	Session.f_strMSType = Session.g_oConferenceMS.strMSType;
}
else
{
	Session.f_strCallId = Session.g_oMS.strCallId;
	Session.f_strConnectionId = Session.g_oMS.strConnectionId;
	Session.f_strEndPoint = Session.g_oMS.strEndPoint;
	Session.f_strMSType = Session.g_oMS.strMSType;
}]]></script>
          </scripts>
        </action>
        <action id="85" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=922 y=1365 ?>
          <!--please hold every 10 secs-->
          <function name="&quot;StartTimer&quot;" return="" external-function="1" library="" >
            <parameter >g_oPleaseHoldTimer</parameter>
          </function>
          <results >
            <result name="Default" link="40" stubbed="1"/>
          </results>
        </action>
        <action id="86" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=425 y=128 ?>
          <!--"ProcessOnTimer"-->
          <function name="&quot;ProcessOnTimer&quot;" return="f_nReturnCode" external-function="1" library="lib_utils.xml" >
            <parameter >nTimerId</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oTimer</parameter>
            <parameter >f_oTimer</parameter>
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerGSXB</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oMOHTimer</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
            <parameter >g_oMaxWaitCSRTimer</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >f_oMS</parameter>
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oTimerPrompts</parameter>
            <parameter >g_oTimerHeartBeat</parameter>
            <parameter >f_oTempObject</parameter>
            <parameter >f_oTempObject</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="57" stubbed="1"/>
            <result name="SUCCESS" link="40" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
            <result name="Reoriginate" link="64" stubbed="1" >f_nReturnCode == -2</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (Session.nTimerId == Session.g_oMOHTimer.lTimerId)
{
	Session.g_oMOH_MS = Session.f_oMS;
}]]></script>
          </scripts>
        </action>
        <action id="88" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=433 y=272 ?>
          <!--"ProcessOnTimer"-->
          <function name="&quot;ProcessOnTimer&quot;" return="f_nReturnCode" external-function="1" library="lib_utils.xml" >
            <parameter >nTimerId</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >f_oTempObject</parameter>
            <parameter >f_oTimer</parameter>
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerGSXB</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oMOHTimer</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
            <parameter >g_oMaxWaitCSRTimer</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >f_oTempObject</parameter>
            <parameter >s_strContact</parameter>
            <parameter >s_strContentType</parameter>
            <parameter >f_oMS</parameter>
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oTimerPrompts</parameter>
            <parameter >g_oTimerHeartBeat</parameter>
            <parameter >f_oTempObject</parameter>
            <parameter >f_oTempObject</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="57" stubbed="1"/>
            <result name="SUCCESS" link="40" stubbed="1" >f_nReturnCode == s_sSUCCESS</result>
            <result name="Reoriginate" link="64" stubbed="1" >f_nReturnCode == -2</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (Session.nTimerId == Session.g_oMOHTimer.lTimerId)
{
	Session.g_oMOH_MS = Session.f_oMS;
}]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="GetDestNumber" start="5" event="GetDestNumber" returns="i4" >
      <local-vars >
        <var name="f_nStarStar" type="i4" >359</var>
        <var name="f_nChangeSpeedDial" type="i4" >1262</var>
      </local-vars>
      <actions >
        <action id="5" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=23 y=104 ?>
          <!--507: Please enter the phone number you wish to reach. For international calls start with 011.-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="30" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="s_strOutdialDigitMap" language="g_oAPI.strLanguage" digits="g_oAPI.strDestinationNumber" retry-count="" clear-digits="1" terminating-digit="g_strTerminationDigit" quick-collect="0" digit-timer="" >
            <audio type="index" >509</audio>
            <audio type="index" >f_nStarStar</audio>
            <audio type="index" >f_nChangeSpeedDial</audio>
          </play>
          <results >
            <result name="Default" link="44" stubbed="0"/>
            <result name="Success" link="11" stubbed="0"/>
            <result name="Error"/>
            <result name="Timeout" link="11" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.strDestinationNumber = "";
Session.g_strTerminationDigit = "";


if("F" == Session.g_oAPI.strMainMenuFlag) {
	Session.f_nStarStar = 99;
	Session.f_nChangeSpeedDial = 99;
}]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (Result.id == 3)  //ms error
{
	Session.g_oAPI.nSessionTerminationReason = 12;
}]]></script>
          </scripts>
        </action>
        <action id="11" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=552 y=223 ?>
          <!--return s_nAUTHORIZE_DESTINATION-->
          <return value="s_nAUTHORIZE_DESTINATION"/>
        </action>
        <action id="44" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=259 y=68 ?>
          <!--"PlayPromptAndHangup"-->
          <function name="&quot;PlayPromptAndHangup&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="45" stubbed="0"/>
          </results>
        </action>
        <action id="45" plug-in="Standard.EndSession.1" ><?xtml-editor x=486 y=76 ?></action>
      </actions>
    </function>
    <function name="GetPinNumber" start="42" event="GetPinNumber" returns="i4" >
      <local-vars >
        <var name="f_strAcctNumber" type="string" ></var>
        <var name="f_strPinNumber" type="string" ></var>
        <var name="f_bNullString" type="boolean" >0</var>
        <var name="f_bCallCSR" type="boolean" >0</var>
        <var name="f_bIsValid" type="boolean" >0</var>
        <var name="f_bMissDial" type="boolean" >0</var>
        <var name="f_oCSRPrompts" type="object" ></var>
        <var name="f_nReturnCode" type="i4" >-1</var>
      </local-vars>
      <actions >
        <action id="42" plug-in="Pactolus.Branch.1" ><?xtml-editor x=20 y=42 ?>
          <!--g_oAPI.strWelcomePromptType = U or I-->
          <results >
            <result name="Default" link="87" stubbed="0"/>
            <result name="WelcomePromptType = U" link="43" stubbed="0" >g_oAPI.strWelcomePromptType match "U"
AND g_bFirstTry == true</result>
            <result name="WelcomePromptType = I, &gt; 0" link="40" stubbed="0" >g_oAPI.strWelcomePromptType match "I"
AND g_bFirstTry == true
AND g_oAPI.nWelcomePromptIndex &gt; 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_strAcctNumber = "";
Session.g_nErrorMsgNumber = 0;


if(Session.g_oACD.strPinZeroOut == "T") {
	Session.f_oCSRPrompts.nOR = 362;
	Session.f_oCSRPrompts.nPRESS = 310;
	Session.f_oCSRPrompts.nZERO = 1;
	Session.f_oCSRPrompts.nFOR_OPERATOR = 931;
} else {
	Session.f_oCSRPrompts.nOR = 99;
	Session.f_oCSRPrompts.nPRESS = 99;
	Session.f_oCSRPrompts.nZERO = 99;
	Session.f_oCSRPrompts.nFOR_OPERATOR = 99;
}]]></script>
            <script language="javascript" timing="last" ><![CDATA[Session.g_bFirstTry = false;
]]></script>
          </scripts>
        </action>
        <action id="18" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=477 y=23 ?>
          <!--506: Please enter your card number.-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="35" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="g_oSUB.strDigitMapAccountNbr" language="g_oAPI.strLanguage" digits="f_strAcctNumber" retry-count="" clear-digits="0" terminating-digit="g_strTerminationDigit" quick-collect="0" digit-timer="" >
            <audio type="index" >1290</audio>
            <audio type="index" >f_oCSRPrompts.nOR</audio>
            <audio type="index" >f_oCSRPrompts.nPRESS</audio>
            <audio type="index" >f_oCSRPrompts.nZERO</audio>
            <audio type="index" >f_oCSRPrompts.nFOR_OPERATOR</audio>
          </play>
          <results >
            <result name="Default" link="68" stubbed="0"/>
            <result name="Success" link="38" stubbed="0"/>
            <result name="Error"/>
            <result name="Timeout" link="38" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_strAcctNumber = "";
Session.g_strTerminationDigit = "";
Session.f_bCallCSR = false;
Session.f_bIsValid = false;
Session.f_bMissDial = false;]]></script>
          </scripts>
        </action>
        <action id="21" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=2019 y=174 ?>
          <!--return s_nAUTHENTICATE_PIN-->
          <return value="s_nAUTHENTICATE_PIN"/>
        </action>
        <action id="38" plug-in="Pactolus.Branch.1" ><?xtml-editor x=689 y=310 ?>
          <!--null OR misdial-->
          <results >
            <result name="Default" link="65" stubbed="0"/>
            <result name="misdial" link="18" stubbed="1" >f_bMissDial == true</result>
            <result name="zero to CSR" link="99" stubbed="1" >f_bCallCSR == true</result>
            <result name="invalid" link="82" stubbed="0" >f_bIsValid == false</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if ("0" == Session.f_strAcctNumber) {
	
	Session.f_bCallCSR = true;
	Session.g_nNumRetry++;

} else if(Session.f_strAcctNumber.length <= 0) {

	Session.f_bIsValid = false;
	Session.g_nPromptToPlay = 552; // I did not hear a response

} else if (Session.f_strAcctNumber.length <= 1 || "*" == Session.f_strAcctNumber) {

	Session.f_bIsValid = false;
	Session.g_nPromptToPlay = 1253;
	
} else if ("*" == Session.g_strTerminationDigit) {

	Session.f_bMissDial = true;
	
} else if (Session.f_strAcctNumber.length < 10) {

	Session.f_bIsValid = false;
	Session.g_nPromptToPlay = 1253;
	
} else {
	Session.f_bIsValid = true;
}
]]></script>
            <script language="javascript" timing="last" ><![CDATA[Session.g_strTerminationDigit = "";]]></script>
          </scripts>
        </action>
        <action id="40" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=239 y=440 ?>
          <!--Welcome prompt Index-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nPROMPTLENGTH" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="&quot;(xxxxxxxxxx|x.T|x.#|x.*)&quot;" language="g_oAPI.strLanguage" digits="f_strAcctNumber" retry-count="" clear-digits="1" terminating-digit="g_strTerminationDigit" quick-collect="0" digit-timer="" >
            <audio type="index" >g_oAPI.nWelcomePromptIndex</audio>
            <audio type="index" >1290</audio>
            <audio type="index" >f_oCSRPrompts.nOR</audio>
            <audio type="index" >f_oCSRPrompts.nPRESS</audio>
            <audio type="index" >f_oCSRPrompts.nZERO</audio>
            <audio type="index" >f_oCSRPrompts.nFOR_OPERATOR</audio>
          </play>
          <results >
            <result name="Default" link="38" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout" link="38" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_strAcctNumber = "";
Session.g_strTerminationDigit = "";
Session.f_bCallCSR = false;
Session.f_bIsValid = false;
Session.f_bMissDial = false;]]></script>
          </scripts>
        </action>
        <action id="43" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=241 y=281 ?>
          <!--Welcome prompt URL-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nPROMPTLENGTH" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="&quot;(xxxxxxxxxx|x.T|x.#|x.*)&quot;" language="g_oAPI.strLanguage" digits="f_strAcctNumber" retry-count="" clear-digits="1" terminating-digit="g_strTerminationDigit" quick-collect="0" digit-timer="" >
            <audio type="url" >g_oAPI.strWelcomePromptUrl</audio>
            <audio type="index" >1290</audio>
            <audio type="index" >f_oCSRPrompts.nOR</audio>
            <audio type="index" >f_oCSRPrompts.nPRESS</audio>
            <audio type="index" >f_oCSRPrompts.nZERO</audio>
            <audio type="index" >f_oCSRPrompts.nFOR_OPERATOR</audio>
          </play>
          <results >
            <result name="Default" link="38" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout" link="38" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_strAcctNumber = "";
Session.g_strTerminationDigit = "";
Session.f_bCallCSR = false;
Session.f_bIsValid = false;
Session.f_bMissDial = false;]]></script>
          </scripts>
        </action>
        <action id="58" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=1197 y=211 ?>
          <!--579: Please enter your pin-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="20" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="g_oSUB.strPinDigitMap" language="g_oAPI.strLanguage" digits="f_strPinNumber" retry-count="" clear-digits="1" terminating-digit="g_strTerminationDigit" quick-collect="0" digit-timer="" >
            <audio type="index" >579</audio>
            <audio type="index" >f_oCSRPrompts.nOR</audio>
            <audio type="index" >f_oCSRPrompts.nPRESS</audio>
            <audio type="index" >f_oCSRPrompts.nZERO</audio>
            <audio type="index" >f_oCSRPrompts.nFOR_OPERATOR</audio>
          </play>
          <results >
            <result name="Default" link="68" stubbed="0"/>
            <result name="Success" link="60" stubbed="0"/>
            <result name="Error"/>
            <result name="Timeout" link="60" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_strPinNumber = "";
Session.g_strTerminationDigit = "";
Session.f_bCallCSR = false;
Session.f_bIsValid = false;
Session.f_bMissDial = false;]]></script>
          </scripts>
        </action>
        <action id="60" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1423 y=260 ?>
          <!--null OR misdial-->
          <results >
            <result name="Default" link="66" stubbed="0"/>
            <result name="misdial" link="58" stubbed="1" >f_bMissDial == true</result>
            <result name="zero to CSR" link="99" stubbed="1" >f_bCallCSR == true</result>
            <result name="invalid" link="102" stubbed="0" >f_bIsValid == false</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if ("0" == Session.f_strPinNumber) {
	
	Session.f_bCallCSR = true;
	Session.g_nNumRetry++;	

} else if(Session.f_strPinNumber.length <= 0) {

	Session.f_bIsValid = false;
	Session.g_nPromptToPlay = 552; // I did not hear a response

} else if (Session.f_strPinNumber.length <= 1 || "*" == Session.f_strPinNumber) {

	Session.f_bIsValid = false;
	Session.g_nPromptToPlay = 1253;
	
} else if ("*" == Session.g_strTerminationDigit) {

	Session.f_bMissDial = true;

} else {
	Session.f_bIsValid = true;
}]]></script>
          </scripts>
        </action>
        <action id="61" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1813 y=159 ?>
          <!--concatenate account+pin-->
          <results >
            <result name="Default" link="21" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if(Session.g_bGetPinOnly) {
	Session.g_oSUB.strUserPin = Session.g_strAuthenticationNbr + Session.f_strPinNumber;	
} else {
	Session.g_oSUB.strUserPin = Session.f_strAcctNumber + Session.f_strPinNumber;
}	

	]]></script>
          </scripts>
        </action>
        <action id="63" plug-in="Pactolus.SOAPMessage.1" ><?xtml-editor x=1057 y=41 ?>
          <!--send ALARM-->
          <SOAP destination-ip="" transaction="" message-name="s_strSEND_ALARM_REQUEST" destination-port="" destination-type="1" destination-session="" waiting-session-selected="" >
            <parameter tag="&quot;calling_number&quot;" value="g_strAlarmType"/>
            <parameter tag="&quot;called_number&quot;" value="g_strAlarmPriority"/>
          </SOAP>
          <results >
            <result name="Default" link="75" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_strAlarmType = "MEDIASERVER: play get account number";
Session.g_strAlarmPriority = "MAJOR";]]></script>
          </scripts>
        </action>
        <action id="65" plug-in="Pactolus.Sleep.1" ><?xtml-editor x=945 y=288 ?>
          <!--0.5 sec-->
          <sleep duration="0.5"/>
          <results >
            <result name="Default" link="58" stubbed="0"/>
          </results>
        </action>
        <action id="66" plug-in="Pactolus.Sleep.1" ><?xtml-editor x=1579 y=144 ?>
          <!--0.5 sec-->
          <sleep duration="0.5"/>
          <results >
            <result name="Default" link="61" stubbed="0"/>
          </results>
        </action>
        <action id="68" plug-in="Pactolus.Branch.1" ><?xtml-editor x=815 y=57 ?>
          <!--send alarm?-->
          <results >
            <result name="Default" link="75" stubbed="1"/>
            <result name="s_strSendAlarmFlag==T" link="63" stubbed="0" >s_strSendAlarmFlag match "T"</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 12;]]></script>
          </scripts>
        </action>
        <action id="75" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1282 y=40 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="76" stubbed="0"/>
          </results>
        </action>
        <action id="76" plug-in="Standard.EndSession.1" ><?xtml-editor x=1511 y=53 ?></action>
        <action id="82" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=940 y=452 ?>
          <!--invalid pin-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="0" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="99" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
            <result name="try again" link="18" stubbed="1" >g_nNumRetry &lt; g_oAPI.nMaxLoginAttempts</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nNumRetry++;
]]></script>
          </scripts>
        </action>
        <action id="87" plug-in="Pactolus.Branch.1" ><?xtml-editor x=275 y=147 ?>
          <!--get pin only?-->
          <results >
            <result name="Default" link="18" stubbed="0"/>
            <result name="g_bGetPinOnly == true" link="58" stubbed="0" >g_bGetPinOnly == true</result>
          </results>
        </action>
        <action id="99" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=42 y=639 ?>
          <!--g_nCurrentState-->
          <return value="g_nCurrentState"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if(Session.f_bCallCSR) {
	Session.g_oACD.nCSRRouteReasonCodeTemp = Session.s_nCSR_ROUTE_REASON_ZERO_OUT;	
	Session.g_oACD.nCSRRouteReasonCode = Session.s_oCSR_REASONS.nPinZeroOut;
} else {
	Session.g_oACD.nCSRRouteReasonCodeTemp = Session.s_nCSR_ROUTE_REASON_INVALID;	
	Session.g_oACD.nCSRRouteReasonCode = Session.s_oCSR_REASONS.nPinInvalids;	
}

Session.g_oAPI.nStatePriorToCSR  = Session.s_nGET_PIN;	

Session.g_nCurrentState = Session.s_nSTATE_PROC_CSR_ATTEMPT;



if(Session.g_bGetPinOnly) {
	Session.g_oSUB.strUserPin = "";	
	Session.g_oSUB.strAccountNumber = Session.g_strAuthenticationNbr;
} else {
	Session.g_oSUB.strUserPin = "";
	Session.g_oSUB.strAccountNumber = "";
}	]]></script>
          </scripts>
        </action>
        <action id="102" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=1703 y=364 ?>
          <!--invalid pin-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="0" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="99" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
            <result name="try again" link="58" stubbed="1" >g_nNumRetry &lt; g_oAPI.nMaxLoginAttempts</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nNumRetry++;]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnOptions" start="1" event="OnOptions" returns="void" >
      <parameters >
        <parameter name="strAccept" type="string"/>
        <parameter name="strAcceptEncoding" type="string"/>
        <parameter name="strAcceptLanguage" type="string"/>
        <parameter name="strAllow" type="string" pass="byref"/>
        <parameter name="strAllowEvents" type="string" pass="byref"/>
        <parameter name="strAuthorization" type="string"/>
        <parameter name="strCallId" type="string"/>
        <parameter name="strCallInfo" type="string" pass="byref"/>
        <parameter name="strContact" type="string"/>
        <parameter name="strContent" type="string"/>
        <parameter name="strContentDisposition" type="string"/>
        <parameter name="strContentEncoding" type="string" pass="byref"/>
        <parameter name="strContentLanguage" type="string" pass="byref"/>
        <parameter name="strContentType" type="string"/>
        <parameter name="strCSeq" type="string"/>
        <parameter name="strDate" type="string"/>
        <parameter name="strEncryption" type="string"/>
        <parameter name="strErrorInfo" type="string" pass="byref"/>
        <parameter name="strFrom" type="string"/>
        <parameter name="strMaxForwards" type="string"/>
        <parameter name="strMIMEVersion" type="string" pass="byref"/>
        <parameter name="strOrganization" type="string" pass="byref"/>
        <parameter name="strProxyAuthorization" type="string"/>
        <parameter name="strProxyRequire" type="string"/>
        <parameter name="strRecordRoute" type="string"/>
        <parameter name="strRemotePartyId" type="string" pass="byref"/>
        <parameter name="strReferredBy" type="string" pass="byref"/>
        <parameter name="strRequestUri" type="string"/>
        <parameter name="strRequire" type="string"/>
        <parameter name="strResponseKey" type="string"/>
        <parameter name="strRoute" type="string"/>
        <parameter name="strSupported" type="string"/>
        <parameter name="strTimestamp" type="string"/>
        <parameter name="strTo" type="string"/>
        <parameter name="strUserAgent" type="string" pass="byref"/>
        <parameter name="strVia" type="string"/>
      </parameters>
      <actions >
        <action id="1" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=151 y=299 ?>
          <!--200 OK-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="2" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=392 y=298 ?>
          <return value=""/>
        </action>
      </actions>
    </function>
    <function name="ReOriginate" start="47" event="ReOriginate" returns="void" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="47" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=155 y=168 ?>
          <!--put A on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="48" stubbed="0"/>
          </results>
        </action>
        <action id="5" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=631 y=400 ?>
          <!--call is GET_DEST-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="40" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nGET_DESTINATION;]]></script>
          </scripts>
        </action>
        <action id="26" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=628 y=299 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="53" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 6;
Session.g_oAPI.nSessionTerminationReason = 5;]]></script>
          </scripts>
        </action>
        <action id="40" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=881 y=398 ?>
          <return value=""/>
        </action>
        <action id="45" plug-in="Pactolus.Branch.1" ><?xtml-editor x=373 y=341 ?>
          <!--SUCCESS?-->
          <results >
            <result name="Default" link="26" stubbed="0"/>
            <result name="SUCCESS?" link="5" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
            <result name="caller hung up" link="54" stubbed="0" >f_nReturnCode == s_sCALLERHUNGUP</result>
          </results>
        </action>
        <action id="46" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=153 y=344 ?>
          <!--outdial from MS-->
          <function name="&quot;MSOutdialParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oMS</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="45" stubbed="0"/>
          </results>
        </action>
        <action id="48" plug-in="Pactolus.Branch.1" ><?xtml-editor x=375 y=170 ?>
          <!--success?-->
          <results >
            <result name="Default" link="26" stubbed="1"/>
            <result name="success" link="46" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="53" plug-in="Standard.EndSession.1" ><?xtml-editor x=856 y=293 ?></action>
        <action id="54" plug-in="Standard.EndSession.1" ><?xtml-editor x=661 y=515 ?>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 7;]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnInfo" start="1" event="OnInfo" returns="void" >
      <parameters >
        <parameter name="strAccept" type="string"/>
        <parameter name="strAcceptEncoding" type="string"/>
        <parameter name="strAcceptLanguage" type="string"/>
        <parameter name="strAuthorization" type="string"/>
        <parameter name="strCallId" type="string"/>
        <parameter name="strContact" type="string"/>
        <parameter name="strContent" type="string"/>
        <parameter name="strContentDisposition" type="string"/>
        <parameter name="strContentType" type="string"/>
        <parameter name="strCSeq" type="string"/>
        <parameter name="strDate" type="string"/>
        <parameter name="strEncryption" type="string"/>
        <parameter name="strFrom" type="string"/>
        <parameter name="strMaxForwards" type="string"/>
        <parameter name="strMIMEVersion" type="string" pass="byref"/>
        <parameter name="strOrganization" type="string" pass="byref"/>
        <parameter name="strPriority" type="string" pass="byref"/>
        <parameter name="strProxyAuthorization" type="string"/>
        <parameter name="strProxyRequire" type="string"/>
        <parameter name="strRecordRoute" type="string"/>
        <parameter name="strRequestUri" type="string"/>
        <parameter name="strRequire" type="string"/>
        <parameter name="strResponseKey" type="string"/>
        <parameter name="strRoute" type="string"/>
        <parameter name="strSupported" type="string"/>
        <parameter name="strTimestamp" type="string"/>
        <parameter name="strTo" type="string"/>
        <parameter name="strUserAgent" type="string" pass="byref"/>
        <parameter name="strVia" type="string"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_lTempLong1" type="i8" >0</var>
        <var name="f_lTempLong2" type="i8" >0</var>
        <var name="f_strInputDigit" type="string" ></var>
        <var name="f_nCounter" type="i4" >0</var>
        <var name="f_strContentOFF" type="string" >OFF</var>
        <var name="f_bFromCallLegA" type="boolean" >0</var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=65 y=222 ?>
          <!--response 200 OK-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="101" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.enableEvents( false );]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1093 y=214 ?>
          <!--dtmf ##-->
          <results >
            <result name="Default" link="3" stubbed="0"/>
            <result name="fax" link="42" stubbed="0" >strContentType match "tone"</result>
            <result name="re-originate" link="12" stubbed="0" >strContent match "#"
AND strContentType match "dtmf"</result>
          </results>
        </action>
        <action id="3" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1298 y=189 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.enableEvents( true );]]></script>
          </scripts>
        </action>
        <action id="4" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=771 y=458 ?>
          <!--Hang Up Phone B-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="52" stubbed="0"/>
          </results>
        </action>
        <action id="5" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1471 y=454 ?>
          <!--Re-originate-->
          <function name="&quot;ReOriginate&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="6" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.enableEvents( true );]]></script>
          </scripts>
        </action>
        <action id="6" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1697 y=450 ?>
          <return value=""/>
        </action>
        <action id="12" plug-in="Pactolus.Branch.1" ><?xtml-editor x=61 y=403 ?>
          <!--connected?-->
          <results >
            <result name="Default" link="3" stubbed="1"/>
            <result name="g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true?" link="50" stubbed="0" >g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == true
AND g_oArrayCallLegs[g_nCurrentArrayIndex].bCurrentlyDialing == false</result>
            <result name="g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == false?" link="72" stubbed="0" >g_oArrayCallLegs[g_nCurrentArrayIndex].bCurrentlyDialing == true
AND g_oArrayCallLegs[g_nCurrentArrayIndex].bConnected == false</result>
          </results>
        </action>
        <action id="28" plug-in="Pactolus.Branch.1" ><?xtml-editor x=322 y=1175 ?>
          <!--connect to media server?-->
          <results >
            <result name="Default" link="45" stubbed="0"/>
            <result name="Connected to MS?" link="29" stubbed="1" >g_oMS.bCurrentlyConnected == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.enableEvents( true );]]></script>
          </scripts>
        </action>
        <action id="29" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1047 y=1285 ?>
          <!--call main function
s_nGET_DESTINATION-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="6" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nGET_DESTINATION;]]></script>
          </scripts>
        </action>
        <action id="37" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1043 y=1161 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="75" stubbed="1"/>
          </results>
        </action>
        <action id="42" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1334 y=273 ?>
          <!--put B on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="53" stubbed="0"/>
          </results>
        </action>
        <action id="45" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=563 y=1177 ?>
          <!--outdial from ms-->
          <function name="&quot;MSOutdialParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oMS</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="46" stubbed="0"/>
          </results>
        </action>
        <action id="46" plug-in="Pactolus.Branch.1" ><?xtml-editor x=803 y=1171 ?>
          <!--SUCCESS?-->
          <results >
            <result name="Default" link="37" stubbed="0"/>
            <result name="SUCCESS?" link="29" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
            <result name="caller hung up" link="75" stubbed="1" >f_nReturnCode == s_sCALLERHUNGUP</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (1 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 5;
}
else if (3 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 7;
}]]></script>
          </scripts>
        </action>
        <action id="50" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=282 y=462 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="83" stubbed="0"/>
          </results>
        </action>
        <action id="52" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=892 y=191 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="76" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 5;]]></script>
            <script language="javascript" timing="last" ><![CDATA[	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}
	

	Server.logInfo("Reset lCSRAssignmentId and lCSRUserId.");
	Session.g_oACD.lCSRAssignmentId = 0;
	Session.g_oACD.lCSRUserId = 0;	
	]]></script>
          </scripts>
        </action>
        <action id="53" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1552 y=267 ?>
          <!--success?-->
          <results >
            <result name="Default" link="37" stubbed="1"/>
            <result name="success" link="80" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="70" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=547 y=1007 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="77" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 5;]]></script>
            <script language="javascript" timing="last" ><![CDATA[	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}
	

	Server.logInfo("Reset lCSRAssignmentId and lCSRUserId.");
	Session.g_oACD.lCSRAssignmentId = 0;
	Session.g_oACD.lCSRUserId = 0;	
	]]></script>
          </scripts>
        </action>
        <action id="72" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=328 y=1011 ?>
          <!--Cancel PartyB-->
          <function name="&quot;CancelParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="70" stubbed="0"/>
          </results>
        </action>
        <action id="75" plug-in="Standard.EndSession.1" ><?xtml-editor x=1715 y=578 ?></action>
        <action id="76" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1230 y=452 ?>
          <!--success?-->
          <results >
            <result name="Default" link="37" stubbed="1"/>
            <result name="success" link="5" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (1 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 5;
}]]></script>
          </scripts>
        </action>
        <action id="77" plug-in="Pactolus.Branch.1" ><?xtml-editor x=773 y=1010 ?>
          <!--success?-->
          <results >
            <result name="Default" link="37" stubbed="1"/>
            <result name="success" link="28" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (1 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 5;
}]]></script>
          </scripts>
        </action>
        <action id="80" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1790 y=269 ?>
          <!--"FaxOutdial"-->
          <function name="&quot;FaxOutdial&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >f_lTempLong1</parameter>
            <parameter >f_lTempLong2</parameter>
            <parameter >g_oAPI.strSIPStatus</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="81" stubbed="0"/>
          </results>
        </action>
        <action id="81" plug-in="Pactolus.Branch.1" ><?xtml-editor x=2013 y=265 ?>
          <!--success?-->
          <results >
            <result name="Default" link="89" stubbed="1"/>
            <result name="success" link="3" stubbed="1" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="83" plug-in="Pactolus.Branch.1" ><?xtml-editor x=534 y=459 ?>
          <!--allow more than 2?-->
          <results >
            <result name="Default" link="4" stubbed="0"/>
            <result name="max parties allow &gt; 2" link="88" stubbed="0" >g_nMaxPartiesAllowed &gt; 2</result>
          </results>
        </action>
        <action id="85" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1250 y=593 ?>
          <!--outdial from MS-->
          <function name="&quot;MSOutdialParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oMS</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="89" stubbed="0"/>
            <result name="Caller Hungup" link="87" stubbed="0" >f_nReturnCode == s_sCALLERHUNGUP</result>
            <result name="SUCCESS" link="97" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="86" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1014 y=596 ?>
          <!--put A on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="89" stubbed="1"/>
            <result name="SUCCESS" link="85" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="87" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1505 y=693 ?>
          <!--"HangUpOutdialLegsWriteCDR"-->
          <function name="&quot;HangUpOutdialLegsWriteCDR&quot;" return="" external-function="0" library="lib_callcontrol.xml"/>
          <results >
            <result name="Default" link="75" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 2;]]></script>
          </scripts>
        </action>
        <action id="88" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=778 y=598 ?>
          <!--put B on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="89" stubbed="1"/>
            <result name="SUCCESS" link="86" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="89" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1489 y=580 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="75" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 6;
Session.g_oAPI.nSessionTerminationReason = 5;]]></script>
          </scripts>
        </action>
        <action id="90" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1278 y=971 ?>
          <!--Hang Up Phone B-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="91" stubbed="0"/>
          </results>
        </action>
        <action id="91" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1474 y=954 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="92" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 5;]]></script>
            <script language="javascript" timing="last" ><![CDATA[// Session.g_oArrayCallLegs.length--;
if (2 == Result.id)
{
	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

}

Server.logInfo("Reset lCSRAssignmentId and lCSRUserId.");
Session.g_oACD.lCSRAssignmentId = 0;
Session.g_oACD.lCSRUserId = 0;	
]]></script>
          </scripts>
        </action>
        <action id="92" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1708 y=970 ?>
          <!--success?-->
          <results >
            <result name="Default" link="37" stubbed="1"/>
            <result name="success" link="98" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if (1 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 5;
}]]></script>
          </scripts>
        </action>
        <action id="93" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1003 y=838 ?>
          <!--1 or 2?-->
          <results >
            <result name="Default" link="94" stubbed="0"/>
            <result name="1 reoriginate" link="90" stubbed="0" >f_strInputDigit match "1"</result>
            <result name="2 add more party" link="95" stubbed="0" >f_strInputDigit match "2"</result>
          </results>
        </action>
        <action id="94" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1265 y=836 ?>
          <!--max retry?-->
          <results >
            <result name="Default" link="97" stubbed="1"/>
            <result name="counter &gt; 0?" link="96" stubbed="0" >f_nCounter &gt; 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nCounter--;
Session.f_strInputDigit = "";]]></script>
          </scripts>
        </action>
        <action id="95" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1273 y=1149 ?>
          <!--send to Main function
s_nGET_VAL_CONF_DEST-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="6" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nGET_VAL_CONF_DEST;
// Mediaserver object
Session.g_oConferenceMS.strContent = "";
Session.g_oConferenceMS.strCallId = "";
Session.g_oConferenceMS.strEndPoint = "";
Session.g_oConferenceMS.strConnectionId = "";
Session.g_oConferenceMS.strType = Session.s_strConferenceMSType;
Session.g_oConferenceMS.strConferenceId = "";	//use through out
Session.g_oConferenceMS.bMuteFlag = false;
Session.g_oConferenceMS.bDeafFlag = false;
Session.g_oConferenceMS.bCurrentlyInConf = false;
Session.g_oConferenceMS.bCurrentlyConnected = false;
Session.g_oConferenceMS.bPersistentFlag = false;
Session.g_oConferenceMS.bDTMFClampFlag = false;
Session.g_oConferenceMS.bRetry = false;
Session.g_oConferenceMS.nPacketizationPeriod = Session.s_nPacketizationPeriod;
Session.g_oConferenceMS.nConferenceMaxParties = Session.s_nConferenceMaxParties;
Session.g_oConferenceMS.nConferenceMaxTalkers = Session.s_nConferenceMaxTalkers;

Server.enableEvents( true );]]></script>
          </scripts>
        </action>
        <action id="96" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1497 y=832 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="75" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 2;
Session.g_oAPI.nSessionTerminationReason = 7;]]></script>
          </scripts>
        </action>
        <action id="97" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=784 y=843 ?>
          <!--ReOriginate or Conf-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="&quot;(1|2)&quot;" language="g_oAPI.strLanguage" digits="f_strInputDigit" retry-count="f_nCounter" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >959</audio>
            <audio type="index" >311</audio>
            <audio type="index" >362</audio>
            <audio type="index" >960</audio>
            <audio type="index" >312</audio>
            <timeout-prompt type="index" >552</timeout-prompt>
          </play>
          <results >
            <result name="Default" link="93" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="98" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1927 y=969 ?>
          <!--call is GET_DEST-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="6" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nGET_DESTINATION;
Server.enableEvents( true );]]></script>
          </scripts>
        </action>
        <action id="99" plug-in="Pactolus.Branch.1" ><?xtml-editor x=565 y=215 ?>
          <!--send info msg?-->
          <results >
            <result name="Default" link="2" stubbed="1"/>
            <result name="s_strSendInfoMsg==&quot;T&quot;" link="100" stubbed="0" >s_strSendInfoMsg match "T"</result>
          </results>
        </action>
        <action id="100" plug-in="Pactolus.SipInfo.1" ><?xtml-editor x=932 y=459 ?>
          <!--OFF-->
          <element-tag increment-cseq-first="0" increment-cseq-last="1" >
            <call-id >g_oCallLegA.strCallId</call-id>
            <content >f_strContentOFF</content>
            <content-type >"application/dtmf"</content-type>
            <cseq >g_oCallLegA.strCSeq</cseq>
            <from >g_oCallLegA.strTo</from>
            <request-uri >g_oCallLegA.strRequestUri</request-uri>
            <to >g_oCallLegA.strFrom</to>
            <via >s_strVia</via>
          </element-tag>
          <results >
            <result name="Default" link="2" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
          </results>
        </action>
        <action id="101" plug-in="Pactolus.Branch.1" ><?xtml-editor x=307 y=220 ?>
          <!--from call leg A?-->
          <results >
            <result name="Default" link="3" stubbed="1"/>
            <result name="f_bFromCallLegA" link="99" stubbed="0" >f_bFromCallLegA == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (0 == Clib.strcmpi(Session.strCallId, Session.g_oCallLegA.strCallId))
{
	Session.f_bFromCallLegA = true;
	var newCSeq = new SipCSeq(Session.strCSeq);
	var oldCSeq = new SipCSeq(Session.g_oCallLegA.strCSeq);

	if(newCSeq.value >= oldCSeq.value) 
	{
		newCSeq.increment() ;
		Session.g_oCallLegA.strCSeq = newCSeq.encode() ;
	}
}
else
{
	Session.f_bFromCallLegA = false;
}]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OldPlayThresholdsPrompt" start="77" event="OldPlayThresholdsPrompt" returns="void" >
      <parameters >
        <parameter name="n_TimeLeft" type="i4"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_lTempLong1" type="i8" >0</var>
        <var name="f_lTempLong2" type="i8" >0</var>
      </local-vars>
      <actions >
        <action id="77" plug-in="Pactolus.Branch.1" ><?xtml-editor x=78 y=89 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="78" stubbed="1"/>
            <result name="TimerAFlag==true" link="75" stubbed="0" >g_bTimerAFlag == true</result>
          </results>
        </action>
        <action id="6" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=520 y=448 ?>
          <!--xxx seconds-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="silence" >2</audio>
            <audio type="number" >n_TimeLeft</audio>
            <audio type="index" >46</audio>
          </play>
          <results >
            <result name="Default" link="65" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="24" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=574 y=827 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="89" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 2;
Session.g_oAPI.nSessionTerminationReason = 7;]]></script>
          </scripts>
        </action>
        <action id="57" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1218 y=1092 ?>
          <return value=""/>
        </action>
        <action id="63" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=64 y=490 ?>
          <!--outdial from MS-->
          <function name="&quot;MSOutdialParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oMS</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="64" stubbed="0"/>
          </results>
        </action>
        <action id="64" plug-in="Pactolus.Branch.1" ><?xtml-editor x=278 y=489 ?>
          <!--SUCCESS?-->
          <results >
            <result name="Default" link="24" stubbed="1"/>
            <result name="SUCCESS?" link="6" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
            <result name="caller hung up" link="84" stubbed="0" >f_nReturnCode == s_sCALLERHUNGUP</result>
          </results>
        </action>
        <action id="65" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=812 y=639 ?>
          <!--delete MS connection-->
          <function name="&quot;DeleteMSConnection&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
          </function>
          <results >
            <result name="Default" link="86" stubbed="0"/>
          </results>
        </action>
        <action id="68" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=62 y=303 ?>
          <!--put A on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="70" stubbed="0"/>
          </results>
        </action>
        <action id="69" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=528 y=302 ?>
          <!--put B on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="72" stubbed="0"/>
          </results>
        </action>
        <action id="70" plug-in="Pactolus.Branch.1" ><?xtml-editor x=277 y=305 ?>
          <!--success?-->
          <results >
            <result name="Default" link="24" stubbed="1"/>
            <result name="success" link="69" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="72" plug-in="Pactolus.Branch.1" ><?xtml-editor x=748 y=300 ?>
          <!--success?-->
          <results >
            <result name="Default" link="24" stubbed="1"/>
            <result name="success" link="63" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="75" plug-in="Standard.Timer.1" ><?xtml-editor x=337 y=87 ?>
          <!--stop phoneA session timer-->
          <timer start="0" id="g_lTimerIdA" duration=""/>
          <results >
            <result name="Default" link="78" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerAFlag = false;]]></script>
          </scripts>
        </action>
        <action id="76" plug-in="Standard.Timer.1" ><?xtml-editor x=815 y=145 ?>
          <!--stop PhoneB session timer-->
          <timer start="0" id="g_lTimerIdB" duration=""/>
          <results >
            <result name="Default" link="68" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerBFlag = false;]]></script>
          </scripts>
        </action>
        <action id="78" plug-in="Pactolus.Branch.1" ><?xtml-editor x=568 y=86 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="68" stubbed="1"/>
            <result name="TimerBFlag==true" link="76" stubbed="0" >g_bTimerBFlag == true</result>
          </results>
        </action>
        <action id="79" plug-in="Standard.Timer.1" ><?xtml-editor x=523 y=1092 ?>
          <!--set PhoneB session timer-->
          <timer start="1" id="g_lTimerIdB" duration="g_nSessionExpiresB"/>
          <results >
            <result name="Default" link="90" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_bTimerBFlag = true;]]></script>
          </scripts>
        </action>
        <action id="82" plug-in="Standard.Timer.1" ><?xtml-editor x=1007 y=1096 ?>
          <!--set PhoneA session timer-->
          <timer start="1" id="g_lTimerIdA" duration="g_nSessionExpiresA"/>
          <results >
            <result name="Default" link="57" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_bTimerAFlag = true;]]></script>
          </scripts>
        </action>
        <action id="83" plug-in="Pactolus.Sleep.1" ><?xtml-editor x=57 y=1082 ?>
          <!--1 sec-->
          <sleep duration="1"/>
          <results >
            <result name="Default" link="91" stubbed="0"/>
          </results>
        </action>
        <action id="84" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=537 y=638 ?>
          <!--"HangUpOutdialLegsWriteCDR"-->
          <function name="&quot;HangUpOutdialLegsWriteCDR&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="89" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 2;
Session.g_oAPI.nSessionTerminationReason = 7;]]></script>
          </scripts>
        </action>
        <action id="85" plug-in="Pactolus.Branch.1" ><?xtml-editor x=296 y=841 ?>
          <results >
            <result name="Default" link="24" stubbed="0"/>
            <result name="0 -  success" link="92" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("INFO: CALING LIBOUTDIAL RETURN: " + Session.f_nReturnCode);]]></script>
          </scripts>
        </action>
        <action id="86" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=52 y=838 ?>
          <!--outdial-->
          <function name="&quot;OutdialParty&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >f_lTempLong1</parameter>
            <parameter >f_lTempLong2</parameter>
            <parameter >g_oAPI.strSIPStatus</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="85" stubbed="0"/>
          </results>
        </action>
        <action id="89" plug-in="Standard.EndSession.1" ><?xtml-editor x=808 y=823 ?></action>
        <action id="90" plug-in="Pactolus.Branch.1" ><?xtml-editor x=761 y=1092 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="57" stubbed="1"/>
            <result name="TimerAFlag==true" link="82" stubbed="0" >g_bTimerAFlag == true</result>
          </results>
        </action>
        <action id="91" plug-in="Pactolus.Branch.1" ><?xtml-editor x=278 y=1089 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="90" stubbed="1"/>
            <result name="TimerBFlag==true" link="79" stubbed="0" >g_bTimerBFlag == true</result>
          </results>
        </action>
        <action id="92" plug-in="Pactolus.Branch.1" ><?xtml-editor x=550 y=937 ?>
          <!--session timer ON?-->
          <results >
            <result name="Default" link="57" stubbed="0"/>
            <result name="sessionTimerFlag == &quot;T&quot;" link="83" stubbed="0" >s_strSessionTimerFlag match "T"</result>
          </results>
        </action>
      </actions>
    </function>
    <function name="GetExpirationDate" start="28" event="GetExpirationDate" returns="i4" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="28" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=213 y=327 ?>
          <!--"APIGetExpirationDate"-->
          <function name="&quot;psAPIGetExpDate&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
          </function>
          <results >
            <result name="Default" link="27" stubbed="0"/>
            <result name="EXP DATE" link="11" stubbed="0" >f_nReturnCode == 0</result>
            <result name="NO EXP DATE" link="25" stubbed="0" >f_nReturnCode == 1</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("exp date = " + Session.g_oSUB.strExpDate);
if (-1 == Session.f_nReturnCode)
{
	Session.g_nErrorMsgNumber = 1001; //db error
}
else if (-50 == Session.f_nReturnCode)
{
	Session.g_nErrorMsgNumber = 1000; //jvm server error
}
else
{
	Session.g_nErrorMsgNumber = 0;
}]]></script>
          </scripts>
        </action>
        <action id="8" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=757 y=494 ?>
          <!--return to MAIN_MENU-->
          <return value="s_nMAIN_MENU"/>
        </action>
        <action id="11" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=477 y=386 ?>
          <!--Play Exp Date-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >547</audio>
            <audio type="date" >g_oSUB.strExpDate</audio>
          </play>
          <results >
            <result name="Default" link="8" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="24" plug-in="Standard.EndSession.1" ><?xtml-editor x=946 y=249 ?></action>
        <action id="25" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=491 y=548 ?>
          <!--No Exp Date-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >548</audio>
          </play>
          <results >
            <result name="Default" link="8" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="26" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=716 y=249 ?>
          <!--"PlayPromptAndHangup"-->
          <function name="&quot;PlayPromptAndHangup&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="24" stubbed="0"/>
          </results>
        </action>
        <action id="27" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=479 y=250 ?>
          <!--play Error, call CSR-->
          <function name="&quot;PlayCallCSR&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >g_oAPI.strCustomerServicePhone</parameter>
          </function>
          <results >
            <result name="Default" link="26" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 5;
Server.logError("ERROR: FAIL TO GET EXP DATE");
Server.logError("ERROR: getExpDate returned " + Session.f_nReturnCode);]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="MainMenu" start="22" event="MainMenu" returns="i4" >
      <local-vars >
        <var name="f_nNumTries" type="i4" >0</var>
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_nCounter" type="i4" >0</var>
        <var name="f_nPACMaxAttempts" type="i4" >2</var>
        <var name="f_oCSRPrompts" type="object" ></var>
      </local-vars>
      <actions >
        <action id="22" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=14 y=72 ?>
          <!--Main menu-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="35" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="&quot;(x)&quot;" language="g_oAPI.strLanguage" digits="g_strDigitCollected" retry-count="f_nPACMaxAttempts" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >311</audio>
            <audio type="index" >1263</audio>
            <audio type="index" >s_nHalfSecSilence</audio>
            <audio type="index" >312</audio>
            <audio type="index" >1254</audio>
            <audio type="index" >s_nHalfSecSilence</audio>
            <audio type="index" >313</audio>
            <audio type="index" >523</audio>
            <audio type="index" >f_oCSRPrompts.nSILENCE</audio>
            <audio type="index" >f_oCSRPrompts.nPRESS</audio>
            <audio type="index" >f_oCSRPrompts.nZERO</audio>
            <audio type="index" >f_oCSRPrompts.nFOR_OPERATOR</audio>
            <timeout-prompt type="index" >552</timeout-prompt>
          </play>
          <results >
            <result name="Default" link="83" stubbed="0"/>
            <result name="Success" ><?xtml-editor visible=no?></result>
            <result name="Error"/>
            <result name="Timeout" link="100" stubbed="0"/>
            <result name="press 1" link="68" stubbed="0" >'Result'  == 'Success'
AND g_strDigitCollected match "1"</result>
            <result name="press 2" link="23" stubbed="0" >'Result'  == 'Success'
AND g_strDigitCollected match "2"</result>
            <result name="press 3" link="11" stubbed="0" >'Result'  == 'Success'
AND g_strDigitCollected match "3"</result>
            <result name="press 0" link="97" stubbed="0" >'Result'  == 'Success'
AND g_strDigitCollected match "0"</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_strDigitCollected = "";

if(Session.g_oACD.strMainMenuZeroOut == "T") {
	Session.f_oCSRPrompts.nSILENCE = Session.s_nHalfSecSilence;	
	Session.f_oCSRPrompts.nPRESS = 310;
	Session.f_oCSRPrompts.nZERO = 1;
	Session.f_oCSRPrompts.nFOR_OPERATOR = 931;
} else {
	Session.f_oCSRPrompts.nSILENCE = 99;
	Session.f_oCSRPrompts.nPRESS = 99;
	Session.f_oCSRPrompts.nZERO = 99;
	Session.f_oCSRPrompts.nFOR_OPERATOR = 99;
}]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (4 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 6;
}]]></script>
          </scripts>
        </action>
        <action id="11" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=402 y=479 ?>
          <!--return GET_DESTINATION-->
          <return value="s_nGET_DESTINATION"/>
        </action>
        <action id="23" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=436 y=354 ?>
          <!--call AddSpeedDial()-->
          <function name="&quot;AddSpeedDial&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oMS</parameter>
            <parameter >s_nTIMEOUT</parameter>
            <parameter >s_sSUCCESS</parameter>
            <parameter >s_nAUTHORIZE_DESTINATION</parameter>
            <parameter >s_sFAILURE</parameter>
            <parameter >g_oAPI.nSessionTerminationReason</parameter>
            <parameter >g_oAPI.nMaxLoginAttempts</parameter>
            <parameter >g_oAPI.strPlatformSessionId</parameter>
            <parameter >g_oAPI.strProcDBName</parameter>
            <parameter >g_oSUB.lSubscriberId</parameter>
            <parameter >g_oSUB.lPinId</parameter>
            <parameter >g_nServiceElementId</parameter>
            <parameter >g_oAPI.strDestinationNumber</parameter>
          </function>
          <results >
            <result name="Default" link="61" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oMS.strLanguage = Session.g_oAPI.strLanguage;]]></script>
          </scripts>
        </action>
        <action id="47" plug-in="Pactolus.Branch.1" ><?xtml-editor x=600 y=92 ?>
          <!--invalid choice-->
          <results >
            <result name="Default" link="22" stubbed="1"/>
            <result name="Too many tries" link="89" stubbed="0" >f_nNumTries &gt;= g_oAPI.nMaxLoginAttempts</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nNumTries++;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (2 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 13;
}]]></script>
          </scripts>
        </action>
        <action id="61" plug-in="Pactolus.Branch.1" ><?xtml-editor x=715 y=316 ?>
          <!--end call? failure?-->
          <results >
            <result name="Default" link="22" stubbed="1"/>
            <result name="Failure" link="63" stubbed="0" >f_nReturnCode == s_sFAILURE</result>
            <result name="AuthorizeDest" link="66" stubbed="0" >f_nReturnCode == s_nAUTHORIZE_DESTINATION</result>
            <result name="End Call" link="82" stubbed="0" >f_nReturnCode == s_nEND_CALL</result>
            <result name="Get Dest" link="11" stubbed="1" >f_nReturnCode == s_nGET_DESTINATION</result>
          </results>
        </action>
        <action id="63" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=1028 y=230 ?>
          <!--sorry, transaction can't be completed-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >301</audio>
            <audio type="index" >363</audio>
          </play>
          <results >
            <result name="Default" link="11" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="66" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1058 y=412 ?>
          <!--return s_nAUTHORIZE_DESTINATION-->
          <return value="s_nAUTHORIZE_DESTINATION"/>
        </action>
        <action id="68" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=453 y=232 ?>
          <!--ReviewSpeedDial-->
          <function name="&quot;ReviewSpeedDials&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oMS</parameter>
            <parameter >s_nTIMEOUT</parameter>
            <parameter >s_nAUTHORIZE_DESTINATION</parameter>
            <parameter >s_sSUCCESS</parameter>
            <parameter >s_sFAILURE</parameter>
            <parameter >g_oAPI.nMaxLoginAttempts</parameter>
            <parameter >g_oAPI.strDestinationNumber</parameter>
            <parameter >g_oAPI.nSessionTerminationReason</parameter>
            <parameter >g_oAPI.strPlatformSessionId</parameter>
            <parameter >g_oAPI.strProcDBName</parameter>
            <parameter >g_oSUB.lSubscriberId</parameter>
            <parameter >g_oSUB.lPinId</parameter>
            <parameter >g_nServiceElementId</parameter>
          </function>
          <results >
            <result name="Default" link="61" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oMS.strLanguage = Session.g_oAPI.strLanguage;]]></script>
          </scripts>
        </action>
        <action id="82" plug-in="Standard.EndSession.1" ><?xtml-editor x=1027 y=541 ?></action>
        <action id="83" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=371 y=81 ?>
          <!--invalid choice-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >337</audio>
          </play>
          <results >
            <result name="Default" link="47" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="89" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=852 y=100 ?>
          <!--play Error, call CSR-->
          <function name="&quot;PlayCallCSR&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >g_oAPI.strCustomerServicePhone</parameter>
          </function>
          <results >
            <result name="Default" link="90" stubbed="0"/>
          </results>
        </action>
        <action id="90" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1067 y=93 ?>
          <!--"PlayPromptAndHangup"-->
          <function name="&quot;PlayPromptAndHangup&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="97" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nEND_CALL;]]></script>
          </scripts>
        </action>
        <action id="97" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=275 y=617 ?>
          <!--g_nCurrentState-->
          <return value="g_nCurrentState"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nSTATE_PROC_CSR_ATTEMPT;
Session.g_oAPI.nStatePriorToCSR = Session.s_nMAIN_MENU;
Session.g_oACD.nCSRRouteReasonCodeTemp = Session.s_nCSR_ROUTE_REASON_ZERO_OUT;	
Session.g_oACD.nCSRRouteReasonCode = Session.s_oCSR_REASONS.nMainMenuZeroOut;
]]></script>
          </scripts>
        </action>
        <action id="100" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=15 y=324 ?>
          <!--552-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >552</audio>
          </play>
          <results >
            <result name="Default" link="89" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="OnServiceLoad" start="1" event="OnServiceLoad" returns="void" >
      <parameters >
        <parameter name="strAppName" type="string"/>
        <parameter name="nSessionCount" type="i2"/>
        <parameter name="nMaxIterations" type="i2"/>
        <parameter name="nServerId" type="i2"/>
      </parameters>
      <actions >
        <action id="1" plug-in="Pactolus.UserFunction.1" ><?xtml-editor x=154 y=201 ?>
          <!--GET PSX IP from config-->
          <user-function process="&quot;PACTOLUS_ps_c_adaptor&quot;" function="&quot;get_property&quot;" timeout="s_nTIMEOUT" return="" async="0" >
            <parameter >"primary-softswitch"</parameter>
            <parameter >s_strPrimaryPSX</parameter>
            <parameter >"backup-softswitch"</parameter>
            <parameter >s_strBackupPSX</parameter>
            <parameter >"appserver-logical-ip"</parameter>
            <parameter >s_strLocalHost</parameter>
            <parameter >"postpaid-default-ani"</parameter>
            <parameter >s_strDEFAULT_ANI</parameter>
            <parameter >"send-alarm-flag"</parameter>
            <parameter >s_strSendAlarmFlag</parameter>
            <parameter >"prepend-to-outdial"</parameter>
            <parameter >s_strDigitPrependToOutdial</parameter>
            <parameter >"packetization-period"</parameter>
            <parameter >s_nPacketizationPeriod</parameter>
            <parameter >"media-server-type"</parameter>
            <parameter >s_strMSType</parameter>
            <parameter >"conferencing-media-server-type"</parameter>
            <parameter >s_strConferenceMSType</parameter>
            <parameter >"ms-connect-retry"</parameter>
            <parameter >s_strMSRetryFlag</parameter>
            <parameter >"outdial-dialing-plan"</parameter>
            <parameter >s_strOutdialDialingPlan</parameter>
            <parameter >"outdial-digit-map"</parameter>
            <parameter >s_strOutdialDigitMap</parameter>
            <parameter >"ring-no-answer-time"</parameter>
            <parameter >s_nRING_NO_ANSWER_TIME</parameter>
            <parameter >"session-timer-enabled"</parameter>
            <parameter >s_strSessionTimerFlag</parameter>
            <parameter >"session-timer-interval"</parameter>
            <parameter >s_nSessionTimerInterval</parameter>
            <parameter >"ignore-pin-language"</parameter>
            <parameter >s_strIgnorePinLanguage</parameter>
            <parameter >"postpaid-start-call-delay"</parameter>
            <parameter >s_fPostStartCallDelay</parameter>
            <parameter >"conference-max-parties"</parameter>
            <parameter >s_nConferenceMaxParties</parameter>
            <parameter >"conference-max-talkers"</parameter>
            <parameter >s_nConferenceMaxTalkers</parameter>
            <parameter >"codec"</parameter>
            <parameter >s_strCodec</parameter>
            <parameter >"intl-min-connect-time"</parameter>
            <parameter >s_nIntlMinConnectTime</parameter>
            <parameter >"dom-min-connect-time"</parameter>
            <parameter >s_nDomMinConnectTime</parameter>
            <parameter >"customer-code"</parameter>
            <parameter >s_strCustomerCode</parameter>
            <parameter >"send-info-msg"</parameter>
            <parameter >s_strSendInfoMsg</parameter>
          </user-function>
          <results >
            <result name="Default" link="13" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.s_strApplicationName = Session._appName;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (Session.s_strPrimaryPSX.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR PRIMARY SOFTSWITCH.");
}
if (Session.s_strBackupPSX.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR BACKUP SOFTSWITCH.");
}
if (Session.s_strLocalHost.length <= 0)
{
	Session.s_strLocalHost = Server.ipAddress;
	Server.logInfo("WARNING:  NO SETTING FOR LOCAL HOST IP ADDRESS.  USE DEFAULT: " + Session.s_strLocalHost);
}
if (Session.s_strDEFAULT_ANI.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR POSTPAID DEFAULT ANI.");
}
if (Session.s_strSendAlarmFlag.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR SEND ALARM FLAG.");
}
if (Session.s_strDigitPrependToOutdial.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR DIGIT PREPEND TO OUTDIAL.");
}
if (Session.s_nPacketizationPeriod <= 0)
{
	Session.s_nPacketizationPeriod = 20;
	Server.logInfo("WARNING: NO SETTING FOR PACKETIZATION PERIOD.  USE DEFAULT: " + Session.s_nPacketizationPeriod);
}
if (Session.s_strMSType.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR MEDIA SERVER TYP, DEAULT WILL BE PCS.");
	Session.s_strMSType = "PCS";
}
if (Session.s_strConferenceMSType.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR CONFERENCE MEDIA SERVER TYP, DEAULT WILL BE CONV.");
	Session.s_strConferenceMSType = "CONV";
}
if (Session.s_strMSRetryFlag.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR RETRY TO CONNECT TO MEDIASERVER.");
}
if (Session.s_strOutdialDialingPlan.length <= 0)
{
	Server.logInfo("WARNING:  NO SETTING FOR OUTDIAL DIALING PLAN.");
}
if (Session.s_strOutdialDigitMap.length <= 0)
{
	Session.s_strOutdialDigitMap = "(1xxxxxxxxxx|[2-9]xxxxxxxxx|xx.*|x.#|x.T|*x)";
	Server.logInfo("WARNING: NO SETTING OUTDIAL DIGIT MAP.  USE DEFAULT: " + Session.s_strOutdialDigitMap);
}
if (Session.s_nRING_NO_ANSWER_TIME <= 0)
{
	Session.s_nRING_NO_ANSWER_TIME = 60;
	Server.logInfo("WARNING: NO SETTING RING NO ANSWER TIME.  USE DEFAULT: " + Session.s_nRING_NO_ANSWER_TIME);
}


if (Session.s_strSessionTimerFlag.length <= 0 || "F" == Session.s_strSessionTimerFlag)
{
	Session.s_strSessionTimerFlag = "F";
	Server.logInfo("WARNING: NO SETTING FOR SESSION TIMER FLAG.  USE DEFAULT: F");
	Session.s_nSessionTimerInterval = 0;
	Server.logInfo("WARNING: NO SETTING SESSION TIMER INTERVAL.  USE DEFAULT: 0");

}
else
{
	if (Session.s_nSessionTimerInterval <= 0)
	{
		Session.s_nSessionTimerInterval = 120;
		Server.logInfo("WARNING: NO SETTING SESSION TIMER INTERVAL.  USE DEFAULT: 120");
	}
}


if (Session.s_strOutdialDialingPlan.length <= 0)
{
	Session.s_strOutdialDialingPlan = "1";
	Server.logInfo("WARNING: NO SETTING FOR DIALING PLAN.  USE DEFAULT: 1");
}
Session.s_strVia = Session.s_strSIPVERSION + "/" + Session.s_strPROTOCOL + " " + Session.s_strLocalHost;
Session.s_strContact = "sip:" + Session.s_strLocalHost;
if( Server.sipPort != 5060 )
{
	Session.s_strVia += ":" + Server.sipPort ;
	Session.s_strContact += ":" + Server.sipPort;
}
if (Session.s_strIgnorePinLanguage.length <= 0)
{
	Session.s_strIgnorePinLanguage = "F";
}
if (Session.s_nConferenceMaxParties <= 0)
{
	Session.s_nConferenceMaxParties = 125;
	Server.logInfo("WARNING: NO SETTING CONFERENCE MAX PARTIES.  USE DEFAULT: 125");
}
if (Session.s_nConferenceMaxTalkers <= 0)
{
	Session.s_nConferenceMaxTalkers = 16;
	Server.logInfo("WARNING: NO SETTING CONFERENCE MAX TALKERS.  USE DEFAULT: 16");
}
if (Session.s_strCodec.length <= 0)
{
	Session.s_strCodec = "PCMU";
	Server.logInfo("WARNING: NO SETTING FOR CODEC.  USE DEFAULT: PCMU");
}
Session.s_nSoapPort = Server.soapPort;


js_initCSR_REASONS(Session.s_oCSR_REASONS);
]]></script>
          </scripts>
        </action>
        <action id="11" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=875 y=229 ?>
          <return value=""/>
        </action>
        <action id="12" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=638 y=231 ?>
          <!--"APIGetTestData"-->
          <function name="&quot;APIGetTestData&quot;" return="" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oTestData</parameter>
          </function>
          <results >
            <result name="Default" link="11" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oTestData.strConferenceTestFlag = "";
Session.g_oTestData.strPostpaidTestFlag = "";
Session.g_oTestData.strPrepaidTestFlag = "";
Session.g_oTestData.strTestDestinationNumber = "";
Session.g_oTestData.strTestInfoDigits = "";
Session.g_oTestData.strTestOriginationNumber = "";]]></script>
            <script language="javascript" timing="last" ><![CDATA[Session.s_strTestModeFlag = Session.g_oTestData.strPostpaidTestFlag;]]></script>
          </scripts>
        </action>
        <action id="13" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=409 y=231 ?>
          <!--"PostpaidAPIUnlockAllPins"-->
          <function name="&quot;PostpaidAPIUnlockAllPins&quot;" return="" external-function="1" library="lib_APISce.xml" >
            <parameter >s_strLocalHost</parameter>
          </function>
          <results >
            <result name="Default" link="12" stubbed="0"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="OnSessionEnd" start="32" event="OnSessionEnd" returns="void" >
      <parameters >
        <parameter name="nSessionEndReason" type="i2"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="32" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=114 y=311 ?>
          <!--stop all timers-->
          <function name="&quot;StopTimers&quot;" return="" external-function="1" library="lib_utils.xml" >
            <parameter >g_oTimerGSXA</parameter>
            <parameter >g_oTimerMaxTime</parameter>
            <parameter >g_oTimerPhoneA</parameter>
            <parameter >g_oTimerThreshold1</parameter>
            <parameter >g_oTimerThreshold2</parameter>
            <parameter >g_oTimerThreshold3</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oTimerMaxTimeALeg</parameter>
          </function>
          <results >
            <result name="Default" link="31" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=359 y=457 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("INFO: postpaid.END SESSION.3: SUCCESS");
Session.g_nCurrentState = Session.s_nEND_CALL;
js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="30" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=537 y=107 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="31" stubbed="1"/>
          </results>
        </action>
        <action id="31" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=341 y=312 ?>
          <!--procSessionCompletion-->
          <function name="&quot;PostpaidAPISessionCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
          </function>
          <results >
            <result name="Default" link="34" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (Session.f_nReturnCode != 0)
{
	Server.logError("ERROR: FAIL TO CALL PROC SESSION COMPLETION");
	Server.logError("ERROR: procSessionCompletion returned: " + Session.f_nReturnCode);
}]]></script>
          </scripts>
        </action>
        <action id="34" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=567 y=310 ?>
          <!--delete MS connection-->
          <function name="&quot;DeleteMSConnection&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
          </function>
          <results >
            <result name="Default" link="43" stubbed="0"/>
          </results>
        </action>
        <action id="35" plug-in="Pactolus.Branch.1" ><?xtml-editor x=323 y=145 ?>
          <!--did we write atleast 1 CDR?-->
          <results >
            <result name="Default" link="30" stubbed="0"/>
            <result name="wrote CDR already" link="31" stubbed="1" >g_oAPI.bWriteAtleastOneCDR == true</result>
          </results>
        </action>
        <action id="36" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1255 y=309 ?>
          <!--"DeleteConference"-->
          <function name="&quot;DeleteConference&quot;" return="" external-function="1" library="lib_mediaserver.xml" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="37" stubbed="1"/>
          </results>
        </action>
        <action id="37" plug-in="Pactolus.Branch.1" ><?xtml-editor x=122 y=499 ?>
          <!--what state-->
          <results >
            <result name="Default" link="2" stubbed="0"/>
            <result name="BEGIN ASSIGNMENT" link="38" stubbed="0" >g_nCurrentState == s_nBEGINASSIGNMENT
OR g_nCurrentState == s_nREQUEUE</result>
            <result name="BEGIN REQUEST" link="40" stubbed="0" >g_nCurrentState == s_nBEGINREQUEST</result>
          </results>
        </action>
        <action id="38" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=376 y=558 ?>
          <!--Soap EndRequest-->
          <function name="&quot;MsgEndRequestCSR&quot;" return="" external-function="1" library="lib_soap.xml" >
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="39" stubbed="0"/>
          </results>
        </action>
        <action id="39" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=609 y=560 ?>
          <!--"ACDAPIEndAssignment"-->
          <function name="&quot;ACDAPIEndAssignment&quot;" return="" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="1"/>
          </results>
        </action>
        <action id="40" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=386 y=709 ?>
          <!--Soap EndRequest-->
          <function name="&quot;MsgEndRequestCSR&quot;" return="" external-function="1" library="lib_soap.xml" >
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="41" stubbed="0"/>
          </results>
        </action>
        <action id="41" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=619 y=711 ?>
          <!--"ACDAPIEndRequest"-->
          <function name="&quot;ACDAPIEndRequest&quot;" return="" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oSUB</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="1"/>
          </results>
        </action>
        <action id="42" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1026 y=303 ?>
          <!--delete MOH connection-->
          <function name="&quot;DeleteMSConnection&quot;" return="" external-function="1" library="" >
            <parameter >g_oMOH_MS</parameter>
          </function>
          <results >
            <result name="Default" link="36" stubbed="0"/>
          </results>
        </action>
        <action id="43" plug-in="Pactolus.Branch.1" ><?xtml-editor x=778 y=308 ?>
          <!--in MOH conf?-->
          <results >
            <result name="Default" link="42" stubbed="0"/>
            <result name="MOH.bCurrentlyInConf" link="44" stubbed="0" >g_oMOH_MS.bCurrentlyInConf == true</result>
          </results>
        </action>
        <action id="44" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1043 y=418 ?>
          <!--"DisconnectFromMOH"-->
          <function name="&quot;DisconnectFromMOH&quot;" return="" external-function="1" library="lib_moh.xml" >
            <parameter >g_oMOH_MS</parameter>
            <parameter >g_oMOH_MS.strSessionId</parameter>
            <parameter >g_oMOH_MS.nConfIndex</parameter>
            <parameter >g_oAPI.strPlatformSessionId</parameter>
          </function>
          <results >
            <result name="Default" link="36" stubbed="1"/>
          </results>
        </action>
      </actions>
      <text-objects >
        <text-object x-coord="979" y-coord="192" width="215" height="51" text="may not in the MOH conference, but using MOH ms" font-name="Times New Roman" size="-16" red="0" green="0" blue="0" weight="0" underline="0" strikeout="0" point-size="12" italic="0"/>
      </text-objects>
    </function>
    <function name="OldStopAllTimers" start="9" event="OldStopAllTimers" returns="void" >
      <actions >
        <action id="9" plug-in="Pactolus.Branch.1" ><?xtml-editor x=83 y=228 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="15" stubbed="0"/>
            <result name="TimerSecAvailFlag==true" link="1" stubbed="0" >g_bTimerSecAvailFlag == true</result>
          </results>
        </action>
        <action id="1" plug-in="Standard.Timer.1" ><?xtml-editor x=316 y=330 ?>
          <!--stop the timer now-->
          <timer start="0" id="g_lTimerId1" duration=""/>
          <results >
            <result name="Default" link="15" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerSecAvailFlag = false;]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.Timer.1" ><?xtml-editor x=814 y=332 ?>
          <!--stop phoneA session timer-->
          <timer start="0" id="g_lTimerIdA" duration=""/>
          <results >
            <result name="Default" link="8" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerAFlag = false;]]></script>
          </scripts>
        </action>
        <action id="3" plug-in="Standard.Timer.1" ><?xtml-editor x=1061 y=331 ?>
          <!--stop PhoneB session timer-->
          <timer start="0" id="g_lTimerIdB" duration=""/>
          <results >
            <result name="Default" link="13" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerBFlag = false;]]></script>
          </scripts>
        </action>
        <action id="7" plug-in="Pactolus.Branch.1" ><?xtml-editor x=549 y=200 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="8" stubbed="0"/>
            <result name="TimerAFlag==true" link="2" stubbed="0" >g_bTimerAFlag == true</result>
          </results>
        </action>
        <action id="8" plug-in="Pactolus.Branch.1" ><?xtml-editor x=796 y=195 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="13" stubbed="0"/>
            <result name="TimerBFlag==true" link="3" stubbed="0" >g_bTimerBFlag == true</result>
          </results>
        </action>
        <action id="13" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1046 y=190 ?>
          <return value=""/>
        </action>
        <action id="14" plug-in="Standard.Timer.1" ><?xtml-editor x=566 y=333 ?>
          <!--stop threshold timer-->
          <timer start="0" id="g_lTimerIdThreshold" duration=""/>
          <results >
            <result name="Default" link="7" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[Session.g_bTimerThresholdFlag = false;]]></script>
          </scripts>
        </action>
        <action id="15" plug-in="Pactolus.Branch.1" ><?xtml-editor x=302 y=204 ?>
          <!--timerflag==true-->
          <results >
            <result name="Default" link="7" stubbed="0"/>
            <result name="TimerThresholdFlag==true" link="14" stubbed="0" >g_bTimerThresholdFlag == true</result>
          </results>
        </action>
      </actions>
    </function>
    <function name="OnCancel" start="6" event="OnCancel" returns="void" >
      <parameters >
        <parameter name="strAccept" type="string"/>
        <parameter name="strAcceptEncoding" type="string"/>
        <parameter name="strAcceptLanguage" type="string"/>
        <parameter name="strAuthorization" type="string"/>
        <parameter name="strCallId" type="string"/>
        <parameter name="strContent" type="string"/>
        <parameter name="strContentDisposition" type="string"/>
        <parameter name="strContentType" type="string"/>
        <parameter name="strCSeq" type="string"/>
        <parameter name="strDate" type="string"/>
        <parameter name="strEncryption" type="string"/>
        <parameter name="strErrorInfo" type="string" pass="byref"/>
        <parameter name="strFrom" type="string"/>
        <parameter name="strMaxForwards" type="string"/>
        <parameter name="strProxyAuthorization" type="string"/>
        <parameter name="strProxyRequire" type="string"/>
        <parameter name="strRecordRoute" type="string"/>
        <parameter name="strRequestUri" type="string"/>
        <parameter name="strRequire" type="string"/>
        <parameter name="strResponseKey" type="string"/>
        <parameter name="strRoute" type="string"/>
        <parameter name="strSupported" type="string"/>
        <parameter name="strTimestamp" type="string"/>
        <parameter name="strTo" type="string"/>
        <parameter name="strUserAgent" type="string" pass="byref"/>
        <parameter name="strVia" type="string"/>
      </parameters>
      <actions >
        <action id="6" plug-in="Pactolus.Branch.1" ><?xtml-editor x=107 y=241 ?>
          <!--valid?-->
          <results >
            <result name="Default" link="9" stubbed="0"/>
            <result name="sent final response == false" link="1" stubbed="0" >g_bSentFinalResponse == false</result>
          </results>
        </action>
        <action id="1" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=356 y=373 ?>
          <!--200 OK-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="3" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="3" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=616 y=375 ?>
          <!--487 request terminated-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 487 Request Terminated"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="10" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[var cseq = new SipCSeq(Session.strCSeq);
cseq.method = "INVITE";
Session.strCSeq = cseq.encode();]]></script>
          </scripts>
        </action>
        <action id="5" plug-in="Standard.EndSession.1" ><?xtml-editor x=1092 y=374 ?></action>
        <action id="8" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=588 y=179 ?>
          <return value=""/>
        </action>
        <action id="9" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=345 y=174 ?>
          <!--200 OK-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="0" >
            <call-id >strCallId</call-id>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 200 OK"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="8" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="10" plug-in="Pactolus.UserFunction.1" ><?xtml-editor x=854 y=371 ?>
          <!--send alert early-call-cancel-->
          <user-function process="&quot;PACTOLUS_ps_snmp_event&quot;" function="&quot;increment_event_counter&quot;" timeout="s_nTIMEOUT" return="" async="1" >
            <parameter >"early-call-cancel"</parameter>
          </user-function>
          <results >
            <result name="Default" link="5" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="PlayPromptAndHangup" start="5" event="PlayPromptAndHangup" returns="i4" >
      <actions >
        <action id="5" plug-in="Pactolus.Branch.1" ><?xtml-editor x=196 y=301 ?>
          <!--error msg > 0 ?-->
          <results >
            <result name="Default" link="4" stubbed="0"/>
            <result name="error msg &gt; 0 ?" link="3" stubbed="0" >g_nErrorMsgNumber &gt; 0</result>
          </results>
        </action>
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=626 y=236 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=840 y=236 ?>
          <return value=""/>
        </action>
        <action id="3" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=418 y=417 ?>
          <!--g_nErrorMsgNumber-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >365</audio>
            <audio type="number" >g_nErrorMsgNumber</audio>
          </play>
          <results >
            <result name="Default" link="4" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="4" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=401 y=244 ?>
          <!--good bye-->
          <play connection-id="g_oMS.strConnectionId" endpoint="g_oMS.strEndPoint" callid="g_oMS.strCallId" repeat="1" timeout="5" ms-type="g_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >322</audio>
          </play>
          <results >
            <result name="Default" link="1" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="InitializeCallLeg" start="1" event="InitializeCallLeg" returns="i4" >
      <actions >
        <action id="1" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=110 y=149 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[// Phone outdial call leg object
Server.logInfo("ARRAY CALL LEGS LENGTH IS: " + Session.g_oArrayCallLegs.length);
Session.g_nCurrentArrayIndex = Session.g_oArrayCallLegs.length;
Server.logInfo("CURRENT ARRAY INDEX: " + Session.g_nCurrentArrayIndex);
Server.logInfo("CALL LEG CALL ID LENGTH: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex - 1].strCallId.length);
if (0 == Session.g_oArrayCallLegs.length  || Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex - 1].strCallId.length != 0)
{
	//initialize calll leg
	Server.logInfo("INITIALIZE NEW CALL LEG IN THE ARRAY");
	js_initCallLeg(Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex]);
	
	if(Session.g_oAPI.strPrimarySoftswitchIP.length > 0) {
		Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri = Session.g_oAPI.strPrimarySoftswitchIP;
	} else {
		Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri = Session.s_strPrimaryPSX;
	}

	if(Session.g_oAPI.strBackupSoftswitchIP.length > 0) {
		Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBackupRequestUri = Session.g_oAPI.strBackupSoftswitchIP;
	} else {
		Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBackupRequestUri = Session.s_strBackupPSX;
	}	

	js_initMS(Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS, Session.s_strMSType);
	js_initTimer(Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oTimer);
	
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strConfCallFlag = Session.g_oCallLegB.strConfCallFlag;
}
else
{
	Session.g_nCurrentArrayIndex--;
}
/*
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oTimer.lTimerId = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oTimer.lSleepTime = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oTimer.bOn = false;

Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].bReverseFromTo = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].bCurrentlyDialing = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].bAttemptedToOutdial = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].bConnected = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strSessionTimerFlag = Session.s_strSessionTimerFlag;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].nSessionTimer = Session.s_nSessionTimerInterval;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].nRingNoAnswerTime = Session.s_nRING_NO_ANSWER_TIME;


if(Session.g_oAPI.strPrimarySoftswitchIP.length > 0) {
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri = Session.g_oAPI.strPrimarySoftswitchIP;
} else {
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri = Session.s_strPrimaryPSX;
}

if(Session.g_oAPI.strBackupSoftswitchIP.length > 0) {
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBackupRequestUri = Session.g_oAPI.strBackupSoftswitchIP;
} else {
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBackupRequestUri = Session.s_strBackupPSX;
}

Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContent = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCSeq = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strFrom = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strTo = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRoute = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRecordRoute = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContact = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].nSetUpTime = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].nTearDownTime = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strOutdialDestNbr = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestDomIntlFlag = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].nDestCountryId = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestCallingCode = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestAreaCode = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strEventId = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeAnswered = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeStart = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCodec = Session.s_strCodec;


Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strContent = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strCallId = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strEndPoint = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConnectionId = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strType = Session.s_strConferenceMSType;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConferenceId = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bMuteFlag = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bDeafFlag = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bPersistentFlag = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bCurrentlyInConf = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bCurrentlyConnected = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bRetry = false;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.nPacketizationPeriod = Session.s_nPacketizationPeriod;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.nConferenceMaxParties = Session.s_nConferenceMaxParties;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.nConferenceMaxTalkers = Session.s_nConferenceMaxTalkers;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strCodec = Session.s_strCodec;
*/]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="HangUpOutdialLegsWriteCDR" start="1" event="HangUpOutdialLegsWriteCDR" returns="i4" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_nArrayIndex" type="i4" >0</var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Pactolus.Branch.1" ><?xtml-editor x=148 y=243 ?>
          <!--any call leg?-->
          <results >
            <result name="Default" link="6" stubbed="0"/>
            <result name="oArrayCallLeg.length &lt;= 0" link="5" stubbed="1" >g_oArrayCallLegs.length &lt;= 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("CURRENT ARRAY LENGTH IS: " + Session.g_oArrayCallLegs.length);
Session.g_nCurrentArrayIndex = 0;]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=635 y=252 ?>
          <!--Hang Up Party-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="0"/>
          </results>
        </action>
        <action id="3" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=161 y=388 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="4" stubbed="0"/>
          </results>
        </action>
        <action id="4" plug-in="Pactolus.Branch.1" ><?xtml-editor x=380 y=397 ?>
          <!--more to hangup?-->
          <results >
            <result name="Default" link="5" stubbed="0"/>
            <result name="g_nCurrentArrayIndex &lt; g_oArrayCallLegs.length" link="6" stubbed="1" >g_nCurrentArrayIndex &lt; g_oArrayCallLegs.length</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentArrayIndex++;]]></script>
          </scripts>
        </action>
        <action id="5" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=636 y=397 ?>
          <!--s_sSUCCESS-->
          <return value="s_sSUCCESS"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oArrayCallLegs.length = 0;]]></script>
          </scripts>
        </action>
        <action id="6" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=381 y=243 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
        </action>
      </actions>
      <text-objects >
        <text-object x-coord="97" y-coord="117" width="247" height="28" text="Hang up all outdial call legs in the array" font-name="Times New Roman" size="-16" red="0" green="0" blue="0" weight="0" underline="0" strikeout="0" point-size="12" italic="0"/>
      </text-objects>
    </function>
    <function name="HangUpAll" start="3" event="HangUpAll" returns="i4" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="3" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=177 y=279 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="4" stubbed="0"/>
          </results>
        </action>
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=681 y=278 ?>
          <!--"HangUpOutdialLegsWriteCDR"-->
          <function name="&quot;HangUpOutdialLegsWriteCDR&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=939 y=269 ?>
          <!--s_sSUCCESS-->
          <return value="s_sSUCCESS"/>
        </action>
        <action id="4" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=421 y=280 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="0"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="OnDTMF" start="1" event="OnDTMF" returns="void" >
      <parameters >
        <parameter name="strEndpoint" type="string" pass="byref"/>
        <parameter name="strRequestId" type="string" pass="byref"/>
        <parameter name="strDtmf" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nCounter" type="i4" >0</var>
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_lOutdialConnectTime" type="i8" >0</var>
        <var name="f_lOutdialStartTime" type="i8" >0</var>
        <var name="f_strInputDigit" type="string" ></var>
        <var name="f_strSIPStatus" type="string" ></var>
        <var name="f_strDigitMap" type="string" ></var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Pactolus.Branch.1" ><?xtml-editor x=65 y=196 ?>
          <!--menu?-->
          <results >
            <result name="Default" link="3" stubbed="0"/>
            <result name="strDtmf == s_strPoundReoriginate" link="4" stubbed="0" >strDtmf match s_strPoundReoriginate</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();
Server.logInfo("Got Digit: " + Session.strDtmf);]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=526 y=188 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="3" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=281 y=186 ?>
          <!--"SetDTMFOn"-->
          <function name="&quot;SetDTMFOn&quot;" return="" external-function="1" library="lib_mediaserver.xml" >
            <parameter >g_oConferenceMS</parameter>
            <parameter >f_strDigitMap</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_strDigitMap = "(" + Session.s_strPoundReoriginate + ")";]]></script>
          </scripts>
        </action>
        <action id="4" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=299 y=308 ?>
          <!--modify conf member-->
          <function name="&quot;ModifyConferenceMember&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="1"/>
            <result name="SUCCESS" link="23" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oConferenceMS.bMuteFlag = true;
Session.g_oConferenceMS.bDeafFlag = true;
Server.logInfo("INFO: MAIN MENU MODIFY MEMBER CONFERENCE.");
Session.f_nCounter = Session.g_oAPI.nMaxLoginAttempts;]]></script>
          </scripts>
        </action>
        <action id="5" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=796 y=310 ?>
          <!--add, drop, other?-->
          <play connection-id="g_oConferenceMS.strConnectionId" endpoint="g_oConferenceMS.strEndPoint" callid="g_oConferenceMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oConferenceMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="&quot;(1|2|3)&quot;" language="g_oAPI.strLanguage" digits="f_strInputDigit" retry-count="f_nCounter" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >311</audio>
            <audio type="index" >362</audio>
            <audio type="index" >312</audio>
            <audio type="index" >362</audio>
            <audio type="index" >313</audio>
            <timeout-prompt type="index" >552</timeout-prompt>
          </play>
          <results >
            <result name="Default" link="27" stubbed="1"/>
            <result name="Success" link="7" stubbed="0"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="6" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1305 y=309 ?>
          <!--max retry?-->
          <results >
            <result name="Default" link="27" stubbed="0"/>
            <result name="counter &gt; 0?" link="5" stubbed="1" >f_nCounter &gt; 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nCounter--;
Session.f_strInputDigit = "";]]></script>
          </scripts>
        </action>
        <action id="7" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1052 y=311 ?>
          <!--1 or 2?-->
          <results >
            <result name="Default" link="6" stubbed="0"/>
            <result name="1 reoriginate" link="8" stubbed="0" >f_strInputDigit match "1"</result>
            <result name="2 add more party" link="25" stubbed="0" >f_strInputDigit match "2"</result>
            <result name="3 drop last" link="20" stubbed="0" >f_strInputDigit match "3"</result>
          </results>
        </action>
        <action id="8" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1319 y=432 ?>
          <!--"HangUpOutdialLegsWriteCDR"-->
          <function name="&quot;HangUpOutdialLegsWriteCDR&quot;" return="f_nReturnCode" external-function="0" library=""/>
          <results >
            <result name="Default" link="9" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
          </scripts>
        </action>
        <action id="9" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=168 y=574 ?>
          <!--"GetAndValidateConfDest"-->
          <function name="&quot;GetAndValidateConfDest&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="14" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
          </scripts>
        </action>
        <action id="10" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=532 y=1016 ?>
          <!--modify conf member-->
          <function name="&quot;ModifyConferenceMember&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="18" stubbed="0"/>
            <result name="SUCCESS" link="13" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oConferenceMS.bMuteFlag = false;
Session.g_oConferenceMS.bDeafFlag = false;
Session.g_oConferenceMS.bDTMFClampFlag = false;
Server.logInfo("INFO: MAIN MENU MODIFY MEMBER CONFERENCE.");]]></script>
          </scripts>
        </action>
        <action id="11" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=658 y=568 ?>
          <!--Hang Up Phone A-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="12" stubbed="0"/>
          </results>
        </action>
        <action id="12" plug-in="Standard.EndSession.1" ><?xtml-editor x=892 y=563 ?></action>
        <action id="13" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=768 y=1107 ?>
          <!--OutdialParty C ToConference-->
          <function name="&quot;OutdialPartyToConference&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
            <parameter >f_lOutdialStartTime</parameter>
            <parameter >f_lOutdialConnectTime</parameter>
            <parameter >f_strSIPStatus</parameter>
            <parameter >s_strDEFAULT_ANI</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="1"/>
            <result name="SUCCESS" link="29" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConferenceId = Session.g_oConferenceMS.strConferenceId;]]></script>
          </scripts>
        </action>
        <action id="14" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=412 y=569 ?>
          <!--put A on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="11" stubbed="0"/>
            <result name="SUCCESS" link="22" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
          </scripts>
        </action>
        <action id="15" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=929 y=681 ?>
          <!--"DeleteConference"-->
          <function name="&quot;DeleteConference&quot;" return="" external-function="1" library="lib_mediaserver.xml" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="16" stubbed="0"/>
          </results>
        </action>
        <action id="16" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1179 y=680 ?>
          <!--"Main"-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="2" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nMAKE_CONNECTION;]]></script>
          </scripts>
        </action>
        <action id="17" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=320 y=1019 ?>
          <!--"GetAndValidateConfDest"-->
          <function name="&quot;GetAndValidateConfDest&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="10" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;]]></script>
          </scripts>
        </action>
        <action id="18" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=752 y=1008 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="f_nReturnCode" external-function="0" library=""/>
          <results >
            <result name="Default" link="12" stubbed="1"/>
          </results>
        </action>
        <action id="19" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=379 y=791 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="28" stubbed="0"/>
          </results>
        </action>
        <action id="20" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=124 y=860 ?>
          <!--Hang Up Party-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="19" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentArrayIndex = Session.g_oArrayCallLegs.length - 1;
Server.logInfo("ARRAY LENGTH IS : " + Session.g_oArrayCallLegs.length);
Server.logInfo("ARRAY INDEX IS : " + Session.g_nCurrentArrayIndex);]]></script>
          </scripts>
        </action>
        <action id="21" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=906 y=854 ?>
          <!--modify conf member-->
          <function name="&quot;ModifyConferenceMember&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="18" stubbed="1"/>
            <result name="SUCCESS" link="24" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oConferenceMS.bMuteFlag = false;
Session.g_oConferenceMS.bDeafFlag = false;
Session.g_oConferenceMS.bDTMFClampFlag = false;
Server.logInfo("INFO: MAIN MENU MODIFY MEMBER CONFERENCE.");
// Session.g_oArrayCallLegs.length--;
Server.logInfo("Remove call leg from array");
Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
{	
	Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
	Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
	Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
{
	Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
	Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
	Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
}]]></script>
          </scripts>
        </action>
        <action id="22" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=679 y=685 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="15" stubbed="0"/>
          </results>
        </action>
        <action id="23" plug-in="Pactolus.Branch.1" ><?xtml-editor x=554 y=312 ?>
          <!--more call legs?-->
          <results >
            <result name="Default" link="9" stubbed="1"/>
            <result name="g_oArrayCallLegs.length &gt; 0?" link="5" stubbed="0" >g_oArrayCallLegs.length &gt; 0</result>
          </results>
        </action>
        <action id="24" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1173 y=850 ?>
          <!--more call legs?-->
          <results >
            <result name="Default" link="9" stubbed="1"/>
            <result name="g_oArrayCallLegs.length &gt; 0?" link="3" stubbed="1" >g_oArrayCallLegs.length &gt; 0</result>
          </results>
        </action>
        <action id="25" plug-in="Pactolus.Branch.1" ><?xtml-editor x=78 y=1023 ?>
          <!--max?-->
          <results >
            <result name="Default" link="17" stubbed="0"/>
            <result name="g_oArrayCallLegs.length &gt;= max" link="26" stubbed="0" >g_oArrayCallLegs.length &gt;= g_nMaxPartiesAllowed</result>
          </results>
        </action>
        <action id="26" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=337 y=1121 ?>
          <!--reach max-->
          <play connection-id="g_oConferenceMS.strConnectionId" endpoint="g_oConferenceMS.strEndPoint" callid="g_oConferenceMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="g_oConferenceMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >301</audio>
            <audio type="index" >924</audio>
          </play>
          <results >
            <result name="Default" link="27" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="27" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1534 y=304 ?>
          <!--modify conf member-->
          <function name="&quot;ModifyConferenceMember&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oConferenceMS.bMuteFlag = false;
Session.g_oConferenceMS.bDeafFlag = false;
Session.g_oConferenceMS.bDTMFClampFlag = false;
Server.logInfo("INFO: MAIN MENU MODIFY MEMBER CONFERENCE.");]]></script>
          </scripts>
        </action>
        <action id="28" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=632 y=855 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
          </function>
          <results >
            <result name="Default" link="21" stubbed="0"/>
          </results>
        </action>
        <action id="29" plug-in="Pactolus.Branch.1" ><?xtml-editor x=1012 y=1103 ?>
          <results >
            <result name="Default" link="3" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("CALLING js_calculate_uri_and_route");
Server.logInfo("BEFORE contact: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContact);
Server.logInfo("BEFORE record route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRecordRoute);
Server.logInfo("BEFORE request Uri: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);
Server.logInfo("BEFORE route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRoute);
var bDialIn = false;
js_calculate_uri_and_route(bDialIn, Session.s_strSIPVERSION, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strFrom, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContact, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRecordRoute, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRoute);
Server.logInfo("AFTER contact: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContact);
Server.logInfo("AFTER record route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRecordRoute);
Server.logInfo("AFTER request Uri: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);
Server.logInfo("AFTER route: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRoute);
Server.logInfo("Call leg C request Uri is: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strRequestUri);

Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeStart = Session.f_lOutdialStartTime;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeAnswered = Session.f_lOutdialConnectTime;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].bConnected = true;
Server.logInfo("START TIME IS: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeStart);
Server.logInfo("ANSWER TIME IS: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeAnswered);

Session.g_oAPI.nCurrentNumberCallLegs++;]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="Begin3WayConference" start="1" event="Begin3WayConference" returns="i4" >
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_nArrayIndex" type="i4" >0</var>
        <var name="f_strDigitMap" type="string" ></var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=94 y=279 ?>
          <!--put A on hold-->
          <function name="&quot;PutPartyOnHold&quot;" return="f_nReturnCode" external-function="1" library="" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="7" stubbed="0"/>
            <result name="SUCCESS" link="2" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
        </action>
        <action id="2" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=325 y=379 ?>
          <!--Delete MS Connection-->
          <function name="&quot;DeleteMSConnection&quot;" return="" external-function="1" library="" >
            <parameter >g_oMS</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="0"/>
          </results>
        </action>
        <action id="3" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=548 y=377 ?>
          <!--"3WayCalling"-->
          <function name="&quot;3WayCalling&quot;" return="f_nReturnCode" external-function="1" library="lib_3WayCalling.xml" >
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs</parameter>
            <parameter >g_oConferenceMS</parameter>
            <parameter >s_strContact</parameter>
            <parameter >s_strDEFAULT_ANI</parameter>
          </function>
          <results >
            <result name="Default" link="6" stubbed="0"/>
            <result name="FAILURE" link="7" stubbed="1" >f_nReturnCode == s_sFAILURE</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();

Session.f_nArrayIndex = Session.g_nCurrentArrayIndex - 1;

Server.logInfo("BEFORE SENDING TO 3 WAY CALLING: ");
Server.logInfo("CALL LEG ARRAY LENGTH IS: " + Session.g_oArrayCallLegs.length);
Server.logInfo("ARRAY INDEX NOW IS: " + Session.g_nCurrentArrayIndex);

Server.logInfo("oCallLegA.strFrom: " + Session.g_oCallLegA.strFrom);
Server.logInfo("oCallLegA.strTo: " + Session.g_oCallLegA.strTo);
Server.logInfo("oCallLegA.strContent: " + Session.g_oCallLegA.strContent);
Server.logInfo("oCallLegA.strCSeq: " + Session.g_oCallLegA.strCSeq);
Server.logInfo("oCallLegA.strCallId: " + Session.g_oCallLegA.strCallId);

Server.logInfo("oCallLegA.g_oConferenceMS.strContent: " + Session.g_oConferenceMS.strContent);
Server.logInfo("oCallLegA.g_oConferenceMS.strCallId: " + Session.g_oConferenceMS.strCallId);
Server.logInfo("oCallLegA.g_oConferenceMS.strEndPoint: " + Session.g_oConferenceMS.strEndPoint);
Server.logInfo("oCallLegA.g_oConferenceMS.strConnectionId: " + Session.g_oConferenceMS.strConnectionId);
Server.logInfo("oCallLegA.g_oConferenceMS.strType: " + Session.g_oConferenceMS.strType);
Server.logInfo("oCallLegA.g_oConferenceMS.strConferenceId: " + Session.g_oConferenceMS.strConferenceId);
Server.logInfo("oCallLegA.g_oConferenceMS.bMuteFlag: " + Session.g_oConferenceMS.bMuteFlag);
Server.logInfo("oCallLegA.g_oConferenceMS.bDeafFlag: " + Session.g_oConferenceMS.bDeafFlag);
Server.logInfo("oCallLegA.g_oConferenceMS.bCurrentlyInConf: " + Session.g_oConferenceMS.bCurrentlyInConf);
Server.logInfo("oCallLegA.g_oConferenceMS.bRetry: " + Session.g_oConferenceMS.bRetry);
Server.logInfo("oCallLegA.g_oConferenceMS.nPacketizationPeriod: " + Session.g_oConferenceMS.nPacketizationPeriod);


Server.logInfo("oCallLegB.strFrom: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strFrom);
Server.logInfo("oCallLegB.strTo: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strTo);
Server.logInfo("oCallLegB.strContent: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strContent);
Server.logInfo("oCallLegB.strCSeq: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strCSeq);
Server.logInfo("oCallLegB.strCallId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strCallId);
Server.logInfo("oCallLegB.oMS.strContent: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strContent);
Server.logInfo("oCallLegB.oMS.strCallId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strCallId);
Server.logInfo("oCallLegB.oMS.strEndPoint: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strEndPoint);
Server.logInfo("oCallLegB.oMS.strConnectionId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strConnectionId);
Server.logInfo("oCallLegB.oMS.strType: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strType);
Server.logInfo("oCallLegB.oMS.strConferenceId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strConferenceId);
Server.logInfo("oCallLegB.oMS.bMuteFlag: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bMuteFlag);
Server.logInfo("oCallLegB.oMS.bDeafFlag: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bDeafFlag);
Server.logInfo("oCallLegB.oMS.bCurrentlyInConf: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bCurrentlyInConf);
Server.logInfo("oCallLegB.oMS.bRetry: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bRetry);
Server.logInfo("oCallLegB.oMS.nPacketizationPeriod: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.nPacketizationPeriod);


Server.logInfo("oCallLegC.strFrom: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strFrom);
Server.logInfo("oCallLegC.strTo: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strTo);
Server.logInfo("oCallLegC.strContent: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContent);
Server.logInfo("oCallLegC.strCSeq: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCSeq);
Server.logInfo("oCallLegC.strCallId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
Server.logInfo("oCallLegC.oMS.strContent: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strContent);
Server.logInfo("oCallLegC.oMS.strCallId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strCallId);
Server.logInfo("oCallLegC.oMS.strEndPoint: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strEndPoint);
Server.logInfo("oCallLegC.oMS.strConnectionId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConnectionId);
Server.logInfo("oCallLegC.oMS.strType: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strType);
Server.logInfo("oCallLegC.oMS.strConferenceId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConferenceId);
Server.logInfo("oCallLegC.oMS.bMuteFlag: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bMuteFlag);
Server.logInfo("oCallLegC.oMS.bDeafFlag: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bDeafFlag);
Server.logInfo("oCallLegC.oMS.bCurrentlyInConf: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bCurrentlyInConf);
Server.logInfo("oCallLegC.oMS.bRetry: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bRetry);
Server.logInfo("oCallLegC.oMS.nPacketizationPeriod: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.nPacketizationPeriod);
]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("AFTER SENDING TO 3 WAY CALLING: ");
Server.logInfo("CALL LEG ARRAY LENGTH IS: " + Session.g_oArrayCallLegs.length);
Server.logInfo("ARRAY INDEX NOW IS: " + Session.g_nCurrentArrayIndex);
Server.logInfo("RETURN FROM 3WAY CALLING START TIME IS: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeStart);
Server.logInfo("RETURN FROM 3WAY CALLING ANSWER TIME IS: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].lTimeAnswered);

Server.logInfo("oCallLegA.strFrom: " + Session.g_oCallLegA.strFrom);
Server.logInfo("oCallLegA.strTo: " + Session.g_oCallLegA.strTo);
Server.logInfo("oCallLegA.strContent: " + Session.g_oCallLegA.strContent);
Server.logInfo("oCallLegA.strCSeq: " + Session.g_oCallLegA.strCSeq);
Server.logInfo("oCallLegA.strCallId: " + Session.g_oCallLegA.strCallId);

Server.logInfo("oCallLegA.g_oConferenceMS.strContent: " + Session.g_oConferenceMS.strContent);
Server.logInfo("oCallLegA.g_oConferenceMS.strCallId: " + Session.g_oConferenceMS.strCallId);
Server.logInfo("oCallLegA.g_oConferenceMS.strEndPoint: " + Session.g_oConferenceMS.strEndPoint);
Server.logInfo("oCallLegA.g_oConferenceMS.strConnectionId: " + Session.g_oConferenceMS.strConnectionId);
Server.logInfo("oCallLegA.g_oConferenceMS.strType: " + Session.g_oConferenceMS.strType);
Server.logInfo("oCallLegA.g_oConferenceMS.strConferenceId: " + Session.g_oConferenceMS.strConferenceId);
Server.logInfo("oCallLegA.g_oConferenceMS.bMuteFlag: " + Session.g_oConferenceMS.bMuteFlag);
Server.logInfo("oCallLegA.g_oConferenceMS.bDeafFlag: " + Session.g_oConferenceMS.bDeafFlag);
Server.logInfo("oCallLegA.g_oConferenceMS.bCurrentlyInConf: " + Session.g_oConferenceMS.bCurrentlyInConf);
Server.logInfo("oCallLegA.g_oConferenceMS.bRetry: " + Session.g_oConferenceMS.bRetry);
Server.logInfo("oCallLegA.g_oConferenceMS.nPacketizationPeriod: " + Session.g_oConferenceMS.nPacketizationPeriod);


Server.logInfo("oCallLegB.strFrom: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strFrom);
Server.logInfo("oCallLegB.strTo: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strTo);
Server.logInfo("oCallLegB.strContent: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strContent);
Server.logInfo("oCallLegB.strCSeq: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strCSeq);
Server.logInfo("oCallLegB.strCallId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].strCallId);
Server.logInfo("oCallLegB.oMS.strContent: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strContent);
Server.logInfo("oCallLegB.oMS.strCallId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strCallId);
Server.logInfo("oCallLegB.oMS.strEndPoint: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strEndPoint);
Server.logInfo("oCallLegB.oMS.strConnectionId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strConnectionId);
Server.logInfo("oCallLegB.oMS.strType: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strType);
Server.logInfo("oCallLegB.oMS.strConferenceId: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.strConferenceId);
Server.logInfo("oCallLegB.oMS.bMuteFlag: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bMuteFlag);
Server.logInfo("oCallLegB.oMS.bDeafFlag: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bDeafFlag);
Server.logInfo("oCallLegB.oMS.bCurrentlyInConf: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bCurrentlyInConf);
Server.logInfo("oCallLegB.oMS.bRetry: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.bRetry);
Server.logInfo("oCallLegB.oMS.nPacketizationPeriod: " + Session.g_oArrayCallLegs[Session.f_nArrayIndex].oMS.nPacketizationPeriod);


Server.logInfo("oCallLegC.strFrom: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strFrom);
Server.logInfo("oCallLegC.strTo: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strTo);
Server.logInfo("oCallLegC.strContent: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strContent);
Server.logInfo("oCallLegC.strCSeq: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCSeq);
Server.logInfo("oCallLegC.strCallId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
Server.logInfo("oCallLegC.oMS.strContent: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strContent);
Server.logInfo("oCallLegC.oMS.strCallId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strCallId);
Server.logInfo("oCallLegC.oMS.strEndPoint: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strEndPoint);
Server.logInfo("oCallLegC.oMS.strConnectionId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConnectionId);
Server.logInfo("oCallLegC.oMS.strType: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strType);
Server.logInfo("oCallLegC.oMS.strConferenceId: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConferenceId);
Server.logInfo("oCallLegC.oMS.bMuteFlag: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bMuteFlag);
Server.logInfo("oCallLegC.oMS.bDeafFlag: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bDeafFlag);
Server.logInfo("oCallLegC.oMS.bCurrentlyInConf: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bCurrentlyInConf);
Server.logInfo("oCallLegC.oMS.bRetry: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.bRetry);
Server.logInfo("oCallLegC.oMS.nPacketizationPeriod: " + Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.nPacketizationPeriod);
]]></script>
          </scripts>
        </action>
        <action id="4" plug-in="Standard.EndSession.1" ><?xtml-editor x=517 y=234 ?></action>
        <action id="5" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=981 y=376 ?>
          <!--s_nCONNECTED-->
          <return value="s_nCONNECTED"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCurrentNumberCallLegs++;
js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="6" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=778 y=375 ?>
          <!--"SetDTMFOn"-->
          <function name="&quot;SetDTMFOn&quot;" return="" external-function="1" library="lib_mediaserver.xml" >
            <parameter >g_oConferenceMS</parameter>
            <parameter >f_strDigitMap</parameter>
          </function>
          <results >
            <result name="Default" link="5" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].bConnected = true;
Session.f_strDigitMap = "(" + Session.s_strPoundReoriginate + ")";]]></script>
          </scripts>
        </action>
        <action id="7" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=308 y=235 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="4" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 6;
Session.g_oAPI.nSessionTerminationReason = 5;
Server.logInfo("CALLING HANGUP ALL");
Server.logInfo("CALL LEG ARRAY LENGTH IS: " + Session.g_oArrayCallLegs.length);
Server.logInfo("ARRAY INDEX NOW IS: " + Session.g_nCurrentArrayIndex);]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="GetAndValidateConfDest" start="1" event="GetAndValidateConfDest" returns="i4" >
      <parameters >
        <parameter name="p_oMS" type="object"/>
      </parameters>
      <local-vars >
        <var name="f_bIsDestValid" type="boolean" >0</var>
        <var name="f_bMissDial" type="boolean" >0</var>
        <var name="f_bNullString" type="boolean" >0</var>
        <var name="f_nNumRetry" type="i4" >0</var>
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=200 y=238 ?>
          <!--InitializeCallLeg for outdial-->
          <function name="&quot;InitializeCallLeg&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="7" stubbed="0"/>
          </results>
        </action>
        <action id="2" plug-in="Pactolus.Branch.1" ><?xtml-editor x=776 y=374 ?>
          <!--null string?-->
          <results >
            <result name="Default" link="11" stubbed="0"/>
            <result name="missdial" link="7" stubbed="1" >f_bMissDial == true</result>
            <result name="invalid" link="8" stubbed="0" >f_bIsDestValid == false</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[var myDest = new String (Session.g_oAPI.strDestinationNumber)

if (myDest.length <= 1 && myDest != "*")
{
	Session.f_bIsDestValid = false;
}
else
{
	if ("*" == Session.g_strTerminationDigit)
	{
		Session.f_bMissDial = true;
	}
	else if ( '*' == myDest.charAt(0) )
	{
		Session.f_bIsDestValid = false;
	}
	else if (1 == Session.g_oAPI.nDialingPlanId)
	{
		if ('0' == myDest.charAt(0) )
		{
			if ( '1' == myDest.charAt(1) && '1' == myDest.charAt(2) )
			{
				Session.f_bIsDestValid = true;
			}
			else
			{
				Session.f_bIsDestValid = false;
			}
		}
		else if (myDest.length < 10)
		{
			Session.f_bIsDestValid = false;
		}
		else
		{
			Session.f_bIsDestValid = true;
		}
	}
	else
	{
		Session.f_bIsDestValid = true;
	}
}]]></script>
          </scripts>
        </action>
        <action id="3" plug-in="Standard.EndSession.1" ><?xtml-editor x=996 y=212 ?></action>
        <action id="4" plug-in="Pactolus.Branch.1" ><?xtml-editor x=716 y=562 ?>
          <!--max retry-->
          <results >
            <result name="Default" link="6" stubbed="1"/>
            <result name="f_nNumRetry &gt; 0" link="7" stubbed="1" >f_nNumRetry &gt; 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nSessionTerminationReason = 13;]]></script>
          </scripts>
        </action>
        <action id="5" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=490 y=723 ?>
          <!--s_sSUCCESS-->
          <return value="s_sSUCCESS"/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.strDestinationNumber = Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strOutdialDestNbr;
if (Session.s_strTestModeFlag == "T")
{
	Session.g_oAPI.strDestinationNumber = Session.g_oTestData.strTestDestinationNumber;
}
Server.logInfo("BEFORE g_oAPI.strDestinationNumber prepend : <" + Session.g_oAPI.strDestinationNumber + " >");
Session.g_oAPI.strDestinationNumber = js_prepend_digits(Session.g_oAPI.strDestinationNumber, Session.s_strDigitPrependToOutdial);
Server.logInfo("AFTER g_oAPI.strDestinationNumber prepend : <" + Session.g_oAPI.strDestinationNumber + " >");
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCalledNumber = Session.g_oAPI.strDestinationNumber;
Session.g_oCallLegA.strContent = Session.g_oCallLegA.strOriginalContent;
Session.f_lStartTime = Server.getUTCTime();]]></script>
          </scripts>
        </action>
        <action id="6" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=760 y=217 ?>
          <!--"HangUpAll"-->
          <function name="&quot;HangUpAll&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="3" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 6;
Session.g_oAPI.nSessionTerminationReason = 5;]]></script>
          </scripts>
        </action>
        <action id="7" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=480 y=234 ?>
          <!--507: Please enter the phone number you wish to reach. For international calls start with 011.-->
          <play connection-id="p_oMS.strConnectionId" endpoint="p_oMS.strEndPoint" callid="p_oMS.strCallId" repeat="1" timeout="40" ms-type="p_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="s_strOutdialDigitMap" language="g_oAPI.strLanguage" digits="g_oAPI.strDestinationNumber" retry-count="f_nNumRetry" clear-digits="0" terminating-digit="g_strTerminationDigit" quick-collect="0" digit-timer="" >
            <audio type="index" >4506</audio>
            <timeout-prompt type="index" >552</timeout-prompt>
          </play>
          <results >
            <result name="Default" link="6" stubbed="0"/>
            <result name="Success" link="2" stubbed="0"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.strDestinationNumber = "";
Session.g_nErrorMsgNumber = 0;
Session.g_strTerminationDigit = "";
Session.f_bIsDestValid = false;
Session.f_bMissDial = false;
Session.f_bNullString = false;
Session.f_nNumRetry = Session.g_oAPI.nMaxLoginAttempts;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (4 == Result.id)  //user timeout
{
	Session.g_oAPI.nSessionTerminationReason = 6;
}
else if (Result.id != 2)  //ms error
{
	Session.g_oAPI.nSessionTerminationReason = 12;
}]]></script>
          </scripts>
        </action>
        <action id="8" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=1040 y=368 ?>
          <!--invalid number-->
          <play connection-id="p_oMS.strConnectionId" endpoint="p_oMS.strEndPoint" callid="p_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="p_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >4509</audio>
          </play>
          <results >
            <result name="Default" link="6" stubbed="1"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
            <result name="try again" link="7" stubbed="1" >'Result'  == 'Success'
AND f_nNumRetry &gt; 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nNumRetry--;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (1 == Result.id)
{
	Session.g_oAPI.nSessionTerminationReason = 13;
}]]></script>
          </scripts>
        </action>
        <action id="10" plug-in="Pactolus.MGCPPlay.1" ><?xtml-editor x=479 y=565 ?>
          <!--g_nPromptToPlay-->
          <play connection-id="p_oMS.strConnectionId" endpoint="p_oMS.strEndPoint" callid="p_oMS.strCallId" repeat="1" timeout="s_nTIMEOUT" ms-type="p_oMS.strType" returns="" start-play="1" interrupt="1" return-immediate="0" digit-map="" language="g_oAPI.strLanguage" digits="" retry-count="" clear-digits="1" terminating-digit="" quick-collect="0" digit-timer="" >
            <audio type="index" >g_nPromptToPlay</audio>
          </play>
          <results >
            <result name="Default" link="4" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="11" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=207 y=575 ?>
          <!--"psAPIAuthorizeDestination"-->
          <function name="&quot;psAPIAuthorizeDestination&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegB</parameter>
            <parameter >g_oCallLegA</parameter>
          </function>
          <results >
            <result name="Default" link="10" stubbed="0"/>
            <result name="VALID DEST" link="5" stubbed="0" >f_nReturnCode == 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strOutdialDestNbr = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestDomIntlFlag = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].nDestCountryId = 0;
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestCallingCode = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strDestAreaCode = "";
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strEventId = "";

Server.logInfo("*********JAVA START AuthorizeDestination *********");
Server.logInfo("Platform Session ID : " + Session.g_oAPI.strPlatformSessionId);
Server.logInfo("DB Name : " + Session.g_oAPI.strProcDBName);
Server.logInfo("Calling Card Service ID : " + Session.g_oSUB.nServiceId);
Server.logInfo("Service Provider : " + Session.g_oAPI.lServiceProviderId);
Server.logInfo("Subscriber ID : " + Session.g_oSUB.lSubscriberId);
Server.logInfo("Origination Number : " + Session.g_oAPI.strOriginationNumber);
Server.logInfo("Stripped Origination Number : " + Session.g_oAPI.strStrippedOrigNumber);
Server.logInfo("Destination Number : " + Session.g_oAPI.strDestinationNumber);
Server.logInfo("Call Sequence : " + Session.g_oAPI.nCallSequence);
Server.logInfo("Info Digits : " + Session.g_oAPI.strInfoDigits);
Server.logInfo("Dialing Plan ID : " + Session.g_oAPI.nDialingPlanId);
Server.logInfo("Domestic Intl Flag : " + Session.g_oAPI.strOrigDomIntFlag);
Server.logInfo("Origin Country ID : " + Session.g_oAPI.nOrigCountryId);
]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("*********JAVA RETURN*********");
Server.logInfo("AuthorizeDest returned " + Session.f_nReturnCode);
Session.g_nPromptToPlay = 0;
if (Session.f_nReturnCode != 0)
{
	Server.logError("ERROR: FAIL TO AUTHORIZE DESTINATION, EXIT ON: " + Result.name);
	Server.logError("ERROR: AuthorizeDest returned " + Session.f_nReturnCode);
	switch (Session.f_nReturnCode)
	{
		case -99:
			Session.g_nErrorMsgNumber = 1001; //db error
			Session.g_oAPI.nSessionTerminationReason = 5;
			Server.logError("ERROR: FAIL TO AUTHORIZE DESTINATION, EXIT ON: " + Result.name);
			Server.logError("ERROR: AuthorizeDest returned " + Session.f_nReturnCode);
			break;
		case -3:
			Session.g_nErrorMsgNumber = 1007; //restricted dest
			//Session.g_nPromptToPlay = 513;
			Session.g_nPromptToPlay = 4511;
			break;
		case -4:
			Session.g_nErrorMsgNumber = 1008; //insufficient digit
			//Session.g_nPromptToPlay = 514;
			Session.g_nPromptToPlay = 4509;
			break;
		case -5:
			Session.g_nErrorMsgNumber = 1014; //java exception error
			Session.g_oAPI.nSessionTerminationReason = 5;
			break;
		case -50:
			Session.g_nErrorMsgNumber = 1000; //jvm server error
			Session.g_oAPI.nSessionTerminationReason = 5;
			Server.logError("ERROR: FAIL TO AUTHORIZE DESTINATION, EXIT ON: " + Result.name);
			Server.logError("ERROR: AuthorizeDest returned " + Session.f_nReturnCode);
			break;
		default:
			Session.g_nErrorMsgNumber = 0;
			break;
	}
}]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnCSRBeginAssignment" start="2" event="OnCSRBeginAssignment" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
        <parameter name="lCSRAssignmentId" type="i8" pass="byref"/>
        <parameter name="lCSRRequestId" type="i8" pass="byref"/>
        <parameter name="lCSRUserId" type="i8" pass="byref"/>
        <parameter name="lCSRRequestSkillId" type="i8" pass="byref"/>
        <parameter name="strCSRRequestSkillName" type="string" pass="byref"/>
        <parameter name="lCSRRequestLanguageId" type="i8" pass="byref"/>
        <parameter name="strCSRRequestLanguageName" type="string" pass="byref"/>
        <parameter name="lCSRRequestGroupId" type="i8" pass="byref"/>
        <parameter name="strCSRRequestGroupName" type="string" pass="byref"/>
        <parameter name="nCSRRequestType" type="i4" pass="byref"/>
        <parameter name="strRequestTypeName" type="string" pass="byref"/>
        <parameter name="lServiceProviderId" type="i8" pass="byref"/>
        <parameter name="strServiceProviderName" type="string" pass="byref"/>
        <parameter name="lOfferingId" type="i8" pass="byref"/>
        <parameter name="strOfferingName" type="string" pass="byref"/>
        <parameter name="strConfEventId" type="string" pass="byref"/>
        <parameter name="strModPasscode" type="string" pass="byref"/>
        <parameter name="strSubscriberAccount" type="string" pass="byref"/>
        <parameter name="strSubscriberFirstName" type="string" pass="byref"/>
        <parameter name="strSubscriberLastName" type="string" pass="byref"/>
        <parameter name="strCSRAppServerIP" type="string" pass="byref"/>
        <parameter name="strCSRRequestTypeName" type="string" pass="byref"/>
        <parameter name="lCSRAssignmentDuration" type="i8" pass="byref"/>
        <parameter name="strSubscriberPin" type="string" pass="byref"/>
        <parameter name="strCSRAssignmentAction" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_oMS" type="object" ></var>
        <var name="f_bUsedMOH_MS" type="boolean" >0</var>
      </local-vars>
      <actions >
        <action id="2" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=143 y=236 ?>
          <!--"BeginCSRAssignment"-->
          <function name="&quot;BeginCSRAssignment&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_nCurrentState</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >f_oMS</parameter>
            <parameter >g_oConferenceMS</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >s_nPROMPT_JOIN_TONE</parameter>
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
            <parameter >g_oMOHTimer</parameter>
            <parameter >g_oMaxWaitCSRTimer</parameter>
            <parameter >g_oTimerHeartBeat</parameter>
            <parameter >g_oSUB</parameter>
          </function>
          <results >
            <result name="Default" link="5" stubbed="0"/>
            <result name="SUCCESS" link="3" stubbed="0" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();
Session.g_nCurrentState = Session.s_nBEGINASSIGNMENT;
Session.g_oACD.lCSRAssignmentStartTime = Server.getUTCTime();
Server.logInfo("RECEIVE CSRBeginAssignment");
Server.logInfo("Assignment Id: " + Session.lCSRAssignmentId);
Server.logInfo("g_oACD.Assignment Id: " + Session.g_oACD.lCSRAssignmentId);
Server.logInfo("Request Id: " + Session.lCSRRequestId);
Server.logInfo("ACD User Id: " + Session.lCSRUserId);
Server.logInfo("Assignment skill Id: " + Session.lCSRRequestSkillId);
Server.logInfo("Assignment skill name: " + Session.strCSRRequestSkillName);
Server.logInfo("Assignment language Id: " + Session.lCSRRequestLanguageId);
Server.logInfo("Assignment language name: " + Session.strCSRRequestLanguageName);
Server.logInfo("Assignment group Id: " + Session.lCSRRequestGroupId);
Server.logInfo("Assignment group name: " + Session.strCSRRequestGroupName);
Server.logInfo("Request type: " + Session.nCSRRequestType);
Server.logInfo("Request type name: " + Session.strRequestTypeName);
Server.logInfo("Service Provider Id: " + Session.lServiceProviderId);
Server.logInfo("Service Provider name: " + Session.strServiceProviderName);
Server.logInfo("Offering Id: " + Session.lOfferingId);
Server.logInfo("Offering name: " + Session.strOfferingName);
Server.logInfo("Conf Event Id: " + Session.strConfEventId);
Server.logInfo("Mod passcode: " + Session.strModPasscode);
Server.logInfo("Subscriber Account: " + Session.strSubscriberAccount);
Server.logInfo("Subscriber First Name: " + Session.strSubscriberFirstName);
Server.logInfo("Subscriber Last Name: " + Session.strSubscriberLastName);
Server.logInfo("strCSRAppServerIP: " + Session.strCSRAppServerIP);
Server.logInfo("strCSRRequestTypeName: " + Session.strCSRRequestTypeName);
Server.logInfo("lCSRAssignmentDuration: " + Session.lCSRAssignmentDuration);
Server.logInfo("POSTPAID SENDING Assignment Id: " + Session.g_oACD.lCSRAssignmentId);

Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;
Session.g_oACD.lCSRAssignmentId = new String(Session.lCSRAssignmentId);
Session.g_oACD.lCSRRequestId = Session.lCSRRequestId;
Session.g_oACD.lCSRUserId = Session.lCSRUserId;
Session.g_oACD.lCSRRequestSkillId = Session.lCSRRequestSkillId;
Session.g_oACD.strCSRRequestSkillName = Session.strCSRRequestSkillName;
Session.g_oACD.lCSRRequestLanguageId = Session.lCSRRequestLanguageId;
Session.g_oACD.strCSRRequestLanguageName = Session.strCSRRequestLanguageName;
Session.g_oACD.lCSRRequestGroupId = Session.lCSRRequestGroupId;
Session.g_oACD.strCSRRequestGroupName = Session.strCSRRequestGroupName;
Session.g_oACD.nCSRRequestType = Session.nCSRRequestType;
Session.g_oACD.strCSRRequestTypeName = Session.strCSRRequestTypeName;
Session.g_oACD.strCSRRequestTypeName = Session.strCSRRequestTypeName;
Session.g_oACD.strCSRAppServerIP = Session.strCSRAppServerIP;
Session.g_oACD.strCSRAssignmentAction = Session.strCSRAssignmentAction;


if (Session.g_oMOH_MS.bCurrentlyInConf || Session.g_oMOH_MS.bCurrentlyConnected)
{
	Session.f_oMS = Session.g_oMOH_MS;
	Session.f_bUsedMOH_MS = true;
}
else
{
	Session.f_oMS = Session.g_oMS;
}]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (Session.f_bUsedMOH_MS)
{
	Session.g_oMOH_MS = Session.f_oMS;
}
else
{
	Session.g_oMS = Session.f_oMS;
}]]></script>
          </scripts>
        </action>
        <action id="3" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=450 y=357 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="4" plug-in="Standard.EndSession.1" ><?xtml-editor x=948 y=167 ?></action>
        <action id="5" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=435 y=176 ?>
          <!--"HangUpParty"-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="lib_callcontrol.xml" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="9" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 6;
Session.g_oAPI.nSessionTerminationReason = 5;]]></script>
          </scripts>
        </action>
        <action id="9" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=683 y=170 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="4" stubbed="0"/>
          </results>
        </action>
      </actions>
    </function>
    <function name="OnCSREndAssignment" start="12" event="OnCSREndAssignment" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
        <parameter name="lCSRAssignmentId" type="i8" pass="byref"/>
        <parameter name="lCSRRequestId" type="i8" pass="byref"/>
        <parameter name="lCSRUserId" type="i8" pass="byref"/>
        <parameter name="strCSRAssignmentAction" type="string" pass="byref"/>
        <parameter name="strPasscode" type="string" pass="byref"/>
        <parameter name="strPrepaidPin" type="string" pass="byref"/>
        <parameter name="strPostpaidPin" type="string" pass="byref"/>
        <parameter name="strPostpaidAccountNumber" type="string" pass="byref"/>
        <parameter name="strOutdialPhoneNumber" type="string" pass="byref"/>
        <parameter name="nCSRAvailabilityState" type="i4" pass="byref"/>
        <parameter name="strBillableFlag" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_bZeroOutToCSR" type="boolean" >0</var>
        <var name="f_oTimerBeepBeep" type="object" ></var>
        <var name="f_nOutdial" type="i4" >1</var>
        <var name="f_nGetDest" type="i4" >2</var>
        <var name="f_nGetPin" type="i4" >3</var>
        <var name="f_nReturnToIVR" type="i4" >4</var>
        <var name="f_nDoNothing" type="i4" >5</var>
        <var name="f_oTempObject" type="object" ></var>
        <var name="f_nBridgeAandB" type="i4" >6</var>
      </local-vars>
      <actions >
        <action id="12" plug-in="Pactolus.Branch.1" ><?xtml-editor x=90 y=367 ?>
          <results >
            <result name="Default" link="7" stubbed="0"/>
            <result name="arrayCallLegs.length == 0" link="13" stubbed="0" >g_oArrayCallLegs.length == 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();
Session.g_nCurrentState = Session.s_nENDASSIGNMENT;

Server.logInfo("RECEIVE CSREndAssignment");
Server.logInfo("Assignment Id: " + Session.lCSRAssignmentId);
Server.logInfo("Request Id: " + Session.lCSRRequestId);
Server.logInfo("ACD User Id: " + Session.lCSRUserId);
Server.logInfo("Assignment action: " + Session.strCSRAssignmentAction);
Server.logInfo("Conf passcode: " + Session.strPasscode);
Server.logInfo("strPostpaidAccountNumber: " + Session.strPostpaidAccountNumber);
Server.logInfo("strPostpaidPin: " + Session.strPostpaidPin);

Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;
Session.g_oACD.lCSRAssignmentId = Session.lCSRAssignmentId;
Session.g_oACD.lCSRRequestId = Session.lCSRRequestId;
Session.g_oACD.lCSRUserId = Session.lCSRUserId;
Session.g_oACD.strCSRAssignmentAction = Session.strCSRAssignmentAction;
Session.g_oACD.strOutdialBLegPhoneNumber = Session.strOutdialPhoneNumber;


if(Session.strBillableFlag != "" && Session.strBillableFlag != " ") {
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBillableFlag = Session.strBillableFlag;
}	


Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBillableFlag = Session.strBillableFlag;

if(Session.strPostpaidAccountNumber.length > 0) {
	Session.g_oSUB.strAccountNumber = Session.strPostpaidAccountNumber;
}

if(Session.strPostpaidPin.length > 0) {
	Session.g_oSUB.strUserPin = Session.g_oSUB.strAccountNumber + Session.strPostpaidPin;
}

Server.logInfo("Session.g_oSUB.strUserPin: " + Session.g_oSUB.strUserPin);

if ("6" == Session.strCSRAssignmentAction || "7" == Session.strCSRAssignmentAction || "13" == Session.strCSRAssignmentAction)
{
	Session.g_nCurrentState = Session.s_nREQUEUE;
}]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=1031 y=531 ?>
          <return value=""/>
        </action>
        <action id="3" plug-in="Standard.EndSession.1" ><?xtml-editor x=1115 y=150 ?></action>
        <action id="4" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=664 y=154 ?>
          <!--"HangUpParty"-->
          <function name="&quot;HangUpParty&quot;" return="" external-function="1" library="lib_callcontrol.xml" >
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="6" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.nCallTerminationReason = 6;
Session.g_oAPI.nSessionTerminationReason = 19;]]></script>
          </scripts>
        </action>
        <action id="5" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=988 y=713 ?>
          <!--send to Main function-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
        </action>
        <action id="6" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=890 y=153 ?>
          <!--Remove member from conference-->
          <function name="&quot;RemoveMemberFromConference&quot;" return="" external-function="1" library="" >
            <parameter >g_oConferenceMS</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="0"/>
          </results>
        </action>
        <action id="7" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=366 y=327 ?>
          <!--"EndCSRAssignment"-->
          <function name="&quot;EndCSRAssignment&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >strCSRAssignmentAction</parameter>
            <parameter >g_oAPI.nCallTerminationReason</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oConferenceMS</parameter>
            <parameter >g_oMS</parameter>
            <parameter >f_bZeroOutToCSR</parameter>
            <parameter >f_oTimerBeepBeep</parameter>
            <parameter >g_oMaxWaitCSRTimer</parameter>
            <parameter >g_oMOHTimer</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
            <parameter >g_oCreditCard</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="4" stubbed="0"/>
            <result name="Outdial" link="11" stubbed="0" >f_nReturnCode == f_nOutdial</result>
            <result name="Get Dest" link="9" stubbed="0" >f_nReturnCode == f_nGetDest</result>
            <result name="Get Pin" link="10" stubbed="0" >f_nReturnCode == f_nGetPin</result>
            <result name="Return To IVR" link="15" stubbed="0" >f_nReturnCode == f_nReturnToIVR</result>
            <result name="Do Nothing" link="2" stubbed="1" >f_nReturnCode == f_nDoNothing</result>
            <result name="Bridge A and B" link="8" stubbed="1" >f_nReturnCode == f_nBridgeAandB</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if(2 != Result.id && 6 != Result.id && 7 != Result.id) {
	Server.logInfo("Reset lCSRAssignmentId and lCSRUserId.");
	Session.g_oACD.lCSRAssignmentId = 0;
	Session.g_oACD.lCSRUserId = 0;	
}

js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="8" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=960 y=287 ?>
          <!--make connection-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="2" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nMAKE_CONNECTION;
if (true == Session.g_oACD.bCSRWithAB)
{
	Session.g_oACD.bCSRWithAB = false;
}

if(Session.strBillableFlag != "" && Session.strBillableFlag != " ") {
	Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBillableFlag = Session.strBillableFlag;
}	


Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCSROutdialFlag = "T";]]></script>
          </scripts>
        </action>
        <action id="9" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=783 y=433 ?>
          <!--get dest-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="2" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nGET_DESTINATION;]]></script>
          </scripts>
        </action>
        <action id="10" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=721 y=558 ?>
          <!--get pin-->
          <function name="&quot;Main&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="2" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_nCurrentState = Session.s_nGET_PIN;]]></script>
          </scripts>
        </action>
        <action id="11" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=711 y=291 ?>
          <!--InitializeCallLeg for outdial-->
          <function name="&quot;InitializeCallLeg&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="8" stubbed="0"/>
          </results>
        </action>
        <action id="13" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=381 y=569 ?>
          <!--"EndCSRAssignment"-->
          <function name="&quot;EndCSRAssignment&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >strCSRAssignmentAction</parameter>
            <parameter >g_oAPI.nCallTerminationReason</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oConferenceMS</parameter>
            <parameter >g_oMS</parameter>
            <parameter >f_bZeroOutToCSR</parameter>
            <parameter >f_oTimerBeepBeep</parameter>
            <parameter >g_oMaxWaitCSRTimer</parameter>
            <parameter >g_oMOHTimer</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
            <parameter >g_oCreditCard</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >f_oTempObject</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="4" stubbed="1"/>
            <result name="Outdial" link="11" stubbed="1" >f_nReturnCode == f_nOutdial</result>
            <result name="Get Dest" link="9" stubbed="1" >f_nReturnCode == f_nGetDest</result>
            <result name="Get Pin" link="10" stubbed="1" >f_nReturnCode == f_nGetPin</result>
            <result name="Return To IVR" link="15" stubbed="1" >f_nReturnCode == f_nReturnToIVR</result>
            <result name="Do Nothing" link="2" stubbed="1" >f_nReturnCode == f_nDoNothing</result>
            <result name="Bridge A and B" link="8" stubbed="1" >f_nReturnCode == f_nBridgeAandB</result>
          </results>
          <scripts >
            <script language="javascript" timing="last" ><![CDATA[if(2 != Result.id && 6 != Result.id && 7 != Result.id) {
	Server.logInfo("Reset lCSRAssignmentId and lCSRUserId.");
	Session.g_oACD.lCSRAssignmentId = 0;
	Session.g_oACD.lCSRUserId = 0;	
}

js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="14" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=803 y=783 ?>
          <!--"psAPIUnlockPin"-->
          <function name="&quot;psAPIUnlockPin&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oSUB</parameter>
            <parameter >g_oAPI</parameter>
          </function>
          <results >
            <result name="Default" link="5" stubbed="0"/>
            <result name="SUCCESS" >f_nReturnCode == s_sSUCCESS
OR f_nReturnCode == -1</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.f_nReturnCode = -50;
js_disable_event();]]></script>
            <script language="javascript" timing="last" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="15" plug-in="Pactolus.Branch.1" ><?xtml-editor x=677 y=643 ?>
          <results >
            <result name="Default" link="5" stubbed="0"/>
            <result name="AuthPin?" link="14" stubbed="0" >g_nCurrentState == s_nAUTHENTICATE_PIN</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("STATE PRIOR TO ZERO OUT TO CSR IS: " + Session.g_oAPI.nStatePriorToCSR);

switch (Session.g_oAPI.nStatePriorToCSR)
{
	case Session.s_nGET_PIN:
		if(Session.g_oSUB.strUserPin.length > 0) {
			Session.g_oSUB.strUserPin = Session.g_oSUB.strAccountNumber + Session.g_oSUB.strUserPin;				
			Session.g_nCurrentState = Session.s_nAUTHENTICATE_PIN;
		} else {
			Session.g_nCurrentState = Session.s_nGET_PIN;
		}
		break;
	case Session.s_nAUTHENTICATE_PIN:
		if(Session.g_oSUB.strUserPin.length > 0) {
			Session.g_oSUB.strUserPin = Session.g_oSUB.strAccountNumber + Session.g_oSUB.strUserPin;		
			Session.g_nCurrentState = Session.s_nAUTHENTICATE_PIN;
		} else {
			Session.g_nCurrentState = Session.s_nGET_PIN;
		}
		break;
	case Session.s_nMAIN_MENU:
		Session.g_nCurrentState = Session.s_nMAIN_MENU;
		break;		
		
	default:
		Server.logInfo("UNKNOWN STATE PRIOR TO CSR");
		break;
}
]]></script>
          </scripts>
        </action>
      </actions>
      <text-objects >
        <text-object x-coord="104" y-coord="48" width="318" height="63" text="need to add some kind of check
get pin or return to main menu where user zero out to csr" font-name="Times New Roman" size="-16" red="0" green="0" blue="0" weight="0" underline="0" strikeout="0" point-size="12" italic="0"/>
      </text-objects>
    </function>
    <function name="OnCSRPutCallerOffHold" start="1" event="OnCSRPutCallerOffHold" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=292 y=247 ?>
          <!--proc CSRPutCallerOffHold-->
          <function name="&quot;CSRCallerOffHold&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oConferenceMS</parameter>
            <parameter >g_oMOH_MS</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
            <parameter >g_oMOHTimer</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();
Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;

	Server.logInfo("g_oMOH_MS.strConferenceId: " + Session.g_oMOH_MS.strConferenceId);
	Server.logInfo("g_oMOH_MS.strEndPoint: " + Session.g_oMOH_MS.strEndPoint);
	Server.logInfo("g_oMOH_MS.strContent: " + Session.g_oMOH_MS.strContent);
	Server.logInfo("g_oMOH_MS.strConnectionId: " + Session.g_oMOH_MS.strConnectionId);
	Server.logInfo("g_oMOH_MS.strCallId: " + Session.g_oMOH_MS.strCallId);
	Server.logInfo("g_oMOH_MS.strType: " + Session.g_oMOH_MS.strType);
	Server.logInfo("g_oMOH_MS.bCurrentlyInConf: " + Session.g_oMOH_MS.bCurrentlyInConf);
	Server.logInfo("g_oMOH_MS.bCurrentlyConnected: " + Session.g_oMOH_MS.bCurrentlyConnected);
	Server.logInfo("g_oMOH_MS.strSessionId: " + Session.g_oMOH_MS.strSessionId);
	Server.logInfo("g_oMOH_MS.nConfIndex: " + Session.g_oMOH_MS.nConfIndex);]]></script>
            <script language="javascript" timing="last" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=546 y=244 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (Session.f_nReturnCode != 0)
{
	Server.logError("ERROR: FAIL TO PUT CALLER OFF HOLD");
}]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnCSRPutCallerOnHold" start="1" event="OnCSRPutCallerOnHold" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
      </local-vars>
      <actions >
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=199 y=179 ?>
          <!--proc CSRPutCallerOnHold-->
          <function name="&quot;CSRCallerOnHold&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oMOH_MS</parameter>
            <parameter >g_oConferenceMS</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oMOHTimer</parameter>
            <parameter >g_oAPI.strLanguage</parameter>
            <parameter >g_oPleaseHoldTimer</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();
Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;]]></script>
            <script language="javascript" timing="last" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=453 y=176 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[if (Session.f_nReturnCode != 0)
{
	Server.logError("ERROR: FAIL TO PUT CALLER ON HOLD");
}]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnCSROutdialBLeg" start="5" event="OnCSROutdialBLeg" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
        <parameter name="strPhoneNumber" type="string" pass="byref"/>
        <parameter name="strPrepaidPin" type="string" pass="byref"/>
        <parameter name="strPostpaidPin" type="string" pass="byref"/>
        <parameter name="strPostpaidAccountNumber" type="string" pass="byref"/>
        <parameter name="strBillableFlag" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_bHasAccountAndPin" type="boolean" >0</var>
        <var name="f_nFAILURE" type="i4" >-1</var>
      </local-vars>
      <actions >
        <action id="5" plug-in="Pactolus.Branch.1" ><?xtml-editor x=174 y=359 ?>
          <results >
            <result name="Default" link="9" stubbed="1"/>
            <result name="has account and pin" link="10" stubbed="0" >f_bHasAccountAndPin == true</result>
            <result name="no acct or pin &amp;&amp; lPinId == 0" link="6" stubbed="0" >f_bHasAccountAndPin == false
AND g_oSUB.lPinId == 0</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;
Session.g_bGotCSRCancelOutdial = false;
Session.g_bGotCSRHangupOutdial = false;
if (0 == Session.strPostpaidAccountNumber.length || 0 == Session.strPostpaidPin.length)
{
	Session.f_bHasAccountAndPin = false;
}
else
{
	Session.f_bHasAccountAndPin = true;
}]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (3 == Result.id)
{
	Session.g_oACD.strReturnMsg = "Failure to outdial B Leg, because there is no account number or pin";
}]]></script>
          </scripts>
        </action>
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=715 y=389 ?>
          <!--InitializeCallLeg for outdial-->
          <function name="&quot;InitializeCallLeg&quot;" return="" external-function="0" library=""/>
          <results >
            <result name="Default" link="2" stubbed="0"/>
          </results>
        </action>
        <action id="2" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=957 y=383 ?>
          <!--proc CSROutdial-->
          <function name="&quot;ProcOnCSROutdialParty&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oACD</parameter>
            <parameter >s_strContact</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="1"/>
            <result name="SUCCESS" link="3" stubbed="1" >f_nReturnCode == s_sSUCCESS</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[//js_disable_event();
Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;

if (Session.s_strTestModeFlag == "T")
{
	Session.g_oAPI.strDestinationNumber = Session.g_oTestData.strTestDestinationNumber;
}
Server.logInfo("BEFORE g_oAPI.strDestinationNumber prepend : <" + Session.g_oAPI.strDestinationNumber + " >");
Session.g_oAPI.strDestinationNumber = js_prepend_digits(Session.g_oAPI.strDestinationNumber, Session.s_strDigitPrependToOutdial);
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCalledNumber = Session.g_oAPI.strDestinationNumber;
Server.logInfo("AFTER g_oAPI.strDestinationNumber prepend : <" + Session.g_oAPI.strDestinationNumber + " >");
Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].oMS.strConferenceId = Session.g_oConferenceMS.strConferenceId;

Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strBillableFlag = Session.strBillableFlag;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (2 == Result.id)
{
	Session.g_oACD.strCSRDidOutdial = "T";
	Session.g_oACD.bCSRWithAB = true;
}
else
{
	Server.logInfo("Remove call leg from array");
	Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{	
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

	Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
	for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
	{
		Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
		Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
		Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
	}

}
//js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="3" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=711 y=547 ?>
          <return value=""/>
        </action>
        <action id="6" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=475 y=547 ?>
          <!--"MsgCSROutdialBLegResponse"-->
          <function name="&quot;MsgCSROutdialBLegResponse&quot;" return="" external-function="1" library="lib_soap.xml" >
            <parameter >g_oACD</parameter>
          </function>
          <results >
            <result name="Default" link="3" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oACD.nReturnReasonCode = -999;
js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="7" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=736 y=217 ?>
          <!--"PostpaidAPIAuthenticatePin"-->
          <function name="&quot;PostpaidAPIAuthenticatePin&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
          </function>
          <results >
            <result name="Default" link="6" stubbed="1"/>
            <result name="(0 or 2) or billFlag = F" link="9" stubbed="0" >(f_nReturnCode == 0
OR f_nReturnCode == 2)
OR strBillableFlag match "F"</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("*********JAVA START AuthenticateSub *********");
Server.logInfo("DB Name : " + Session.g_oAPI.strProcDBName);
Server.logInfo("Platform Session ID : " + Session.g_oAPI.strPlatformSessionId);
Server.logInfo("Service Provider : " + Session.g_oAPI.lServiceProviderId);
Server.logInfo("Origination Number : " + Session.g_oAPI.strOriginationNumber);
Server.logInfo("Stripped Origination Number : " + Session.g_oAPI.strStrippedOrigNumber);
Server.logInfo("Pin number : " + Session.g_oSUB.strUserPin);
Server.logInfo("Max login attemps : " + Session.g_oAPI.nMaxLoginAttempts);
Server.logInfo("Number login attemps : " + Session.g_oAPI.nNumberLoginAttempts);
Server.logInfo("Origination Country : " + Session.g_oAPI.nOrigCountryId);
Server.logInfo("BEFORE: g_oAPI.fCreditLimit: " + Session.g_oAPI.fCreditLimit);
Server.logInfo("BEFORE: g_oAPI.fCreditUsed: " + Session.g_oAPI.fCreditUsed);
Session.f_nReturnCode = -50;]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("*********JAVA RETURN*********");
Server.logInfo("AuthenticateSub returned " + Session.f_nReturnCode);
Server.logInfo("Pin level language " + Session.g_oSUB.strPinLanguage);
Server.logInfo("BEFORE: g_oAPI.fCreditLimit: " + Session.g_oAPI.fCreditLimit);
Server.logInfo("BEFORE: g_oAPI.fCreditUsed: " + Session.g_oAPI.fCreditUsed);

if (Session.s_strIgnorePinLanguage == "F" && Session.g_oSUB.strPinLanguage.length > 0){
	Session.g_oAPI.strLanguage = Session.g_oSUB.strPinLanguage;
}else{
    Server.logInfo("ignoring pin level language, continue with access number language");
}
if (1 == Result.id)
{
 switch (Session.f_nReturnCode)
 {
  case -4:
   Session.g_oACD.strReturnMsg = "Call Failed -- subscriber is deactivated";
   break;
  case -5:
   Session.g_oACD.strReturnMsg = "Call Failed -- account already in use";
   break;
  case -9:
   Session.g_oACD.strReturnMsg = "Call Failed -- corporate account deactivated";
   break;
  case -10:
   Session.g_oACD.strReturnMsg = "Call Failed -- account requires ANI authentication";
   break;
  case -11:
   Session.g_oACD.strReturnMsg = "Call Failed -- insufficient credit to place call";
   break;
  case -12:
   Session.g_oACD.strReturnMsg = "Call Failed -- access number not linked to product offering";
   break;
  default:
   Session.g_oACD.strReturnMsg = "Call Failed -- subscriber validation failed with reason " + Session.f_nReturnCode;;
   break;
 }
} else {

	if(Session.g_oAPI.nStatePriorToCSR == Session.s_nGET_PIN) {
		Session.g_oAPI.nStatePriorToCSR = Session.s_nGET_DESTINATION;
	}	
}


js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="9" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=982 y=225 ?>
          <!--"psAPIAuthorizeDestination"-->
          <function name="&quot;psAPIAuthorizeDestination&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegB</parameter>
            <parameter >g_oCallLegA</parameter>
          </function>
          <results >
            <result name="Default" link="12" stubbed="0"/>
            <result name="0 - Valid, 1 - No Limit, billFlag = F" link="11" stubbed="0" >f_nReturnCode == 0
OR strBillableFlag match "F"
OR f_nReturnCode == 1</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("*********JAVA START AuthorizeDestination *********");
Server.logInfo("Platform Session Id : " + Session.g_oAPI.strPlatformSessionId);
Server.logInfo("DB Name : " + Session.g_oAPI.strProcDBName);
Server.logInfo("Calling Card Service Id : " + Session.g_oSUB.nServiceId);
Server.logInfo("Service Provider : " + Session.g_oAPI.lServiceProviderId);
Server.logInfo("Subscriber Id : " + Session.g_oSUB.lSubscriberId);
Server.logInfo("Origination Number : " + Session.g_oAPI.strOriginationNumber);
Server.logInfo("Stripped Origination Number : " + Session.g_oAPI.strStrippedOrigNumber);
Session.g_oAPI.strDestinationNumber = Session.strPhoneNumber;
Server.logInfo("Destination Number : " + Session.g_oAPI.strDestinationNumber);
Server.logInfo("Call Sequence : " + Session.g_oAPI.nCallSequence);
Server.logInfo("Info Digits : " + Session.g_oAPI.strInfoDigits);
Server.logInfo("Dialing Plan Id : " + Session.g_oAPI.nDialingPlanId);
Server.logInfo("Domestic Intl Flag : " + Session.g_oAPI.strOrigDomIntFlag);
Server.logInfo("Origin Country Id : " + Session.g_oAPI.nOrigCountryId);]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("*********JAVA RETURN*********");
Server.logInfo("AuthorizeDest returned " + Session.f_nReturnCode);
if (1 == Result.id)
{
	switch (Session.f_nReturnCode)
	{
		case -3:
			Session.g_oACD.strReturnMsg = "Call Failed -- restricted destination";
			break;
		case -4:
			Session.g_oACD.strReturnMsg = "Call Failed -- insufficient digits";
			break;
		case -6:
			Session.g_oACD.strReturnMsg = "Call Failed -- insufficient funds";
			break;
		case -7:
			Session.g_oACD.strReturnMsg = "Call Failed -- no rate";
			break;
		case -8: 
			Session.g_oACD.strReturnMsg = "Call Failed -- destination not in 'phone me' list";
			break;
		case -9: 
			Session.g_oACD.strReturnMsg = "Call Failed -- no applicable rates found for this call";
			break;				
		default:
			Session.g_oACD.strReturnMsg = "Call Failed";
			break;
	}
}]]></script>
          </scripts>
        </action>
        <action id="10" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=457 y=219 ?>
          <!--"psAPIUnlockPin"-->
          <function name="&quot;psAPIUnlockPin&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oSUB</parameter>
            <parameter >g_oAPI</parameter>
          </function>
          <results >
            <result name="Default" link="7" stubbed="0"/>
            <result name="SUCCESS" link="7" stubbed="0" >f_nReturnCode == s_sSUCCESS
OR f_nReturnCode == -1</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("*********JAVA START UnLockPin *********");
Session.g_oSUB.strUserPin = Session.strPostpaidAccountNumber + Session.strPostpaidPin;
Session.f_nReturnCode = -50;
js_disable_event();]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("*********JAVA RETURN*********");
Server.logInfo("UnLockPin returned " + Session.f_nReturnCode);
/*
if (1 == Result.id)
{
	Session.g_oACD.strReturnMsg = "Failure to outdial B Leg, because fail to unlock pin";
}
*/]]></script>
          </scripts>
        </action>
        <action id="11" plug-in="Pactolus.Branch.1" ><?xtml-editor x=467 y=391 ?>
          <!--cancel outdial?-->
          <results >
            <result name="Default" link="1" stubbed="0"/>
            <result name="cancel outdial" link="6" stubbed="1" >g_bGotCSRCancelOutdial == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.strDestinationNumber = Session.g_oAPI.strOutdialDestNumber;]]></script>
            <script language="javascript" timing="last" ><![CDATA[if (2 == Result.id)
{
	Session.g_oACD.strReturnMsg = "CSR outdial B leg canceled";
}]]></script>
          </scripts>
        </action>
        <action id="12" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=1228 y=328 ?>
          <!--"psAPIUnlockPin"-->
          <function name="&quot;psAPIUnlockPin&quot;" return="f_nReturnCode" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oSUB</parameter>
            <parameter >g_oAPI</parameter>
          </function>
          <results >
            <result name="Default" link="6" stubbed="1"/>
            <result name="SUCCESS" >f_nReturnCode == s_sSUCCESS
OR f_nReturnCode == -1</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("*********JAVA START UnLockPin *********");
js_disable_event();]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("*********JAVA RETURN*********");
Server.logInfo("UnLockPin returned " + Session.f_nReturnCode);
/*
if (1 == Result.id)
{
	Session.g_oACD.strReturnMsg = "Failure to outdial B Leg, because fail to unlock pin";
}
*/]]></script>
          </scripts>
        </action>
      </actions>
      <text-objects >
        <text-object x-coord="132" y-coord="81" width="237" height="37" text="If has account or pin, must validate it." font-name="Times New Roman" size="-16" red="0" green="0" blue="0" weight="0" underline="0" strikeout="0" point-size="12" italic="0"/>
      </text-objects>
    </function>
    <function name="OnCSRCancelOutdialToBLeg" start="3" event="OnCSRCancelOutdialToBLeg" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_bNoCallLeg" type="boolean" >0</var>
      </local-vars>
      <actions >
        <action id="3" plug-in="Pactolus.Branch.1" ><?xtml-editor x=50 y=110 ?>
          <!--got cancel-->
          <results >
            <result name="Default" link="5" stubbed="0"/>
            <result name="bGotCSRCancel" link="2" stubbed="0" >g_bGotCSRCancelOutdial == true
OR f_bNoCallLeg == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();
if (0 == Session.g_oArrayCallLegs.length)
{
	Session.f_bNoCallLeg = true;
}]]></script>
          </scripts>
        </action>
        <action id="1" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=485 y=97 ?>
          <!--"ProcOnCSRCancelOutdial"-->
          <function name="&quot;ProcOnCSRCancelOutdial&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
            <parameter >g_oACD</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="2" stubbed="1"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("RECEIVE CSR CANCEL OUTDIAL TO B LEG FROM: ");
Server.logInfo("ACD CONTROLLER IP: " + Session.strACDControllerIP);
Server.logInfo("ACD CONTROLLER PORT: " + Session.nACDControllerPort);
Server.logInfo("ACD TRANSACTION ID: " + Session.strTransactionId);
Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;
Session.g_bGotCSRCancelOutdial = true;]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("Remove call leg from array");
Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
{	
	Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
	Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
	Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
{
	Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
	Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
	Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
}

if (true == Session.g_oACD.bCSRWithAB)
{
	Session.g_oACD.bCSRWithAB = false;
}]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=344 y=240 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="5" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=271 y=59 ?>
          <!--"ProcOnCSRCancelOutdial"-->
          <function name="&quot;ProcOnCSRCancelOutdial&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
            <parameter >g_oACD</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("RECEIVE CSR CANCEL OUTDIAL TO B LEG FROM: ");
Server.logInfo("ACD CONTROLLER IP: " + Session.strACDControllerIP);
Server.logInfo("ACD CONTROLLER PORT: " + Session.nACDControllerPort);
Server.logInfo("ACD TRANSACTION ID: " + Session.strTransactionId);
Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;
Session.g_bGotCSRCancelOutdial = true;

if(Session.g_oACD.bCSRWithAB == true) {
	Session.g_oACD.bCSRWithAB = false;
}	]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnCSRHangupBLeg" start="3" event="OnCSRHangupBLeg" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
      </parameters>
      <local-vars >
        <var name="f_nReturnCode" type="i4" >-50</var>
        <var name="f_bNoCallLeg" type="boolean" >0</var>
      </local-vars>
      <actions >
        <action id="3" plug-in="Pactolus.Branch.1" ><?xtml-editor x=45 y=83 ?>
          <!--got hangup-->
          <results >
            <result name="Default" link="2" stubbed="0"/>
            <result name="bGotCSRHangup" link="1" stubbed="0" >g_bGotCSRHangupOutdial == true
OR f_bNoCallLeg == true</result>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_disable_event();
if (0 == Session.g_oArrayCallLegs.length)
{
	Session.f_bNoCallLeg = true;
}]]></script>
          </scripts>
        </action>
        <action id="1" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=671 y=238 ?>
          <return value=""/>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[js_enable_event();]]></script>
          </scripts>
        </action>
        <action id="2" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=299 y=28 ?>
          <!--"ProcOnCSRHangupBLeg"-->
          <function name="&quot;ProcOnCSRHangupBLeg&quot;" return="f_nReturnCode" external-function="1" library="lib_acd.xml" >
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex].oMS</parameter>
            <parameter >g_oACD</parameter>
            <parameter >s_strContact</parameter>
          </function>
          <results >
            <result name="Default" link="4" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Server.logInfo("RECEIVE CSR HANGUP B LEG FROM: ");
Server.logInfo("ACD CONTROLLER IP: " + Session.strACDControllerIP);
Server.logInfo("ACD CONTROLLER PORT: " + Session.nACDControllerPort);
Server.logInfo("ACD TRANSACTION ID: " + Session.strTransactionId);
Session.g_oACD.strACDControllerIP = Session.strACDControllerIP;
Session.g_oACD.nACDControllerPort = Session.nACDControllerPort;
Session.g_oACD.strTransactionId = Session.strTransactionId;
Session.g_bGotCSRHangupOutdial = true;]]></script>
          </scripts>
        </action>
        <action id="4" plug-in="Standard.FunctionCall.1" ><?xtml-editor x=614 y=69 ?>
          <!--"psAPIProcCallCompletion"-->
          <function name="&quot;psAPIProcCallCompletion&quot;" return="" external-function="1" library="lib_APISce.xml" >
            <parameter >g_oAPI</parameter>
            <parameter >g_oSUB</parameter>
            <parameter >g_oCallLegA</parameter>
            <parameter >g_oArrayCallLegs[g_nCurrentArrayIndex]</parameter>
            <parameter >g_oRATE</parameter>
            <parameter >g_oACD</parameter>
            <parameter >g_oArrayCallLegs</parameter>
          </function>
          <results >
            <result name="Default" link="1" stubbed="0"/>
          </results>
          <scripts >
            <script language="javascript" timing="first" ><![CDATA[Session.g_oAPI.lTimeAnswered = 0;
Session.g_oAPI.nCallTerminationReason = 19; //other]]></script>
            <script language="javascript" timing="last" ><![CDATA[Server.logInfo("Remove call leg from array");
Server.logInfo("Before remove, array length is: " + Session.g_oArrayCallLegs.length);
for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
{	
	Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
	Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
	Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
}

	if (Session.g_oArrayCallLegs.length > 0)
	{
		js_remove_call_leg(Session.g_oArrayCallLegs, Session.g_oArrayCallLegs[Session.g_nCurrentArrayIndex].strCallId);
	}

Server.logInfo("After remove, array length is: " + Session.g_oArrayCallLegs.length);
for (var i = 0; i < Session.g_oArrayCallLegs.length; i++)
{
	Server.logInfo("INDEX: " + i + " HAS CALL ID: " + Session.g_oArrayCallLegs[i].strCallId);
	Server.logInfo("INDEX: " + i + " HAS CONTENT: " + Session.g_oArrayCallLegs[i].strContent);
	Server.logInfo("INDEX: " + i + " HAS MS CONTENT: " + Session.g_oArrayCallLegs[i].oMS.strContent);
}

if(Session.g_oACD.bCSRWithAB == true) {
	Session.g_oACD.bCSRWithAB = false;
}]]></script>
          </scripts>
        </action>
      </actions>
    </function>
    <function name="OnPing" start="2" event="OnPing" returns="void" >
      <parameters >
        <parameter name="strACDControllerIP" type="string" pass="byref"/>
        <parameter name="nACDControllerPort" type="i4" pass="byref"/>
        <parameter name="strTransactionId" type="string" pass="byref"/>
        <parameter name="strHostIP" type="string" pass="byref"/>
        <parameter name="nHostPort" type="i4" pass="byref"/>
      </parameters>
      <actions >
        <action id="2" plug-in="Pactolus.SOAPMessage.1" ><?xtml-editor x=190 y=187 ?>
          <!--RESPONSE SUCCESS-->
          <SOAP destination-ip="strACDControllerIP" transaction="strTransactionId" message-name="&quot;PingResponse&quot;" destination-port="nACDControllerPort" destination-type="4" destination-session="" waiting-session-selected=""/>
          <results >
            <result name="Default" link="1" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
          </results>
        </action>
        <action id="1" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=447 y=188 ?>
          <return value=""/>
        </action>
      </actions>
    </function>
    <function name="OnRefer" start="1" event="Refer" returns="void" >
      <parameters >
        <parameter name="strAccept" type="string" pass="byref"/>
        <parameter name="strAcceptEncoding" type="string" pass="byref"/>
        <parameter name="strAcceptLanguage" type="string" pass="byref"/>
        <parameter name="strAllow" type="string" pass="byref"/>
        <parameter name="strAuthorization" type="string" pass="byref"/>
        <parameter name="strCallId" type="string" pass="byref"/>
        <parameter name="strContact" type="string" pass="byref"/>
        <parameter name="strContent" type="string" pass="byref"/>
        <parameter name="strContentDisposition" type="string" pass="byref"/>
        <parameter name="strContentType" type="string" pass="byref"/>
        <parameter name="strCSeq" type="string" pass="byref"/>
        <parameter name="strDate" type="string" pass="byref"/>
        <parameter name="strEncryption" type="string" pass="byref"/>
        <parameter name="strErrorInfo" type="string" pass="byref"/>
        <parameter name="strFrom" type="string" pass="byref"/>
        <parameter name="strMaxForwards" type="string" pass="byref"/>
        <parameter name="strMIMEVersion" type="string" pass="byref"/>
        <parameter name="strOrganization" type="string" pass="byref"/>
        <parameter name="strProxyAuthorization" type="string" pass="byref"/>
        <parameter name="strProxyRequire" type="string" pass="byref"/>
        <parameter name="strRecordRoute" type="string" pass="byref"/>
        <parameter name="strRequestUri" type="string" pass="byref"/>
        <parameter name="strReferTo" type="string" pass="byref"/>
        <parameter name="strReferredBy" type="string" pass="byref"/>
        <parameter name="strRequire" type="string" pass="byref"/>
        <parameter name="strResponseKey" type="string" pass="byref"/>
        <parameter name="strRoute" type="string" pass="byref"/>
        <parameter name="strSupported" type="string" pass="byref"/>
        <parameter name="strTimestamp" type="string" pass="byref"/>
        <parameter name="strTo" type="string" pass="byref"/>
        <parameter name="strUserAgent" type="string" pass="byref"/>
        <parameter name="strVia" type="string" pass="byref"/>
      </parameters>
      <actions >
        <action id="1" plug-in="Pactolus.SipResponse.1" ><?xtml-editor x=145 y=98 ?>
          <!--"SIP/2.0 501 Not Implemented"-->
          <sip-response remove-via="0" reliable="0" increment-cseq-first="0" increment-cseq-last="1" >
            <call-id >strCallId</call-id>
            <contact >s_strContact</contact>
            <cseq >strCSeq</cseq>
            <from >strFrom</from>
            <status >"SIP/2.0 501 Not Implemented"</status>
            <to >strTo</to>
            <via >strVia</via>
          </sip-response>
          <results >
            <result name="Default" link="3" stubbed="0"/>
            <result name="Success"/>
            <result name="Error"/>
            <result name="Timeout"/>
          </results>
        </action>
        <action id="3" plug-in="Standard.FunctionReturn.1" ><?xtml-editor x=382 y=92 ?>
          <return value=""/>
        </action>
      </actions>
    </function>
  </functions>
  <script language="javascript" ><![CDATA[#include <javascript_utils.jsh>]]></script>
  <properties >
    <property key="&quot;_english&quot;" value="G:/Software/downloads/prepaid_english.vox"/>
    <property key="&quot;en2&quot;" value="G:/Software/downloads/prepaid_english.vox"/>
    <property key="default" value="C:/pcs_english.vox"/>
    <property key="disable-logging" value="0"/>
    <property key="js-include-path" value="../Libs"/>
    <property key="library-modules" value="lib_callcontrol.xml; lib_mediaserver.xml; lib_3WayCalling.xml;lib_APISce.xml;lib_acd.xml;lib_soap.xml;lib_speeddial.xml;lib_utils.xml;lib_moh.xml"/>
    <property key="library-path" value="../Libs"/>
  </properties>
  <application-version >
    <revision >$Id: postpaid.xml,v 1.350 2005/06/22 14:52:39 sbhatt Exp $</revision>
    <label >$Name: PCS-A-4-1-1-1-4-c6 $</label>
  </application-version>
</xtml>